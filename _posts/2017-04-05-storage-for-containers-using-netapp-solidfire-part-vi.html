---
layout: single 
title: Storage for Containers using NetApp SolidFire– Part VI
categories:
- OpenShift
tags:
- Containers
- Docker
- ISCSI
- NetApp
- OpenShift
- SolidFire
- Storage
---
<h3><img class="alignnone size-full wp-image-8150" src="{{ site.baseurl }}/assets/2017/04/storage_article_008.jpg" alt="Shipping containers" width="1200" height="400" /></h3>
<h3>Overview</h3>
<p>In this article we will look at how you can configure and dynamically provision NetApp SolidFire Storage for containerized applications in a Kubernetes/OpenShift environment. This article is a work from Kapil Arora (Cloud Platform Architect @NetApp).</p>
<ul>
<li><a href="https://keithtenzer.com/2017/03/07/storage-for-containers-overview-part-i/">Storage for Containers Overview – Part I</a></li>
<li><a href="https://keithtenzer.com/2017/03/24/storage-for-containers-using-gluster-part-ii/">Storage for Containers using Gluster – Part II</a></li>
<li><a href="https://keithtenzer.com/2017/03/29/storage-for-containers-using-container-native-storage-part-iii/">Storage for Containers using Container Native Storage – Part III</a></li>
<li><a href="https://keithtenzer.com/2017/04/07/storage-for-containers-using-ceph-rbd-part-iv/">Storage for Containers using Ceph – Part IV</a></li>
<li><a href="https://keithtenzer.com/2017/04/05/storage-for-containers-using-netapp-ontap-nas-part-v/">Storage for Containers using NetApp ONTAP NAS – Part V</a></li>
<li><a href="https://keithtenzer.com/2017/04/05/storage-for-containers-using-netapp-solidfire-part-vi/">Storage for Containers using NetApp SolidFire – Part VI</a></li>
</ul>
<p>NetApp recently released an open source project known as <a href="https://github.com/netapp/trident">Trident</a>, the first external storage provisioner for <a href="https://kubernetes.io/">Kubernetes</a> leveraging on-premises storage.</p>
<p>Trident enables the use of the new <em>storage class</em> concept in Kubernetes, acting as a provisioning controller that watches for PVCs (persistent volume requests) and creates them on-demand.</p>
<p>This means that when a pod requests storage from a storage class that Trident is responsible for, it will provision a volume that meets those requirements and make it available to the pod in real-time.</p>
<p>To learn more  check-out these  <a href="https://www.youtube.com/playlist?list=PLZdTVI9ql2pFNCfk1UuSeBIV7mxlkfz4J">Trident videos</a>.</p>
<p><!--more--></p>
<p>This is how it works:</p>
<ol>
<li>The OpenShift/Kubernetes Administrator deploys and configures Trident with SolidFire and defines StorageClasses and Quotas.</li>
<li>The developer creates a PVC  with the respective StorageClass.</li>
<li>Trident dynamically provisions storage for the developer.</li>
</ol>
<h3>Installation and Configuration Instructions</h3>
<p>Steps to install and configure NetApp SolidFire backend with Trident in your OpenShift/Kubernetes environment:</p>
<p>1) Ensure OpenShift 3.4+, or OpenShift Origin 1.4+</p>
<p>Create a service account for trident.</p>
<pre>oc create serviceaccount trident
oc adm policy add-cluster-role-to-user storage-admin system:serviceaccount:myproject:trident
oc adm policy add-scc-to-user anyuid system:serviceaccount:myproject:trident
oc adm policy add-role-to-user edit system:serviceaccount:myproject:trident</pre>
<p>You can find detailed  instructions <a href="https://github.com/NetApp/trident#deploying-in-openshift">here</a>.</p>
<p>2) Install 'kubectl' client for Trident install script</p>
<pre><code>curl -LO <a href="https://storage.googleapis.com/kubernetes-release/release/">https://storage.googleapis.com/kubernetes-release/release/</a>$(curl -s <a href="https://storage.googleapis.com/kubernetes-release/release/stable.txt">https://storage.googleapis.com/kubernetes-release/release/stable.txt</a>)/bin/linux/amd64/kubectl</code>
<code>chmod +x ./kubectl </code>
<code>sudo mv ./kubectl /usr/local/bin/kubectl </code></pre>
<p>You can find detailed instructions <a href="https://kubernetes.io/docs/user-guide/prereqs/">here</a>.</p>
<p>3) Download and untar the <a href="https://github.com/NetApp/trident/releases/download/v1.0/trident-installer-1.0.tar.gz">Trident installer bundle</a>.</p>
<p>4) Install iscsi initiater utils on all your OpenShift nodes if not already installed.</p>
<pre>$ sudo yum install iscsi-initiator-utils</pre>
<p>5) Create a VAG (Volume Access Group) name 'trident' on your SolidFire cluster.</p>
<p>6) Add IQNs of all OpenShift nodes to the 'trident' VAG.</p>
<pre>$ sudo cat /etc/iscsi/initiatorname.iscsi</pre>
<p><img class="alignnone size-full wp-image-7863" src="{{ site.baseurl }}/assets/2017/04/screen-shot-2017-03-16-at-11-32-48.png" alt="Screen Shot 2017-03-16 at 11.32.48" width="479" height="463" /></p>
<p>9) Discover iscsi Targets on each node</p>
<pre>$ sudo iscsiadm -m discoverydb -t st -p sf-svip.demo.netapp.com --discover</pre>
<p>10) Login to discovered iscsi targets</p>
<pre>$ sudo iscsiadm -m node -p sf-svip.demo.netapp.com —-login</pre>
<p>11) Enable and start iscsi</p>
<pre>$ sudo systemctl enable iscsi
$ sudo systemctl start iscsi</pre>
<p>Follow instructions <a href="https://github.com/NetApp/netappdvp#configuring-your-docker-host-for-nfs-or-iscsi">here</a> for iscsi multipathing setup.</p>
<p>12) Configure the SolidFire backend. A sample is provided here sample-input/backend-solidfire.json. Copy the edited file to <strong>setup/backed.json </strong></p>
<p>https://gist.github.com/kapilarora/bf73342961aeb7256e04089c097a6055</p>
<p>https://gist.github.com/kapilarora/38b26138e1facb0c03e06c4bbaa42c12</p>
<p>13) Execute Trident installer script.</p>
<pre>$ ./install_trident.sh --namespace myproject --serviceaccount trident</pre>
<p>14) Wait until the deployment is complte. You should see Trident deployment when you execute '<em>oc </em><code><em>get deployment</em>'</code> and trident pod when you execute '<em>oc</em><code><em> get pods</em>'</code></p>
<p>15) If you face issues, check this <a href="https://github.com/NetApp/trident#troubleshooting">troubleshooting</a> session.</p>
<p>16) Register you backend with Trident</p>
<pre><code>$ cat setup/backend.json | kubectl exec -i -- post.sh backend</code></pre>
<p>17) Edit storage-class-gold.yaml to configure your storage class.</p>
<p>https://gist.github.com/kapilarora/e339f780a8651624dcabe457a4e2724f</p>
<p>18) Create storage class in kubernetes:</p>
<pre>$ oc create -f  storage-class-gold.yaml</pre>
<p>19) Trident is now installed and we have also defined a storage class for SolidFire.</p>
<p>20) Now Storage is dynamically provisioned when we create a PVC. e.g.</p>
<p>https://gist.github.com/kapilarora/007266ca364db8dc370f1deadc3ecd08</p>
<h3>Application use-case</h3>
<p>Let us look at how we can deploy a Wordpress application backed by a MySQl database.</p>
<p>In the below example we have use Trident to dynamically provision SolidFire storage for our Wordpress (+ MySQL) application using PVCs and gold StorageClass.</p>
<p><img class=" size-full wp-image-8548 aligncenter" src="{{ site.baseurl }}/assets/2017/04/mysql-wordpress-solidfire-openshift.png" alt="mysql-wordpress-solidfire-openshift" width="1304" height="1014" /></p>
<p>https://gist.github.com/kapilarora/57e6cdfbd618712958ff8e25baaad438</p>
<h3>NetApp SolidFire</h3>
<p>NetApp SolidFire is a <strong>zero-touch, </strong> all flash, scale-out , block-storage system that provides  guaranteed QoS (Quality of Service) to each and every storage volume.</p>
<h3>Why SolidFire?</h3>
<p>NetApp SolidFire offers following key benefits for your applications:</p>
<ol>
<li><strong>Guaranteed QoS</strong>: With SolidFire you can guarantee <strong>minimum</strong>, maximum and burst IOPS to each and every Application Volume.</li>
<li><strong>Zero-touch Storage</strong>: SolidFire requires minimum possible administration and is literally zero touch infrastructure. It enables your infrastructure teams to not worry about Storage systems and performance and concentrate on automation and business focussed tasks.</li>
<li><strong>Scale-out</strong>: SolidFire is a true Scale out storage system which scales upto 100 nodes.</li>
<li><strong>Speed</strong>: SolidFire is a all Flash Storage system to power your most demanding applications.</li>
<li><strong>Automation: </strong>All<strong> </strong>SolidFire <strong> </strong>operations can be performed using REST based APIs.</li>
<li>Always ON<strong> global efficiencies </strong>and<strong> data assurance</strong></li>
</ol>
<h3>Summary</h3>
<p>With NetApp Trident dynamic provisioner NetApp SolidFire <strong>zero-touch</strong> storage can be provisioned on-demand for your containerized applications.</p>
<p>Trident can help you deploy Stateful containerized applications  e.g.  Databases with NetApp SolidFire.</p>
<h3>References</h3>
<ol>
<li><a href="https://github.com/NetApp/trident">NetApp Trident GitHub project</a></li>
<li><a href="http://netapp.io/">NetApp thePub website</a></li>
<li><a href="http://netapp.io/slack/">Join NetApp on Slack</a></li>
<li><a href="http://netapp.io/2017/02/17/using-persistent-storage-openshift-applications-trident/">NetApp Trident and OpenShift</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLZdTVI9ql2pFNCfk1UuSeBIV7mxlkfz4J">Trident Videos</a></li>
</ol>
<p>Happy SolidFireing!</p>
<p>(c) 2017 Keith Tenzer</p>
