<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>AWS Security Lessons Learned - KEITHTENZER.COM</title>
<meta name="description" content="My Story Once upon a time not too long ago, I had a project to transport data in and out of S3 using Java. Things started off rather smoothly. Within about 30 minutes I had my Amazon Web Services (AWS) account active, had the Java SDK pulled into Eclipse through Maven and was testing my first AWS S3 API calls. Everything was fine except I embedded my AWS access key in the code! I spent a few hours prototyping, testing API calls and understanding how I wanted to structure the code for this project. Along the way I got side-tracked, switched to working on other things and eventually came back to my AWS S3 project. At this point I had a pretty good prototype for structuring data in S3 as well as getting data in and out. I wanted to save my work and had forgotten all about the fact that my AWS access key was still embedded in the code. I created a public Github repo and checked in the code, it had been a long day and was about to get much longer... A few hours went by and I got a call from Amazon Web Services, there had been suspicious activity on my account. At this point I started to realise what might have happened and I rushed home. Upon logging in I found 20 XXL EC2 instances running in every AWS region and in just a few hours my bill was already over $700 USD. I couldn&#39;t believe it and thought why on Earth would anyone want to startup EC2 instances? I am just going to delete them, what was the purpose of this? I quickly shutdown all the EC2 instances and expunged them, except one. I wanted to take a closer look and see what was actually running in the instance. Upon gaining access I looked at the process table and saw to my surprise Bitcoin processes running and chewing on the CPU. Bitcoin!!! But of course, it was now so clear, I provided some happy miners free CPU for a few hours and they took full advantage of my stupidity. This was the first time I had ever been hacked or had my security (knowingly) breeched. I felt vulnerable, foolish, and extremely frustrated. Finally I phoned Amazon Web Services and explained what happened. They confirmed and told me that this happens all too often and this kind of theft is on the rise. Bitcoin miners scrub all code sites like Github and search for patterns like &quot;AWS Secret Key&quot;. If they find them, they will try to deploy Bitcoin servers on unsuspecting accounts and why not it is easy money, right? In a quick Github search I found more keys than I knew what to do with, very disturbing. I tried to get Amazon Web Services to track down the culprits but unfortunately they used TOR which masked outbound traffic so there was no way to trace the source. Thankfully Amazon Web Services credited my account so I didn&#39;t have to pay the penalty for my carelessness. What about DevOps? More and more DevOps teams are using the cloud as it enables getting products to market faster in many cases. Many are startups and were born in the cloud. However a growing number are enterprise IT organisations not used to dealing with security in the cloud. Worse, many of these are shadow IT groups, meaning groups that have abandoned their internal IT and gone to the cloud without an enterprise strategy. This is very similar to my personal experience, they are just jumping into the cloud without a complete security strategy. There have already been numerous companies which have had to close their doors due to cloud security breaches and the threat is real. So what is different in the cloud? The main thing is that we are used to working and trusting our internal IT for protecting us. We as developers have become very security complacent and have not had to be responsible for securing our environments. With the cloud that all changes, everyone must be re-trained on security and become stewards for protecting company assets. The firewall is the people. Don&#39;t jump into the cloud until you have your security straight! Lessons Learned  Lesson 1: Don&#39;t just jump into cloud and start doing stuff, ensure you have appropriate security setup for your environment first Lesson 2: Never ever save your AWS access key in code or any file in your code branch. As soon as you do this you have completely compromised your security Lesson 3: Always use multi-factor authentication Lesson 4: Always create an AWS IAM user and always give that IAM user only access to resources it needs through IAM policies before generating AWS keys Lesson 5: Store AWS key in user environment or credentials file outside of code branch Lesson 6: Update and change your keys on regular basis Lesson 7: Consider using only private repos in Github or ensure code is private and not public  Configure AWS Permissions  Create IAM user    Create group for each resource you want to grant for example, one group for S3, another for SNS, etc    Add permissions to the group   How to properly store AWS credentials There are two options for storing the AWS access and secret key. You can either save them in a credentials file or the user environment. I would recommend the user environment and this is typically what I use. Storing AWS key in credentials file  Create the following file: ~/.aws/credentials In the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option. Update the credentials file ~/.aws/credentials  [default] aws_access_key_id=&lt;access key&gt; aws_secret_access_key=&lt;secret key&gt;   Get credentials from credentials file. Below is an example in Java:  [code language=&quot;java&quot;] public AWSCredentials getAWSCredentialsFromFile() throws Exception {      AWSCredentials credentials = null;      try {           credentials = new ProfileCredentialsProvider().getCredentials();      } catch (Exception e) {           throw new Exception (&quot;Cannot load the credentials from the credential profiles file. Please make sure that your credentials file is at the correct location (~/.aws/credentials), and is in valid format.&quot;, e);      }      return credentials; } [/code] Storing AWS key in environment  In the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option. Add access key and secret key to the user&#39;s .bashrc file under ~/.bachrc  AWS_ACCESS_KEY_ID=&lt;access key&gt; AWS_SECRET_ACCESS_KEY=&lt;secret key&gt;   Get the credentials from user environment. Below is an example in Java:  [code language=&quot;java&quot;] public AWSCredentials getAwsCredentialsFromEnvironment() throws IOException {      EnvironmentVariableCredentialsProvider credentials = new EnvironmentVariableCredentialsProvider();      return credentials.getCredentials(); } [/code] (c) 2014 Keith Tenzer &nbsp;">


  <meta name="author" content="Keith Tenzer">
  
  <meta property="article:author" content="Keith Tenzer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="KEITHTENZER.COM">
<meta property="og:title" content="AWS Security Lessons Learned">
<meta property="og:url" content="https://keithtenzer.com/cloud/aws-security-lessons-learned/">


  <meta property="og:description" content="My Story Once upon a time not too long ago, I had a project to transport data in and out of S3 using Java. Things started off rather smoothly. Within about 30 minutes I had my Amazon Web Services (AWS) account active, had the Java SDK pulled into Eclipse through Maven and was testing my first AWS S3 API calls. Everything was fine except I embedded my AWS access key in the code! I spent a few hours prototyping, testing API calls and understanding how I wanted to structure the code for this project. Along the way I got side-tracked, switched to working on other things and eventually came back to my AWS S3 project. At this point I had a pretty good prototype for structuring data in S3 as well as getting data in and out. I wanted to save my work and had forgotten all about the fact that my AWS access key was still embedded in the code. I created a public Github repo and checked in the code, it had been a long day and was about to get much longer... A few hours went by and I got a call from Amazon Web Services, there had been suspicious activity on my account. At this point I started to realise what might have happened and I rushed home. Upon logging in I found 20 XXL EC2 instances running in every AWS region and in just a few hours my bill was already over $700 USD. I couldn&#39;t believe it and thought why on Earth would anyone want to startup EC2 instances? I am just going to delete them, what was the purpose of this? I quickly shutdown all the EC2 instances and expunged them, except one. I wanted to take a closer look and see what was actually running in the instance. Upon gaining access I looked at the process table and saw to my surprise Bitcoin processes running and chewing on the CPU. Bitcoin!!! But of course, it was now so clear, I provided some happy miners free CPU for a few hours and they took full advantage of my stupidity. This was the first time I had ever been hacked or had my security (knowingly) breeched. I felt vulnerable, foolish, and extremely frustrated. Finally I phoned Amazon Web Services and explained what happened. They confirmed and told me that this happens all too often and this kind of theft is on the rise. Bitcoin miners scrub all code sites like Github and search for patterns like &quot;AWS Secret Key&quot;. If they find them, they will try to deploy Bitcoin servers on unsuspecting accounts and why not it is easy money, right? In a quick Github search I found more keys than I knew what to do with, very disturbing. I tried to get Amazon Web Services to track down the culprits but unfortunately they used TOR which masked outbound traffic so there was no way to trace the source. Thankfully Amazon Web Services credited my account so I didn&#39;t have to pay the penalty for my carelessness. What about DevOps? More and more DevOps teams are using the cloud as it enables getting products to market faster in many cases. Many are startups and were born in the cloud. However a growing number are enterprise IT organisations not used to dealing with security in the cloud. Worse, many of these are shadow IT groups, meaning groups that have abandoned their internal IT and gone to the cloud without an enterprise strategy. This is very similar to my personal experience, they are just jumping into the cloud without a complete security strategy. There have already been numerous companies which have had to close their doors due to cloud security breaches and the threat is real. So what is different in the cloud? The main thing is that we are used to working and trusting our internal IT for protecting us. We as developers have become very security complacent and have not had to be responsible for securing our environments. With the cloud that all changes, everyone must be re-trained on security and become stewards for protecting company assets. The firewall is the people. Don&#39;t jump into the cloud until you have your security straight! Lessons Learned  Lesson 1: Don&#39;t just jump into cloud and start doing stuff, ensure you have appropriate security setup for your environment first Lesson 2: Never ever save your AWS access key in code or any file in your code branch. As soon as you do this you have completely compromised your security Lesson 3: Always use multi-factor authentication Lesson 4: Always create an AWS IAM user and always give that IAM user only access to resources it needs through IAM policies before generating AWS keys Lesson 5: Store AWS key in user environment or credentials file outside of code branch Lesson 6: Update and change your keys on regular basis Lesson 7: Consider using only private repos in Github or ensure code is private and not public  Configure AWS Permissions  Create IAM user    Create group for each resource you want to grant for example, one group for S3, another for SNS, etc    Add permissions to the group   How to properly store AWS credentials There are two options for storing the AWS access and secret key. You can either save them in a credentials file or the user environment. I would recommend the user environment and this is typically what I use. Storing AWS key in credentials file  Create the following file: ~/.aws/credentials In the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option. Update the credentials file ~/.aws/credentials  [default] aws_access_key_id=&lt;access key&gt; aws_secret_access_key=&lt;secret key&gt;   Get credentials from credentials file. Below is an example in Java:  [code language=&quot;java&quot;] public AWSCredentials getAWSCredentialsFromFile() throws Exception {      AWSCredentials credentials = null;      try {           credentials = new ProfileCredentialsProvider().getCredentials();      } catch (Exception e) {           throw new Exception (&quot;Cannot load the credentials from the credential profiles file. Please make sure that your credentials file is at the correct location (~/.aws/credentials), and is in valid format.&quot;, e);      }      return credentials; } [/code] Storing AWS key in environment  In the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option. Add access key and secret key to the user&#39;s .bashrc file under ~/.bachrc  AWS_ACCESS_KEY_ID=&lt;access key&gt; AWS_SECRET_ACCESS_KEY=&lt;secret key&gt;   Get the credentials from user environment. Below is an example in Java:  [code language=&quot;java&quot;] public AWSCredentials getAwsCredentialsFromEnvironment() throws IOException {      EnvironmentVariableCredentialsProvider credentials = new EnvironmentVariableCredentialsProvider();      return credentials.getCredentials(); } [/code] (c) 2014 Keith Tenzer &nbsp;">





  <meta name="twitter:site" content="@keithtenzer">
  <meta name="twitter:title" content="AWS Security Lessons Learned">
  <meta name="twitter:description" content="My Story Once upon a time not too long ago, I had a project to transport data in and out of S3 using Java. Things started off rather smoothly. Within about 30 minutes I had my Amazon Web Services (AWS) account active, had the Java SDK pulled into Eclipse through Maven and was testing my first AWS S3 API calls. Everything was fine except I embedded my AWS access key in the code! I spent a few hours prototyping, testing API calls and understanding how I wanted to structure the code for this project. Along the way I got side-tracked, switched to working on other things and eventually came back to my AWS S3 project. At this point I had a pretty good prototype for structuring data in S3 as well as getting data in and out. I wanted to save my work and had forgotten all about the fact that my AWS access key was still embedded in the code. I created a public Github repo and checked in the code, it had been a long day and was about to get much longer... A few hours went by and I got a call from Amazon Web Services, there had been suspicious activity on my account. At this point I started to realise what might have happened and I rushed home. Upon logging in I found 20 XXL EC2 instances running in every AWS region and in just a few hours my bill was already over $700 USD. I couldn&#39;t believe it and thought why on Earth would anyone want to startup EC2 instances? I am just going to delete them, what was the purpose of this? I quickly shutdown all the EC2 instances and expunged them, except one. I wanted to take a closer look and see what was actually running in the instance. Upon gaining access I looked at the process table and saw to my surprise Bitcoin processes running and chewing on the CPU. Bitcoin!!! But of course, it was now so clear, I provided some happy miners free CPU for a few hours and they took full advantage of my stupidity. This was the first time I had ever been hacked or had my security (knowingly) breeched. I felt vulnerable, foolish, and extremely frustrated. Finally I phoned Amazon Web Services and explained what happened. They confirmed and told me that this happens all too often and this kind of theft is on the rise. Bitcoin miners scrub all code sites like Github and search for patterns like &quot;AWS Secret Key&quot;. If they find them, they will try to deploy Bitcoin servers on unsuspecting accounts and why not it is easy money, right? In a quick Github search I found more keys than I knew what to do with, very disturbing. I tried to get Amazon Web Services to track down the culprits but unfortunately they used TOR which masked outbound traffic so there was no way to trace the source. Thankfully Amazon Web Services credited my account so I didn&#39;t have to pay the penalty for my carelessness. What about DevOps? More and more DevOps teams are using the cloud as it enables getting products to market faster in many cases. Many are startups and were born in the cloud. However a growing number are enterprise IT organisations not used to dealing with security in the cloud. Worse, many of these are shadow IT groups, meaning groups that have abandoned their internal IT and gone to the cloud without an enterprise strategy. This is very similar to my personal experience, they are just jumping into the cloud without a complete security strategy. There have already been numerous companies which have had to close their doors due to cloud security breaches and the threat is real. So what is different in the cloud? The main thing is that we are used to working and trusting our internal IT for protecting us. We as developers have become very security complacent and have not had to be responsible for securing our environments. With the cloud that all changes, everyone must be re-trained on security and become stewards for protecting company assets. The firewall is the people. Don&#39;t jump into the cloud until you have your security straight! Lessons Learned  Lesson 1: Don&#39;t just jump into cloud and start doing stuff, ensure you have appropriate security setup for your environment first Lesson 2: Never ever save your AWS access key in code or any file in your code branch. As soon as you do this you have completely compromised your security Lesson 3: Always use multi-factor authentication Lesson 4: Always create an AWS IAM user and always give that IAM user only access to resources it needs through IAM policies before generating AWS keys Lesson 5: Store AWS key in user environment or credentials file outside of code branch Lesson 6: Update and change your keys on regular basis Lesson 7: Consider using only private repos in Github or ensure code is private and not public  Configure AWS Permissions  Create IAM user    Create group for each resource you want to grant for example, one group for S3, another for SNS, etc    Add permissions to the group   How to properly store AWS credentials There are two options for storing the AWS access and secret key. You can either save them in a credentials file or the user environment. I would recommend the user environment and this is typically what I use. Storing AWS key in credentials file  Create the following file: ~/.aws/credentials In the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option. Update the credentials file ~/.aws/credentials  [default] aws_access_key_id=&lt;access key&gt; aws_secret_access_key=&lt;secret key&gt;   Get credentials from credentials file. Below is an example in Java:  [code language=&quot;java&quot;] public AWSCredentials getAWSCredentialsFromFile() throws Exception {      AWSCredentials credentials = null;      try {           credentials = new ProfileCredentialsProvider().getCredentials();      } catch (Exception e) {           throw new Exception (&quot;Cannot load the credentials from the credential profiles file. Please make sure that your credentials file is at the correct location (~/.aws/credentials), and is in valid format.&quot;, e);      }      return credentials; } [/code] Storing AWS key in environment  In the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option. Add access key and secret key to the user&#39;s .bashrc file under ~/.bachrc  AWS_ACCESS_KEY_ID=&lt;access key&gt; AWS_SECRET_ACCESS_KEY=&lt;secret key&gt;   Get the credentials from user environment. Below is an example in Java:  [code language=&quot;java&quot;] public AWSCredentials getAwsCredentialsFromEnvironment() throws IOException {      EnvironmentVariableCredentialsProvider credentials = new EnvironmentVariableCredentialsProvider();      return credentials.getCredentials(); } [/code] (c) 2014 Keith Tenzer &nbsp;">
  <meta name="twitter:url" content="https://keithtenzer.com/cloud/aws-security-lessons-learned/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2014-12-03T00:00:00-08:00">





  

  


<link rel="canonical" href="https://keithtenzer.com/cloud/aws-security-lessons-learned/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Keith Tenzer",
      "url": "https://keithtenzer.com/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="KEITHTENZER.COM Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          KEITHTENZER.COM
          <span class="site-subtitle">Cloud Computing and Code</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/index.html">About</a>
            </li><li class="masthead__menu-item">
              <a href="/conferences-and-events/index.html">Conferences and Events</a>
            </li><li class="masthead__menu-item">
              <a href="/videos/index.html">Videos</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://keithtenzer.com/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#cloud" itemprop="item"><span itemprop="name">Cloud</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">AWS Security Lessons Learned</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/main/me.png" alt="Keith Tenzer" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Keith Tenzer</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Principal Solutions Architect at Red Hat</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Los Angeles, CA</span>
        </li>
      

      
        
          
        
          
        
          
            <li><a href="https://twitter.com/keithtenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="AWS Security Lessons Learned">
    <meta itemprop="description" content="My StoryOnce upon a time not too long ago, I had a project to transport data in and out of S3 using Java. Things started off rather smoothly. Within about 30 minutes I had my Amazon Web Services (AWS) account active, had the Java SDK pulled into Eclipse through Maven and was testing my first AWS S3 API calls. Everything was fine except I embedded my AWS access key in the code! I spent a few hours prototyping, testing API calls and understanding how I wanted to structure the code for this project. Along the way I got side-tracked, switched to working on other things and eventually came back to my AWS S3 project. At this point I had a pretty good prototype for structuring data in S3 as well as getting data in and out. I wanted to save my work and had forgotten all about the fact that my AWS access key was still embedded in the code. I created a public Github repo and checked in the code, it had been a long day and was about to get much longer...A few hours went by and I got a call from Amazon Web Services, there had been suspicious activity on my account. At this point I started to realise what might have happened and I rushed home. Upon logging in I found 20 XXL EC2 instances running in every AWS region and in just a few hours my bill was already over $700 USD. I couldn&#39;t believe it and thought why on Earth would anyone want to startup EC2 instances? I am just going to delete them, what was the purpose of this?I quickly shutdown all the EC2 instances and expunged them, except one. I wanted to take a closer look and see what was actually running in the instance. Upon gaining access I looked at the process table and saw to my surprise Bitcoin processes running and chewing on the CPU. Bitcoin!!! But of course, it was now so clear, I provided some happy miners free CPU for a few hours and they took full advantage of my stupidity. This was the first time I had ever been hacked or had my security (knowingly) breeched. I felt vulnerable, foolish, and extremely frustrated.Finally I phoned Amazon Web Services and explained what happened. They confirmed and told me that this happens all too often and this kind of theft is on the rise. Bitcoin miners scrub all code sites like Github and search for patterns like &quot;AWS Secret Key&quot;. If they find them, they will try to deploy Bitcoin servers on unsuspecting accounts and why not it is easy money, right? In a quick Github search I found more keys than I knew what to do with, very disturbing. I tried to get Amazon Web Services to track down the culprits but unfortunately they used TOR which masked outbound traffic so there was no way to trace the source. Thankfully Amazon Web Services credited my account so I didn&#39;t have to pay the penalty for my carelessness.What about DevOps?More and more DevOps teams are using the cloud as it enables getting products to market faster in many cases. Many are startups and were born in the cloud. However a growing number are enterprise IT organisations not used to dealing with security in the cloud. Worse, many of these are shadow IT groups, meaning groups that have abandoned their internal IT and gone to the cloud without an enterprise strategy. This is very similar to my personal experience, they are just jumping into the cloud without a complete security strategy. There have already been numerous companies which have had to close their doors due to cloud security breaches and the threat is real. So what is different in the cloud? The main thing is that we are used to working and trusting our internal IT for protecting us. We as developers have become very security complacent and have not had to be responsible for securing our environments. With the cloud that all changes, everyone must be re-trained on security and become stewards for protecting company assets. The firewall is the people. Don&#39;t jump into the cloud until you have your security straight!Lessons LearnedLesson 1: Don&#39;t just jump into cloud and start doing stuff, ensure you have appropriate security setup for your environment firstLesson 2: Never ever save your AWS access key in code or any file in your code branch. As soon as you do this you have completely compromised your securityLesson 3: Always use multi-factor authenticationLesson 4: Always create an AWS IAM user and always give that IAM user only access to resources it needs through IAM policies before generating AWS keysLesson 5: Store AWS key in user environment or credentials file outside of code branchLesson 6: Update and change your keys on regular basisLesson 7: Consider using only private repos in Github or ensure code is private and not publicConfigure AWS PermissionsCreate IAM userCreate group for each resource you want to grant for example, one group for S3, another for SNS, etcAdd permissions to the groupHow to properly store AWS credentialsThere are two options for storing the AWS access and secret key. You can either save them in a credentials file or the user environment. I would recommend the user environment and this is typically what I use.Storing AWS key in credentials fileCreate the following file: ~/.aws/credentialsIn the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option.Update the credentials file ~/.aws/credentials[default]aws_access_key_id=&lt;access key&gt;aws_secret_access_key=&lt;secret key&gt;Get credentials from credentials file. Below is an example in Java:[code language=&quot;java&quot;]public AWSCredentials getAWSCredentialsFromFile() throws Exception {     AWSCredentials credentials = null;     try {          credentials = new ProfileCredentialsProvider().getCredentials();     } catch (Exception e) {          throw new Exception (&quot;Cannot load the credentials from the credential profiles file. Please make sure that your credentials file is at the correct location (~/.aws/credentials), and is in valid format.&quot;, e);     }     return credentials;}[/code]Storing AWS key in environmentIn the AWS console go to the user and create new access key by selecting the &quot;manage access keys&quot; option.Add access key and secret key to the user&#39;s .bashrc file under ~/.bachrcAWS_ACCESS_KEY_ID=&lt;access key&gt;AWS_SECRET_ACCESS_KEY=&lt;secret key&gt;Get the credentials from user environment. Below is an example in Java:[code language=&quot;java&quot;]public AWSCredentials getAwsCredentialsFromEnvironment() throws IOException {     EnvironmentVariableCredentialsProvider credentials = new EnvironmentVariableCredentialsProvider();     return credentials.getCredentials();}[/code](c) 2014 Keith Tenzer&nbsp;">
    <meta itemprop="datePublished" content="2014-12-03T00:00:00-08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">AWS Security Lessons Learned
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2014-12-03T00:00:00-08:00">December 3, 2014</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h3>My Story</h3>
<p>Once upon a time not too long ago, I had a project to transport data in and out of S3 using Java. Things started off rather smoothly. Within about 30 minutes I had my Amazon Web Services (AWS) account active, had the Java SDK pulled into Eclipse through Maven and was testing my first AWS S3 API calls. <!--more-->Everything was fine except I embedded my AWS access key in the code! I spent a few hours prototyping, testing API calls and understanding how I wanted to structure the code for this project. Along the way I got side-tracked, switched to working on other things and eventually came back to my AWS S3 project. At this point I had a pretty good prototype for structuring data in S3 as well as getting data in and out. I wanted to save my work and had forgotten all about the fact that my AWS access key was still embedded in the code. I created a public Github repo and checked in the code, it had been a long day and was about to get much longer...</p>
<p>A few hours went by and I got a call from Amazon Web Services, there had been suspicious activity on my account. At this point I started to realise what might have happened and I rushed home. Upon logging in I found 20 XXL EC2 instances running in every AWS region and in just a few hours my bill was already over $700 USD. I couldn't believe it and thought why on Earth would anyone want to startup EC2 instances? I am just going to delete them, what was the purpose of this?</p>
<p>I quickly shutdown all the EC2 instances and expunged them, except one. I wanted to take a closer look and see what was actually running in the instance. Upon gaining access I looked at the process table and saw to my surprise Bitcoin processes running and chewing on the CPU. Bitcoin!!! But of course, it was now so clear, I provided some happy miners free CPU for a few hours and they took full advantage of my stupidity. This was the first time I had ever been hacked or had my security (knowingly) breeched. I felt vulnerable, foolish, and extremely frustrated.</p>
<p>Finally I phoned Amazon Web Services and explained what happened. They confirmed and told me that this happens all too often and this kind of theft is on the rise. Bitcoin miners scrub all code sites like Github and search for patterns like "AWS Secret Key". If they find them, they will try to deploy Bitcoin servers on unsuspecting accounts and why not it is easy money, right? In a quick Github search I found more keys than I knew what to do with, very disturbing. I tried to get Amazon Web Services to track down the culprits but unfortunately they used TOR which masked outbound traffic so there was no way to trace the source. Thankfully Amazon Web Services credited my account so I didn't have to pay the penalty for my carelessness.</p>
<h3>What about DevOps?</h3>
<p>More and more DevOps teams are using the cloud as it enables getting products to market faster in many cases. Many are startups and were born in the cloud. However a growing number are enterprise IT organisations not used to dealing with security in the cloud. Worse, many of these are shadow IT groups, meaning groups that have abandoned their internal IT and gone to the cloud without an enterprise strategy. This is very similar to my personal experience, they are just jumping into the cloud without a complete security strategy. There have already been numerous companies which have had to close their doors due to cloud security breaches and the threat is real. So what is different in the cloud? The main thing is that we are used to working and trusting our internal IT for protecting us. We as developers have become very security complacent and have not had to be responsible for securing our environments. With the cloud that all changes, everyone must be re-trained on security and become stewards for protecting company assets. The firewall is the people. Don't jump into the cloud until you have your security straight!</p>
<h3>Lessons Learned</h3>
<ul>
<li>Lesson 1: Don't just jump into cloud and start doing stuff, ensure you have appropriate security setup for your environment first</li>
<li>Lesson 2: Never ever save your AWS access key in code or any file in your code branch. As soon as you do this you have completely compromised your security</li>
<li>Lesson 3: Always use <a href="https://aws.amazon.com/iam/details/mfa/">multi-factor authentication</a></li>
<li>Lesson 4: Always create an AWS IAM user and always give that IAM user only access to resources it needs through<a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/PoliciesOverview.html"> IAM policies</a> before generating AWS keys</li>
<li>Lesson 5: Store AWS key in user environment or credentials file outside of code branch</li>
<li>Lesson 6: Update and change your keys on regular basis</li>
<li>Lesson 7: Consider using only private repos in Github or ensure code is private and not public</li>
</ul>
<h3>Configure AWS Permissions</h3>
<ul>
<li>Create IAM user</li>
</ul>
<p><a href="https://keithtenzer.files.wordpress.com/2014/12/screen-shot-2014-12-01-at-17-31-23.png"><img class="  wp-image-48 aligncenter" src="/assets/2014/12/screen-shot-2014-12-01-at-17-31-23.png?w=300" alt="Screen Shot 2014-12-01 at 17.31.23" width="635" height="273" /></a></p>
<ul>
<li><span style="font-family:'Noto Sans', sans-serif;line-height:1.5;">Create group for each resource you want to grant for example, one group for S3, another for SNS, etc</span></li>
</ul>
<p><a href="https://keithtenzer.files.wordpress.com/2014/12/screen-shot-2014-12-01-at-17-25-51.png"><img class="  wp-image-46 aligncenter" src="/assets/2014/12/screen-shot-2014-12-01-at-17-25-51.png?w=300" alt="Screen Shot 2014-12-01 at 17.25.51" width="624" height="179" /></a></p>
<ul>
<li>Add permissions to the group</li>
</ul>
<p><a href="https://keithtenzer.files.wordpress.com/2014/12/screen-shot-2014-12-01-at-17-28-39.png"><img class="  wp-image-47 aligncenter" src="/assets/2014/12/screen-shot-2014-12-01-at-17-28-39.png?w=300" alt="Screen Shot 2014-12-01 at 17.28.39" width="619" height="339" /></a></p>
<h3>How to properly store AWS credentials</h3>
<p>There are two options for storing the AWS access and secret key. You can either save them in a credentials file or the user environment. I would recommend the user environment and this is typically what I use.</p>
<h4>Storing AWS key in credentials file</h4>
<ul>
<li>Create the following file: ~/.aws/credentials</li>
<li>In the AWS console go to the user and create new access key by selecting the "manage access keys" option.</li>
<li>Update the credentials file ~/.aws/credentials
<ul>
<li><span class="s1">[</span><span class="s2">default</span><span class="s1">]</span></li>
<li>aws_access_key_id=&lt;access key&gt;</li>
<li><span class="s2">aws_secret_access_key</span>=&lt;secret key&gt;</li>
</ul>
</li>
<li>Get credentials from credentials file. Below is an example in Java:</li>
</ul>
<p>[code language="java"]<br />
public AWSCredentials getAWSCredentialsFromFile() throws Exception {<br />
     AWSCredentials credentials = null;<br />
     try {<br />
          credentials = new ProfileCredentialsProvider().getCredentials();<br />
     } catch (Exception e) {<br />
          throw new Exception (&quot;Cannot load the credentials from the credential profiles file. Please make sure that your credentials file is at the correct location (~/.aws/credentials), and is in valid format.&quot;, e);<br />
     }<br />
     return credentials;<br />
}<br />
[/code]</p>
<h4>Storing AWS key in environment</h4>
<ul>
<li>In the AWS console go to the user and create new access key by selecting the "manage access keys" option.</li>
<li>Add access key and secret key to the user's .bashrc file under ~/.bachrc
<ul>
<li>AWS_ACCESS_KEY_ID=&lt;access key&gt;</li>
<li>AWS_SECRET_ACCESS_KEY=&lt;secret key&gt;</li>
</ul>
</li>
<li>Get the credentials from user environment. Below is an example in Java:</li>
</ul>
<p>[code language="java"]</p>
<p>public AWSCredentials getAwsCredentialsFromEnvironment() throws IOException {</p>
<p>     EnvironmentVariableCredentialsProvider credentials = new EnvironmentVariableCredentialsProvider();<br />
     return credentials.getCredentials();<br />
}<br />
[/code]</p>
<p>(c) 2014 Keith Tenzer</p>
<p>&nbsp;</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">AWS</a><span class="sep">, </span>
    
      <a href="/tags/#cloud" class="page__taxonomy-item" rel="tag">Cloud</a><span class="sep">, </span>
    
      <a href="/tags/#devops" class="page__taxonomy-item" rel="tag">DevOps</a><span class="sep">, </span>
    
      <a href="/tags/#java" class="page__taxonomy-item" rel="tag">Java</a><span class="sep">, </span>
    
      <a href="/tags/#security" class="page__taxonomy-item" rel="tag">Security</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#cloud" class="page__taxonomy-item" rel="tag">Cloud</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-12-03T00:00:00-08:00">December 3, 2014</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=keithtenzer&text=AWS+Security+Lessons+Learned%20https%3A%2F%2Fkeithtenzer.com%2Fcloud%2Faws-security-lessons-learned%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkeithtenzer.com%2Fcloud%2Faws-security-lessons-learned%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkeithtenzer.com%2Fcloud%2Faws-security-lessons-learned%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/general/the-meaning-of-midnight-code-junkie/" class="pagination--pager" title="The meaning of “midnight code junkie”
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-service-mesh-getting-started-guide/" rel="permalink">OpenShift Service Mesh Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-04-27T00:00:00-07:00">April 27, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">






Overview
In this article we will explore the OpenShift Service Mesh and deploy a demo application to better understand the various concepts. First you...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-4-aws-ipi-installation-getting-started-guide/" rel="permalink">OpenShift 4 AWS IPI Installation Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-01-18T00:00:00-08:00">January 18, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">


Happy new year as this will be the first post of 2021! 2020 was obviously a challenging year, my hope is I will have more time to devote to blogging in 20...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ansible/windows-automation-with-ansible-getting-started-guide/" rel="permalink">Windows Automation with Ansible: Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-05-19T00:00:00-07:00">May 19, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
In this article we will focus on how to get started with automation of windows using Ansible. Specifically we will look at installing 3rd party sof...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/general/red-hat-subscription-reporting-guide/" rel="permalink">Red Hat Subscription Reporting Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-05-13T00:00:00-07:00">May 13, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
source: https://www.cio.com/article/3199910/zuora-blazes-a-new-trail-to-the-subscription-economy-and-a-post-erp-world.html
Overview
This article will look a...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/keithtenzer"" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Keith Tenzer. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
