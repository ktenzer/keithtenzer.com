<h3><img class="alignnone size-full wp-image-3655" src="/assets/2017/03/screenshot-from-2016-08-04-144007.png" alt="Screenshot from 2016-08-04 14:40:07" width="1834" height="615" /></h3>
<h3>Overview</h3>
<p>In this article we will setup a OpenShift Enterprise 3.4 all-in-one configuration.</p>
<p>OpenShift has several different roles: masters, nodes, etcd and load balancers. An all-in-one setup means running all service on a single system. Since we are only using a single system a load balancer or ha-proxy won't be configured. If you would like to read more about OpenShift I can recommend the following:</p>
<ul>
<li><a href="https://blog.openshift.com/">General OpenShift Product Blogs</a></li>
<li><a href="https://keithtenzer.com/2015/08/20/openshift-v3-unlocking-the-power-of-persistent-storage/">Persistent Storage</a></li>
<li><a href="http://www.opensourcerers.org/openshift-3-1-networking-from-a-containerworkload-point-of-view-part-1-container-networking-on-a-plain-docker-host/">OpenShift Networking Part I</a></li>
<li><a href="http://www.opensourcerers.org/openshift-networking-from-a-containerworkload-point-of-view-part-2-container-networking-on-an-openshift-node/">OpenShift Networking Part II</a></li>
<li><a href="https://keithtenzer.com/2016/11/21/openshift-enterprise-3-3-all-in-one-lab-environment-with-jenkins-build-pipeline/">Aggregate Logging, Metrics, CloudForms and Jenkins Integration</a></li>
<li><a href="https://keithtenzer.com/2016/08/11/openshift-v3-basic-release-deployment-scenarios/">Deployment Scenarios</a></li>
<li><a href="https://keithtenzer.com/2016/10/14/enterprise-container-platform-in-the-cloud-openshift-on-azure-secured-by-azure-ad/">OpenShift on Azure</a></li>
</ul>
<p><!--more--></p>
<h3>Prerequisites</h3>
<p>Configure a VM with following:</p>
<ul>
<li>RHEL 7.3</li>
<li>2 CPUs</li>
<li>4096 RAM</li>
<li>30GB disk for OS</li>
<li>25GB disk for docker images</li>
</ul>
<pre class="nowrap"># subscription-manager repos --disable="*"
# subscription-manager repos \
    --enable="rhel-7-server-rpms" \
    --enable="rhel-7-server-extras-rpms" \
    --enable="rhel-7-server-ose-3.4-rpms"</pre>
<pre class="nowrap"># yum install wget git net-tools bind-utils iptables-services bridge-utils bash-completion</pre>
<pre class="nowrap"># yum update -y</pre>
<pre class="nowrap"># yum install -y atomic-openshift-utils</pre>
<pre class="nowrap"># yum install atomic-openshift-excluder atomic-openshift-docker-excluder</pre>
<pre class="nowrap"># atomic-openshift-excluder unexclude</pre>
<pre class="nowrap"># yum install -y docker</pre>
<pre># vi /etc/sysconfig/docker
OPTIONS='--selinux-enabled --insecure-registry 172.30.0.0/16'</pre>
<pre class="nowrap"># cat &lt; /etc/sysconfig/docker-storage-setup
DEVS=/dev/vdb
VG=docker-vg
EOF</pre>
<pre class="nowrap"># docker-storage-setup</pre>
<pre># systemctl enable docker</pre>
<pre># systemctl start docker</pre>
<pre># ssh-keygen</pre>
<pre># ssh-copy-id -i /root/.ssh/id_rsa-pub ose3-master.lab.com</pre>
<pre>#vi /etc/hosts

192.168.122.60  ose3-master.lab.com     ose3-master</pre>
<pre class="nowrap"># systemctl reboot</pre>
<h3>Install OpenShift.</h3>
<p>Here we are enabling ovs-subnet SDN and setting authentication to use htpasswd. This is the most basic configuration as we are doing an all-in-one setup. For actual deployments you would want multi-master, dedicated nodes and seperate nodes for handling etcd.</p>
<pre>#Create an OSEv3 group that contains the masters and nodes groups
[OSEv3:children]
masters
nodes

# Set variables common for all OSEv3 hosts
[OSEv3:vars]
# SSH user, this user should allow ssh based auth without requiring a password
ansible_ssh_user=root

# If ansible_ssh_user is not root, ansible_become must be set to true
#ansible_become=true

deployment_type=openshift-enterprise

# uncomment the following to enable htpasswd authentication; defaults to DenyAllPasswordIdentityProvider
openshift_master_identity_providers=[{'name': 'htpasswd_auth', 'login': 'true', 'challenge': 'true', 'kind': 'HTPasswdPasswordIdentityProvider', 'filename': '/etc/origin/master/htpasswd'}]

# host group for masters
[masters]
ose3-master.lab.com

# host group for nodes, includes region info
[nodes]
<a href="http://ose3-master.lab.com/" target="_blank">ose3-master.lab.com</a> openshift_schedulable=True</pre>
<p>Run Ansible playbook to install and configure OpenShift.</p>
<pre class="nowrap"># ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/byo/config.yml</pre>
<h3>Configure OpenShift</h3>
<p>Create local admin account and enable permissions.</p>
<pre>[root@ose3-master ~]#oc login -u system:admin -n default</pre>
<pre>[root@ose3-master ~]#htpasswd -c /etc/origin/master/htpasswd admin</pre>
<pre>[root@ose3-master ~]#oadm policy add-cluster-role-to-user cluster-admin admin</pre>
<pre>[root@ose3-master ~]#oc login -u admin -n default</pre>
<p>Configure OpenShift image registry. Image streams are stored in registry. When you build application, your application code will be added as a image stream. This enables S2I (Source to Image) and allows for fast build times.</p>
<pre>[root@ose3-master ~]#oadm registry --service-account=registry \
--config=/etc/origin/master/admin.kubeconfig \
--images='registry.access.redhat.com/openshift3/ose-${component}:${version}'</pre>
<p>Configure OpenShift router. The OpenShift router is basically an HA-Proxy that sends incoming service requests to node where pod is running.</p>
<pre>[root@ose3-master ~]#oadm router router --replicas=1 \
    --credentials='/etc/origin/master/openshift-router.kubeconfig' \
    --service-account=router</pre>
<h3>Summary</h3>
<p>In this article we have seen how to configure an OpenShift 3.4 all-in-one lab environment. We have also seen how install and configuration can be adapted through ansible playbook. This environment is intended to be for a Lab and as such no best practices are given in regards to OpenShift. If you have any feedback please share.</p>
<p>Happy OpenShifting!</p>
<p>(c) 2017 Keith Tenzer</p>
