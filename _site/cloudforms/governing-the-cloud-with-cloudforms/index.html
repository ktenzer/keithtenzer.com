<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
<link rel="icon" href="/assets/main/me.png">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Governing the Cloud with CloudForms - Keith Tenzer’s Blog</title>
<meta name="description" content="Overview In a previous article it was stated that cloud in not a technology but rather an architectural methodology of resource governance that utilizes underlying virtualization technologies. Since cloud is more about the methodology, the technology platforms such as VMware vCenter, Red Hat Virtualization Management (RHEVM), Microsoft System Center, Amazon EC2 and OpenStack can change as application requirements or life cycles change. An application may start on a virtualization platform like VMware but over time move to a cloud platform such as OpenStack. It could even have components serviced by both. This is the exact concept behind what Gartner talks about when they refer to Bi-Modal IT. Gartner also says 50% of companies will screw this up. A bridge is definitely needed for managing applications between these various platforms. Red Hat CloudForms is exactly that bridge. It allows us to create an abstraction above the virtualization platforms so that governance and business process can remain consistent across the cloud. In this article we will take a look at how to setup governance of cloud resources using CloudForms. If you are new to CloudForms I would suggest reading this article to get a proper introduction. Before we get into creating policies that define resource governance in the cloud, we need to enable a few advanced features in CloudForms. &quot;Capacity and Utilization&quot; is needed for more detailed reporting and &quot;SmartState Analysis&quot; is required to get visibility inside virtual machines. Configure Capcity and Utilization CloudForms connects to infrastructure or cloud providers in order to report capacity and utilization. Therefore it is important to ensure the provider itself is collecting and reporting information. In this case we will configure Red Hat Enterprise Virtualization Management (RHEVM) provider to display capacity and utilization in CloudForms. Some steps are of course provider specific, in this case RHEVM specific. Configure RHEVM In RHEVM we need to configure reporting database user and allow remote access to the database. #psql -U postgres CREATE ROLE newuser LOGIN UNENCRYPTED PASSWORD &#39;newuserpassword&#39; SUPERUSER VALID UNTIL &#39;infinity&#39;; \q #iptables -I INPUT -p tcp -m tcp --dport 5432 -j ACCEPT #service  iptables  save #vi /var/lib/pgsql/data/pg_hba.conf host    all      all    0.0.0.0/0     md5 #vi /var/lib/pgsql/data/postgresql.conf listen_addresses  =  &#39;*&#39;  #service  postgresql  reload  Configure CloudForms Once our reporting user and provider database is configured it is time to enable capacity and utilization in CloudForms. Ensure all server roles are enabled except &quot;Database Synchronization&quot; and &quot;RHN Mirror&quot;.  &nbsp; Under &quot;Configure-&gt;Configure&quot; set the capacity and utilization policy for the CloudForms region. In this case we will enable all clusters and datastores.  Configure Smart State Analysis SmartState analysis allows us to look inside virtual machines. CloudForms does this by mounting datastores and peering inside the virtual disks. CloudForms is able to see user accounts, installed packages and configuration files for given virtual machine. This data enables us to create resource governance policies as you will see later. Under &quot;Configuration-&gt;Configuration-&gt;Settings&quot; edit the zone and enter IP of the CloudForms appliance you want to act as smart proxy. This is the system that will mount and connect to virtual machines for SmartState analysis. As such the CloudForms appliance requires access to shared storage used for datastores.  Finally the last step is to make CloudForms aware of what virtual machines are hosting CloudForm appliances. Under &quot;Infrastructure-&gt;Virtual Machines&quot; select appropriate virtual machine and edit management engine relationship. You can then match the virtual machine with the appropriate CloudForms engine. Note: this is new in CloudForms 3.2. Previously you would configure this under &quot;Configure-&gt;Configure-&gt;Smart Proxies&quot;.   At this point we have configured both capacity and utilization in addition to SmartState analysis. You can now gather SmartState information about hosts and virtual machine by selecting &quot;Perform SmartState Analysis&quot; under configuration of host or virtual machine. Ideally you would create a schedule that runs the SmartState analysis on a regular interval for all hosts and virtual machines. You could also however create a control policy that runs SmartState analysis whenever hosts or virtual machines are started. Governance Policies CloudForms has two types of governance policies: compliance and control. Compliance policies are scheduled or run manually and check the compliance state of hosts or virtual machines. If a host or virtual machine is found out of compliance an action can be taken. Control policies differ only slightly in that a control policy is run based on an event occurring, so these are automated policies based on events where compliance policies are manually operated or scheduled via the administrator. This may be a bit confusing at first but let me give an example. Lets suppose you want to protect against a known security vulnerability in virtual machines. You have two options and the only difference really is when do you check for vulnerability? If you check at a given time decided by administrator you would create compliance policy. If you check based on event happening like the virtual machine starting you would create a control policy. CloudForms Terminology Below is terminology relating to policies in CloudForms: Policy Profile - Grouping of policies that can be applied to hosts or virtual machines. Policy - Defines conditions and actions. Can be triggered by user in case of compliance policy or event in case of control policy. Condition - Tests for a desired or non-desired state. Can be true or false. Conditions are used to trigger actions. Action - Triggered based on condition matching true or false. Event - Only relating to control policy, this is what triggers the control policy to execute. Create Compliance Policy In this example we will create a compliance policy that checks if the firewall is disabled on hypervisor hosts. If the firewall is disabled the condition would be true and an action will set those hosts to non-compliant. Under &quot;Control-&gt;Explorer&quot; select the policies accordion. Create a new policy called &quot;Check Firewall&quot;.   Next select the policy and add a new condition. Conditions allow us to check for state, in this case the state being that the firewall is disabled. You can have multiple conditions in an expression but in this example we just need one. Select field and &quot;Host / Node.OS:Firewall Rules Active&quot;. Select false which means if the firewall is not active, the condition is true. Click the check mark to add the condition to the expression box.   The condition should now appear in the expression box and can now be saved.   Next we need to create a policy profile. This is simply a grouping of policies that we can apply to a host or virtual machine. In &quot;Control-&gt;Explorer&quot; select the policy profile accordion and under configuration dropdown add a new policy profile. You can give it a name &quot;RHEV Hypervisor&quot; and add policies by moving them from left to right.   Once we have a policy profile defined we can add it to the hypervisor hosts. Under &quot;Infrastructure-&gt;Hosts&quot; select the hosts and under policy dropdown select manage policies.  Now we can enable policy profiles on the selected hosts.   We can test the compliance policy by selecting the &quot;check compliance of last known configuration&quot; option from the host policy dropdown. When clicking on the host we can see if it is compliant under the compliance section.   In this case our host is not compliant because the firewall is disabled. # systemctl status iptables iptables.service - IPv4 firewall with iptables  Loaded: loaded (/usr/lib/systemd/system/iptables.service; disabled)  Active: inactive (dead) Create Control Policy As mentioned control policies are not that much different than compliance policies, they are simply driven from events. In this example we will do same check to see if firewall is enabled, only this time with control policy. Everytime a host is started and connected we will check if firewall is disabled. If the firewall is disabled we will have an action write to the audit log. Again both control and compliance policies can do same actions only difference is the trigger, in this case an event. Under &quot;Control-&gt;Explore&quot; policies accordion select control policy and create a new control policy for host.   Since we are using the same condition to check if firewall is disabled we can simply edit condition and select the condition we already created. All policies can leverage same conditions.   Next we need to tell CloudForms what event will drive the policy into action. Select the policy and under the configuration dropdown &quot;edit policy event assignments&quot;. In this example our event is the starting of a host.   Under &quot;Host Connect&quot; event we can add an action. In this case to generate an audit log message. Under configuration dropdown select &quot;edit action for this policy event&quot;. Select &quot;generate audit event&quot; if the conditions are true, meaning the firewall is in fact disabled.   Finally under &quot;Control-Explore&quot; policy profile accordion we can add our new control policy to the existing profile policy &quot;RHEV Hypervisor&quot;.  In order to test the control policy I can simply restart a host. Once host is restarted the control policy will automatically run and if the firewall is disabled an event will be written in the audit log. The audit log can be viewed under &quot;Configure-&gt;Configure&quot; diagnostics accordion. [2015-07-12T00:01:31.139400 #6530:af7ea4]  INFO -- Success: MIQ(PolicyProfiles.profile_edit) userid: [admin] - [11fe79f2-2815-11e5-9d99-001a4aa04b00] Record updated (policies:[{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003}] to [{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003, &quot;Host / Node Control: Generate Audit Event for Firewall&quot;=&gt;1000000000006}])  Conclusion In this article we have seen how to use Red Hat CloudForms to create both compliance and control policies that can govern our cloud infrastructure. Regardless of if your cloud consists of VMware vCenter, RHEV, Microsoft Systems Center, Amazon EC2 or even OpenStack common policies that define cloud governance can rule them all. The true power of CloudForms is allowing cloud administrators to build an abstraction layer around virtualization platforms that enables cloud governance. Regardless of what virtualization platform one uses, the policies should remain constant across all infrastructure. This is truly the only way to govern a cloud and create a standard operating environment. Hopefully you have found the information and topic discussed in this article informative. This is only of course the tip of the iceberg, but if it has gained your interest, I certainly implore you to consider looking into cloud management with CloudForms. Happy cloud governance and rest easy with CloudForms! (c) 2015 Keith Tenzer">


  <meta name="author" content="Keith Tenzer">
  
  <meta property="article:author" content="Keith Tenzer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Keith Tenzer's Blog">
<meta property="og:title" content="Governing the Cloud with CloudForms">
<meta property="og:url" content="http://localhost:4000/cloudforms/governing-the-cloud-with-cloudforms/">


  <meta property="og:description" content="Overview In a previous article it was stated that cloud in not a technology but rather an architectural methodology of resource governance that utilizes underlying virtualization technologies. Since cloud is more about the methodology, the technology platforms such as VMware vCenter, Red Hat Virtualization Management (RHEVM), Microsoft System Center, Amazon EC2 and OpenStack can change as application requirements or life cycles change. An application may start on a virtualization platform like VMware but over time move to a cloud platform such as OpenStack. It could even have components serviced by both. This is the exact concept behind what Gartner talks about when they refer to Bi-Modal IT. Gartner also says 50% of companies will screw this up. A bridge is definitely needed for managing applications between these various platforms. Red Hat CloudForms is exactly that bridge. It allows us to create an abstraction above the virtualization platforms so that governance and business process can remain consistent across the cloud. In this article we will take a look at how to setup governance of cloud resources using CloudForms. If you are new to CloudForms I would suggest reading this article to get a proper introduction. Before we get into creating policies that define resource governance in the cloud, we need to enable a few advanced features in CloudForms. &quot;Capacity and Utilization&quot; is needed for more detailed reporting and &quot;SmartState Analysis&quot; is required to get visibility inside virtual machines. Configure Capcity and Utilization CloudForms connects to infrastructure or cloud providers in order to report capacity and utilization. Therefore it is important to ensure the provider itself is collecting and reporting information. In this case we will configure Red Hat Enterprise Virtualization Management (RHEVM) provider to display capacity and utilization in CloudForms. Some steps are of course provider specific, in this case RHEVM specific. Configure RHEVM In RHEVM we need to configure reporting database user and allow remote access to the database. #psql -U postgres CREATE ROLE newuser LOGIN UNENCRYPTED PASSWORD &#39;newuserpassword&#39; SUPERUSER VALID UNTIL &#39;infinity&#39;; \q #iptables -I INPUT -p tcp -m tcp --dport 5432 -j ACCEPT #service  iptables  save #vi /var/lib/pgsql/data/pg_hba.conf host    all      all    0.0.0.0/0     md5 #vi /var/lib/pgsql/data/postgresql.conf listen_addresses  =  &#39;*&#39;  #service  postgresql  reload  Configure CloudForms Once our reporting user and provider database is configured it is time to enable capacity and utilization in CloudForms. Ensure all server roles are enabled except &quot;Database Synchronization&quot; and &quot;RHN Mirror&quot;.  &nbsp; Under &quot;Configure-&gt;Configure&quot; set the capacity and utilization policy for the CloudForms region. In this case we will enable all clusters and datastores.  Configure Smart State Analysis SmartState analysis allows us to look inside virtual machines. CloudForms does this by mounting datastores and peering inside the virtual disks. CloudForms is able to see user accounts, installed packages and configuration files for given virtual machine. This data enables us to create resource governance policies as you will see later. Under &quot;Configuration-&gt;Configuration-&gt;Settings&quot; edit the zone and enter IP of the CloudForms appliance you want to act as smart proxy. This is the system that will mount and connect to virtual machines for SmartState analysis. As such the CloudForms appliance requires access to shared storage used for datastores.  Finally the last step is to make CloudForms aware of what virtual machines are hosting CloudForm appliances. Under &quot;Infrastructure-&gt;Virtual Machines&quot; select appropriate virtual machine and edit management engine relationship. You can then match the virtual machine with the appropriate CloudForms engine. Note: this is new in CloudForms 3.2. Previously you would configure this under &quot;Configure-&gt;Configure-&gt;Smart Proxies&quot;.   At this point we have configured both capacity and utilization in addition to SmartState analysis. You can now gather SmartState information about hosts and virtual machine by selecting &quot;Perform SmartState Analysis&quot; under configuration of host or virtual machine. Ideally you would create a schedule that runs the SmartState analysis on a regular interval for all hosts and virtual machines. You could also however create a control policy that runs SmartState analysis whenever hosts or virtual machines are started. Governance Policies CloudForms has two types of governance policies: compliance and control. Compliance policies are scheduled or run manually and check the compliance state of hosts or virtual machines. If a host or virtual machine is found out of compliance an action can be taken. Control policies differ only slightly in that a control policy is run based on an event occurring, so these are automated policies based on events where compliance policies are manually operated or scheduled via the administrator. This may be a bit confusing at first but let me give an example. Lets suppose you want to protect against a known security vulnerability in virtual machines. You have two options and the only difference really is when do you check for vulnerability? If you check at a given time decided by administrator you would create compliance policy. If you check based on event happening like the virtual machine starting you would create a control policy. CloudForms Terminology Below is terminology relating to policies in CloudForms: Policy Profile - Grouping of policies that can be applied to hosts or virtual machines. Policy - Defines conditions and actions. Can be triggered by user in case of compliance policy or event in case of control policy. Condition - Tests for a desired or non-desired state. Can be true or false. Conditions are used to trigger actions. Action - Triggered based on condition matching true or false. Event - Only relating to control policy, this is what triggers the control policy to execute. Create Compliance Policy In this example we will create a compliance policy that checks if the firewall is disabled on hypervisor hosts. If the firewall is disabled the condition would be true and an action will set those hosts to non-compliant. Under &quot;Control-&gt;Explorer&quot; select the policies accordion. Create a new policy called &quot;Check Firewall&quot;.   Next select the policy and add a new condition. Conditions allow us to check for state, in this case the state being that the firewall is disabled. You can have multiple conditions in an expression but in this example we just need one. Select field and &quot;Host / Node.OS:Firewall Rules Active&quot;. Select false which means if the firewall is not active, the condition is true. Click the check mark to add the condition to the expression box.   The condition should now appear in the expression box and can now be saved.   Next we need to create a policy profile. This is simply a grouping of policies that we can apply to a host or virtual machine. In &quot;Control-&gt;Explorer&quot; select the policy profile accordion and under configuration dropdown add a new policy profile. You can give it a name &quot;RHEV Hypervisor&quot; and add policies by moving them from left to right.   Once we have a policy profile defined we can add it to the hypervisor hosts. Under &quot;Infrastructure-&gt;Hosts&quot; select the hosts and under policy dropdown select manage policies.  Now we can enable policy profiles on the selected hosts.   We can test the compliance policy by selecting the &quot;check compliance of last known configuration&quot; option from the host policy dropdown. When clicking on the host we can see if it is compliant under the compliance section.   In this case our host is not compliant because the firewall is disabled. # systemctl status iptables iptables.service - IPv4 firewall with iptables  Loaded: loaded (/usr/lib/systemd/system/iptables.service; disabled)  Active: inactive (dead) Create Control Policy As mentioned control policies are not that much different than compliance policies, they are simply driven from events. In this example we will do same check to see if firewall is enabled, only this time with control policy. Everytime a host is started and connected we will check if firewall is disabled. If the firewall is disabled we will have an action write to the audit log. Again both control and compliance policies can do same actions only difference is the trigger, in this case an event. Under &quot;Control-&gt;Explore&quot; policies accordion select control policy and create a new control policy for host.   Since we are using the same condition to check if firewall is disabled we can simply edit condition and select the condition we already created. All policies can leverage same conditions.   Next we need to tell CloudForms what event will drive the policy into action. Select the policy and under the configuration dropdown &quot;edit policy event assignments&quot;. In this example our event is the starting of a host.   Under &quot;Host Connect&quot; event we can add an action. In this case to generate an audit log message. Under configuration dropdown select &quot;edit action for this policy event&quot;. Select &quot;generate audit event&quot; if the conditions are true, meaning the firewall is in fact disabled.   Finally under &quot;Control-Explore&quot; policy profile accordion we can add our new control policy to the existing profile policy &quot;RHEV Hypervisor&quot;.  In order to test the control policy I can simply restart a host. Once host is restarted the control policy will automatically run and if the firewall is disabled an event will be written in the audit log. The audit log can be viewed under &quot;Configure-&gt;Configure&quot; diagnostics accordion. [2015-07-12T00:01:31.139400 #6530:af7ea4]  INFO -- Success: MIQ(PolicyProfiles.profile_edit) userid: [admin] - [11fe79f2-2815-11e5-9d99-001a4aa04b00] Record updated (policies:[{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003}] to [{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003, &quot;Host / Node Control: Generate Audit Event for Firewall&quot;=&gt;1000000000006}])  Conclusion In this article we have seen how to use Red Hat CloudForms to create both compliance and control policies that can govern our cloud infrastructure. Regardless of if your cloud consists of VMware vCenter, RHEV, Microsoft Systems Center, Amazon EC2 or even OpenStack common policies that define cloud governance can rule them all. The true power of CloudForms is allowing cloud administrators to build an abstraction layer around virtualization platforms that enables cloud governance. Regardless of what virtualization platform one uses, the policies should remain constant across all infrastructure. This is truly the only way to govern a cloud and create a standard operating environment. Hopefully you have found the information and topic discussed in this article informative. This is only of course the tip of the iceberg, but if it has gained your interest, I certainly implore you to consider looking into cloud management with CloudForms. Happy cloud governance and rest easy with CloudForms! (c) 2015 Keith Tenzer">





  <meta name="twitter:site" content="@keithtenzer">
  <meta name="twitter:title" content="Governing the Cloud with CloudForms">
  <meta name="twitter:description" content="Overview In a previous article it was stated that cloud in not a technology but rather an architectural methodology of resource governance that utilizes underlying virtualization technologies. Since cloud is more about the methodology, the technology platforms such as VMware vCenter, Red Hat Virtualization Management (RHEVM), Microsoft System Center, Amazon EC2 and OpenStack can change as application requirements or life cycles change. An application may start on a virtualization platform like VMware but over time move to a cloud platform such as OpenStack. It could even have components serviced by both. This is the exact concept behind what Gartner talks about when they refer to Bi-Modal IT. Gartner also says 50% of companies will screw this up. A bridge is definitely needed for managing applications between these various platforms. Red Hat CloudForms is exactly that bridge. It allows us to create an abstraction above the virtualization platforms so that governance and business process can remain consistent across the cloud. In this article we will take a look at how to setup governance of cloud resources using CloudForms. If you are new to CloudForms I would suggest reading this article to get a proper introduction. Before we get into creating policies that define resource governance in the cloud, we need to enable a few advanced features in CloudForms. &quot;Capacity and Utilization&quot; is needed for more detailed reporting and &quot;SmartState Analysis&quot; is required to get visibility inside virtual machines. Configure Capcity and Utilization CloudForms connects to infrastructure or cloud providers in order to report capacity and utilization. Therefore it is important to ensure the provider itself is collecting and reporting information. In this case we will configure Red Hat Enterprise Virtualization Management (RHEVM) provider to display capacity and utilization in CloudForms. Some steps are of course provider specific, in this case RHEVM specific. Configure RHEVM In RHEVM we need to configure reporting database user and allow remote access to the database. #psql -U postgres CREATE ROLE newuser LOGIN UNENCRYPTED PASSWORD &#39;newuserpassword&#39; SUPERUSER VALID UNTIL &#39;infinity&#39;; \q #iptables -I INPUT -p tcp -m tcp --dport 5432 -j ACCEPT #service  iptables  save #vi /var/lib/pgsql/data/pg_hba.conf host    all      all    0.0.0.0/0     md5 #vi /var/lib/pgsql/data/postgresql.conf listen_addresses  =  &#39;*&#39;  #service  postgresql  reload  Configure CloudForms Once our reporting user and provider database is configured it is time to enable capacity and utilization in CloudForms. Ensure all server roles are enabled except &quot;Database Synchronization&quot; and &quot;RHN Mirror&quot;.  &nbsp; Under &quot;Configure-&gt;Configure&quot; set the capacity and utilization policy for the CloudForms region. In this case we will enable all clusters and datastores.  Configure Smart State Analysis SmartState analysis allows us to look inside virtual machines. CloudForms does this by mounting datastores and peering inside the virtual disks. CloudForms is able to see user accounts, installed packages and configuration files for given virtual machine. This data enables us to create resource governance policies as you will see later. Under &quot;Configuration-&gt;Configuration-&gt;Settings&quot; edit the zone and enter IP of the CloudForms appliance you want to act as smart proxy. This is the system that will mount and connect to virtual machines for SmartState analysis. As such the CloudForms appliance requires access to shared storage used for datastores.  Finally the last step is to make CloudForms aware of what virtual machines are hosting CloudForm appliances. Under &quot;Infrastructure-&gt;Virtual Machines&quot; select appropriate virtual machine and edit management engine relationship. You can then match the virtual machine with the appropriate CloudForms engine. Note: this is new in CloudForms 3.2. Previously you would configure this under &quot;Configure-&gt;Configure-&gt;Smart Proxies&quot;.   At this point we have configured both capacity and utilization in addition to SmartState analysis. You can now gather SmartState information about hosts and virtual machine by selecting &quot;Perform SmartState Analysis&quot; under configuration of host or virtual machine. Ideally you would create a schedule that runs the SmartState analysis on a regular interval for all hosts and virtual machines. You could also however create a control policy that runs SmartState analysis whenever hosts or virtual machines are started. Governance Policies CloudForms has two types of governance policies: compliance and control. Compliance policies are scheduled or run manually and check the compliance state of hosts or virtual machines. If a host or virtual machine is found out of compliance an action can be taken. Control policies differ only slightly in that a control policy is run based on an event occurring, so these are automated policies based on events where compliance policies are manually operated or scheduled via the administrator. This may be a bit confusing at first but let me give an example. Lets suppose you want to protect against a known security vulnerability in virtual machines. You have two options and the only difference really is when do you check for vulnerability? If you check at a given time decided by administrator you would create compliance policy. If you check based on event happening like the virtual machine starting you would create a control policy. CloudForms Terminology Below is terminology relating to policies in CloudForms: Policy Profile - Grouping of policies that can be applied to hosts or virtual machines. Policy - Defines conditions and actions. Can be triggered by user in case of compliance policy or event in case of control policy. Condition - Tests for a desired or non-desired state. Can be true or false. Conditions are used to trigger actions. Action - Triggered based on condition matching true or false. Event - Only relating to control policy, this is what triggers the control policy to execute. Create Compliance Policy In this example we will create a compliance policy that checks if the firewall is disabled on hypervisor hosts. If the firewall is disabled the condition would be true and an action will set those hosts to non-compliant. Under &quot;Control-&gt;Explorer&quot; select the policies accordion. Create a new policy called &quot;Check Firewall&quot;.   Next select the policy and add a new condition. Conditions allow us to check for state, in this case the state being that the firewall is disabled. You can have multiple conditions in an expression but in this example we just need one. Select field and &quot;Host / Node.OS:Firewall Rules Active&quot;. Select false which means if the firewall is not active, the condition is true. Click the check mark to add the condition to the expression box.   The condition should now appear in the expression box and can now be saved.   Next we need to create a policy profile. This is simply a grouping of policies that we can apply to a host or virtual machine. In &quot;Control-&gt;Explorer&quot; select the policy profile accordion and under configuration dropdown add a new policy profile. You can give it a name &quot;RHEV Hypervisor&quot; and add policies by moving them from left to right.   Once we have a policy profile defined we can add it to the hypervisor hosts. Under &quot;Infrastructure-&gt;Hosts&quot; select the hosts and under policy dropdown select manage policies.  Now we can enable policy profiles on the selected hosts.   We can test the compliance policy by selecting the &quot;check compliance of last known configuration&quot; option from the host policy dropdown. When clicking on the host we can see if it is compliant under the compliance section.   In this case our host is not compliant because the firewall is disabled. # systemctl status iptables iptables.service - IPv4 firewall with iptables  Loaded: loaded (/usr/lib/systemd/system/iptables.service; disabled)  Active: inactive (dead) Create Control Policy As mentioned control policies are not that much different than compliance policies, they are simply driven from events. In this example we will do same check to see if firewall is enabled, only this time with control policy. Everytime a host is started and connected we will check if firewall is disabled. If the firewall is disabled we will have an action write to the audit log. Again both control and compliance policies can do same actions only difference is the trigger, in this case an event. Under &quot;Control-&gt;Explore&quot; policies accordion select control policy and create a new control policy for host.   Since we are using the same condition to check if firewall is disabled we can simply edit condition and select the condition we already created. All policies can leverage same conditions.   Next we need to tell CloudForms what event will drive the policy into action. Select the policy and under the configuration dropdown &quot;edit policy event assignments&quot;. In this example our event is the starting of a host.   Under &quot;Host Connect&quot; event we can add an action. In this case to generate an audit log message. Under configuration dropdown select &quot;edit action for this policy event&quot;. Select &quot;generate audit event&quot; if the conditions are true, meaning the firewall is in fact disabled.   Finally under &quot;Control-Explore&quot; policy profile accordion we can add our new control policy to the existing profile policy &quot;RHEV Hypervisor&quot;.  In order to test the control policy I can simply restart a host. Once host is restarted the control policy will automatically run and if the firewall is disabled an event will be written in the audit log. The audit log can be viewed under &quot;Configure-&gt;Configure&quot; diagnostics accordion. [2015-07-12T00:01:31.139400 #6530:af7ea4]  INFO -- Success: MIQ(PolicyProfiles.profile_edit) userid: [admin] - [11fe79f2-2815-11e5-9d99-001a4aa04b00] Record updated (policies:[{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003}] to [{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003, &quot;Host / Node Control: Generate Audit Event for Firewall&quot;=&gt;1000000000006}])  Conclusion In this article we have seen how to use Red Hat CloudForms to create both compliance and control policies that can govern our cloud infrastructure. Regardless of if your cloud consists of VMware vCenter, RHEV, Microsoft Systems Center, Amazon EC2 or even OpenStack common policies that define cloud governance can rule them all. The true power of CloudForms is allowing cloud administrators to build an abstraction layer around virtualization platforms that enables cloud governance. Regardless of what virtualization platform one uses, the policies should remain constant across all infrastructure. This is truly the only way to govern a cloud and create a standard operating environment. Hopefully you have found the information and topic discussed in this article informative. This is only of course the tip of the iceberg, but if it has gained your interest, I certainly implore you to consider looking into cloud management with CloudForms. Happy cloud governance and rest easy with CloudForms! (c) 2015 Keith Tenzer">
  <meta name="twitter:url" content="http://localhost:4000/cloudforms/governing-the-cloud-with-cloudforms/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2015-07-14T00:00:00-07:00">





  

  


<link rel="canonical" href="http://localhost:4000/cloudforms/governing-the-cloud-with-cloudforms/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Keith Tenzer",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Keith Tenzer's Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Keith Tenzer's Blog
          <span class="site-subtitle">Cloud Computing and Code</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/index.html">About</a>
            </li><li class="masthead__menu-item">
              <a href="/conferences-and-events/index.html">Conferences and Events</a>
            </li><li class="masthead__menu-item">
              <a href="/videos/index.html">Videos</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#cloudforms" itemprop="item"><span itemprop="name">Cloudforms</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Governing the Cloud with CloudForms</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/main/me.png" alt="Keith Tenzer" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Keith Tenzer</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Solutions Architect at Temporal</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Los Angeles, CA</span>
        </li>
      

      
        
          
        
          
        
          
            <li><a href="https://twitter.com/keithtenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Governing the Cloud with CloudForms">
    <meta itemprop="description" content="OverviewIn a previous article it was stated that cloud in not a technology but rather an architectural methodology of resource governance that utilizes underlying virtualization technologies. Since cloud is more about the methodology, the technology platforms such as VMware vCenter, Red Hat Virtualization Management (RHEVM), Microsoft System Center, Amazon EC2 and OpenStack can change as application requirements or life cycles change. An application may start on a virtualization platform like VMware but over time move to a cloud platform such as OpenStack. It could even have components serviced by both. This is the exact concept behind what Gartner talks about when they refer to Bi-Modal IT. Gartner also says 50% of companies will screw this up. A bridge is definitely needed for managing applications between these various platforms. Red Hat CloudForms is exactly that bridge. It allows us to create an abstraction above the virtualization platforms so that governance and business process can remain consistent across the cloud.In this article we will take a look at how to setup governance of cloud resources using CloudForms. If you are new to CloudForms I would suggest reading this article to get a proper introduction.Before we get into creating policies that define resource governance in the cloud, we need to enable a few advanced features in CloudForms. &quot;Capacity and Utilization&quot; is needed for more detailed reporting and &quot;SmartState Analysis&quot; is required to get visibility inside virtual machines.Configure Capcity and UtilizationCloudForms connects to infrastructure or cloud providers in order to report capacity and utilization. Therefore it is important to ensure the provider itself is collecting and reporting information. In this case we will configure Red Hat Enterprise Virtualization Management (RHEVM) provider to display capacity and utilization in CloudForms. Some steps are of course provider specific, in this case RHEVM specific.Configure RHEVMIn RHEVM we need to configure reporting database user and allow remote access to the database.#psql -U postgres CREATE ROLE newuser LOGIN UNENCRYPTED PASSWORD &#39;newuserpassword&#39; SUPERUSER VALID UNTIL &#39;infinity&#39;; \q#iptables -I INPUT -p tcp -m tcp --dport 5432 -j ACCEPT#service  iptables  save#vi /var/lib/pgsql/data/pg_hba.confhost    all      all    0.0.0.0/0     md5#vi /var/lib/pgsql/data/postgresql.conflisten_addresses  =  &#39;*&#39;#service  postgresql  reloadConfigure CloudFormsOnce our reporting user and provider database is configured it is time to enable capacity and utilization in CloudForms.Ensure all server roles are enabled except &quot;Database Synchronization&quot; and &quot;RHN Mirror&quot;.&nbsp;Under &quot;Configure-&gt;Configure&quot; set the capacity and utilization policy for the CloudForms region. In this case we will enable all clusters and datastores.Configure Smart State AnalysisSmartState analysis allows us to look inside virtual machines. CloudForms does this by mounting datastores and peering inside the virtual disks. CloudForms is able to see user accounts, installed packages and configuration files for given virtual machine. This data enables us to create resource governance policies as you will see later.Under &quot;Configuration-&gt;Configuration-&gt;Settings&quot; edit the zone and enter IP of the CloudForms appliance you want to act as smart proxy. This is the system that will mount and connect to virtual machines for SmartState analysis. As such the CloudForms appliance requires access to shared storage used for datastores.Finally the last step is to make CloudForms aware of what virtual machines are hosting CloudForm appliances. Under &quot;Infrastructure-&gt;Virtual Machines&quot; select appropriate virtual machine and edit management engine relationship. You can then match the virtual machine with the appropriate CloudForms engine. Note: this is new in CloudForms 3.2. Previously you would configure this under &quot;Configure-&gt;Configure-&gt;Smart Proxies&quot;. At this point we have configured both capacity and utilization in addition to SmartState analysis. You can now gather SmartState information about hosts and virtual machine by selecting &quot;Perform SmartState Analysis&quot; under configuration of host or virtual machine. Ideally you would create a schedule that runs the SmartState analysis on a regular interval for all hosts and virtual machines. You could also however create a control policy that runs SmartState analysis whenever hosts or virtual machines are started.Governance PoliciesCloudForms has two types of governance policies: compliance and control. Compliance policies are scheduled or run manually and check the compliance state of hosts or virtual machines. If a host or virtual machine is found out of compliance an action can be taken. Control policies differ only slightly in that a control policy is run based on an event occurring, so these are automated policies based on events where compliance policies are manually operated or scheduled via the administrator.This may be a bit confusing at first but let me give an example. Lets suppose you want to protect against a known security vulnerability in virtual machines. You have two options and the only difference really is when do you check for vulnerability? If you check at a given time decided by administrator you would create compliance policy. If you check based on event happening like the virtual machine starting you would create a control policy.CloudForms TerminologyBelow is terminology relating to policies in CloudForms:Policy Profile - Grouping of policies that can be applied to hosts or virtual machines.Policy - Defines conditions and actions. Can be triggered by user in case of compliance policy or event in case of control policy.Condition - Tests for a desired or non-desired state. Can be true or false. Conditions are used to trigger actions.Action - Triggered based on condition matching true or false.Event - Only relating to control policy, this is what triggers the control policy to execute.Create Compliance PolicyIn this example we will create a compliance policy that checks if the firewall is disabled on hypervisor hosts. If the firewall is disabled the condition would be true and an action will set those hosts to non-compliant.Under &quot;Control-&gt;Explorer&quot; select the policies accordion. Create a new policy called &quot;Check Firewall&quot;. Next select the policy and add a new condition. Conditions allow us to check for state, in this case the state being that the firewall is disabled. You can have multiple conditions in an expression but in this example we just need one. Select field and &quot;Host / Node.OS:Firewall Rules Active&quot;. Select false which means if the firewall is not active, the condition is true. Click the check mark to add the condition to the expression box. The condition should now appear in the expression box and can now be saved. Next we need to create a policy profile. This is simply a grouping of policies that we can apply to a host or virtual machine. In &quot;Control-&gt;Explorer&quot; select the policy profile accordion and under configuration dropdown add a new policy profile. You can give it a name &quot;RHEV Hypervisor&quot; and add policies by moving them from left to right. Once we have a policy profile defined we can add it to the hypervisor hosts. Under &quot;Infrastructure-&gt;Hosts&quot; select the hosts and under policy dropdown select manage policies.Now we can enable policy profiles on the selected hosts. We can test the compliance policy by selecting the &quot;check compliance of last known configuration&quot; option from the host policy dropdown. When clicking on the host we can see if it is compliant under the compliance section. In this case our host is not compliant because the firewall is disabled.# systemctl status iptablesiptables.service - IPv4 firewall with iptables Loaded: loaded (/usr/lib/systemd/system/iptables.service; disabled) Active: inactive (dead)Create Control PolicyAs mentioned control policies are not that much different than compliance policies, they are simply driven from events. In this example we will do same check to see if firewall is enabled, only this time with control policy. Everytime a host is started and connected we will check if firewall is disabled. If the firewall is disabled we will have an action write to the audit log. Again both control and compliance policies can do same actions only difference is the trigger, in this case an event.Under &quot;Control-&gt;Explore&quot; policies accordion select control policy and create a new control policy for host. Since we are using the same condition to check if firewall is disabled we can simply edit condition and select the condition we already created. All policies can leverage same conditions. Next we need to tell CloudForms what event will drive the policy into action. Select the policy and under the configuration dropdown &quot;edit policy event assignments&quot;. In this example our event is the starting of a host. Under &quot;Host Connect&quot; event we can add an action. In this case to generate an audit log message. Under configuration dropdown select &quot;edit action for this policy event&quot;. Select &quot;generate audit event&quot; if the conditions are true, meaning the firewall is in fact disabled. Finally under &quot;Control-Explore&quot; policy profile accordion we can add our new control policy to the existing profile policy &quot;RHEV Hypervisor&quot;.In order to test the control policy I can simply restart a host. Once host is restarted the control policy will automatically run and if the firewall is disabled an event will be written in the audit log. The audit log can be viewed under &quot;Configure-&gt;Configure&quot; diagnostics accordion.[2015-07-12T00:01:31.139400 #6530:af7ea4]  INFO -- Success: MIQ(PolicyProfiles.profile_edit) userid: [admin] - [11fe79f2-2815-11e5-9d99-001a4aa04b00] Record updated (policies:[{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003}] to [{&quot;Host / Node Compliance: Check Firewall&quot;=&gt;1000000000003, &quot;Host / Node Control: Generate Audit Event for Firewall&quot;=&gt;1000000000006}]) ConclusionIn this article we have seen how to use Red Hat CloudForms to create both compliance and control policies that can govern our cloud infrastructure. Regardless of if your cloud consists of VMware vCenter, RHEV, Microsoft Systems Center, Amazon EC2 or even OpenStack common policies that define cloud governance can rule them all. The true power of CloudForms is allowing cloud administrators to build an abstraction layer around virtualization platforms that enables cloud governance. Regardless of what virtualization platform one uses, the policies should remain constant across all infrastructure. This is truly the only way to govern a cloud and create a standard operating environment. Hopefully you have found the information and topic discussed in this article informative. This is only of course the tip of the iceberg, but if it has gained your interest, I certainly implore you to consider looking into cloud management with CloudForms.Happy cloud governance and rest easy with CloudForms!(c) 2015 Keith Tenzer">
    <meta itemprop="datePublished" content="2015-07-14T00:00:00-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Governing the Cloud with CloudForms
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2015-07-14T00:00:00-07:00">July 14, 2015</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          16 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h3>Overview</h3>
<p>In a previous <a href="http://keithtenzer.com/2015/01/14/to-cloud-or-not-to-cloud-that-is-the-question/">article</a> it was stated that <span style="text-decoration:underline;"><em>cloud in not a technology but rather an architectural methodology of resource governance that utilizes underlying virtualization technologies</em></span>. Since cloud is more about the methodology, the technology platforms such as VMware vCenter, Red Hat Virtualization Management (RHEVM), Microsoft System Center, Amazon EC2 and OpenStack can change as application requirements or life cycles change. An application may start on a virtualization platform like VMware but over time move to a cloud platform such as OpenStack. It could even have components serviced by both. This is the exact concept behind what Gartner talks about when they refer to <a href="http://www.gartner.com/it-glossary/bimodal">Bi-Modal IT</a>. Gartner also says 50% of companies will screw this up. A bridge is definitely needed for managing applications between these various platforms. Red Hat CloudForms is exactly that bridge. It allows us to create an abstraction above the virtualization platforms so that governance and business process can remain consistent across the cloud.<br />
<!--more-->In this article we will take a look at how to setup governance of cloud resources using CloudForms. If you are new to CloudForms I would suggest reading this <a href="http://keithtenzer.com/2015/01/21/red-hat-cloudforms-overview-and-setup/">article </a>to get a proper introduction.</p>
<p>Before we get into creating policies that define resource governance in the cloud, we need to enable a few advanced features in CloudForms. "Capacity and Utilization" is needed for more detailed reporting and "SmartState Analysis" is required to get visibility inside virtual machines.</p>
<h3>Configure Capcity and Utilization</h3>
<p>CloudForms connects to infrastructure or cloud providers in order to report capacity and utilization. Therefore it is important to ensure the provider itself is collecting and reporting information. In this case we will configure Red Hat Enterprise Virtualization Management (RHEVM) provider to display capacity and utilization in CloudForms. Some steps are of course provider specific, in this case RHEVM specific.</p>
<h4>Configure RHEVM</h4>
<p>In RHEVM we need to configure reporting database user and allow remote access to the database.</p>
<pre style="padding-left:30px;"><code>#psql -U postgres CREATE ROLE newuser LOGIN UNENCRYPTED PASSWORD 'newuserpassword' SUPERUSER VALID UNTIL 'infinity'; \q</code></pre>
<pre style="padding-left:30px;"><code>#iptables -I INPUT -p tcp -m tcp --dport 5432 -j ACCEPT
#service  iptables  save</code><code></code></pre>
<pre style="padding-left:30px;">#vi /var/lib/pgsql/data/pg_hba.conf
host    all      all    0.0.0.0/0     md5</pre>
<pre style="padding-left:30px;"><code>#vi /var/lib/pgsql/data/postgresql.conf
</code><code>listen_addresses  =  '*'
</code></pre>
<pre style="padding-left:30px;"><code>#service  postgresql  reload
</code></pre>
<h4>Configure CloudForms</h4>
<p>Once our reporting user and provider database is configured it is time to enable capacity and utilization in CloudForms.</p>
<p>Ensure all server roles are enabled except "Database Synchronization" and "RHN Mirror".</p>
<p><a href="https://keithtenzer.files.wordpress.com/2015/07/cf_settings.jpg"><img class="  wp-image-1062 alignleft" src="/assets/2015/07/cf_settings.jpg?w=300" alt="CF_SETTINGS" width="948" height="474" /></a></p>
<p>&nbsp;</p>
<p>Under "Configure-&gt;Configure" set the capacity and utilization policy for the CloudForms region. In this case we will enable all clusters and datastores.</p>
<p><a style="line-height:1.5;" href="https://keithtenzer.files.wordpress.com/2015/07/cf_addcapacity_and_util_2.jpg"><img class="alignnone  wp-image-1051" src="/assets/2015/07/cf_addcapacity_and_util_2.jpg?w=300" alt="CF_ADDCAPACITY_AND_UTIL_2" width="956" height="188" /></a></p>
<h3>Configure Smart State Analysis</h3>
<p>SmartState analysis allows us to look inside virtual machines. CloudForms does this by mounting datastores and peering inside the virtual disks. CloudForms is able to see user accounts, installed packages and configuration files for given virtual machine. This data enables us to create resource governance policies as you will see later.</p>
<p>Under "Configuration-&gt;Configuration-&gt;Settings" edit the zone and enter IP of the CloudForms appliance you want to act as smart proxy. This is the system that will mount and connect to virtual machines for SmartState analysis. As such the CloudForms appliance requires access to shared storage used for datastores.</p>
<p><code><a href="https://keithtenzer.files.wordpress.com/2015/07/cf_smart_proxy.jpg"><img class="alignnone  wp-image-1053" src="/assets/2015/07/cf_smart_proxy.jpg?w=300" alt="CF_SMART_PROXY" width="948" height="452" /></a></code></p>
<p>Finally the last step is to make CloudForms aware of what virtual machines are hosting CloudForm appliances. Under "Infrastructure-&gt;Virtual Machines" select appropriate virtual machine and edit management engine relationship. You can then match the virtual machine with the appropriate CloudForms engine. Note: this is new in CloudForms 3.2. Previously you would configure this under "Configure-&gt;Configure-&gt;Smart Proxies".</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_smart_proxy_2.jpg"><img class="alignnone  wp-image-1054" src="/assets/2015/07/cf_smart_proxy_2.jpg?w=300" alt="CF_SMART_PROXY_2" width="949" height="465" /></a></code></p>
<p>At this point we have configured both capacity and utilization in addition to SmartState analysis. You can now gather SmartState information about hosts and virtual machine by selecting "Perform SmartState Analysis" under configuration of host or virtual machine. Ideally you would create a schedule that runs the SmartState analysis on a regular interval for all hosts and virtual machines. You could also however create a control policy that runs SmartState analysis whenever hosts or virtual machines are started.</p>
<h3>Governance Policies</h3>
<p>CloudForms has two types of governance policies: compliance and control. Compliance policies are scheduled or run manually and check the compliance state of hosts or virtual machines. If a host or virtual machine is found out of compliance an action can be taken. Control policies differ only slightly in that a control policy is run based on an event occurring, so these are automated policies based on events where compliance policies are manually operated or scheduled via the administrator.</p>
<p>This may be a bit confusing at first but let me give an example. Lets suppose you want to protect against a known security vulnerability in virtual machines. You have two options and the only difference really is when do you check for vulnerability? If you check at a given time decided by administrator you would create compliance policy. If you check based on event happening like the virtual machine starting you would create a control policy.</p>
<h4>CloudForms Terminology</h4>
<p>Below is terminology relating to policies in CloudForms:</p>
<p><strong>Policy Profile</strong> - Grouping of policies that can be applied to hosts or virtual machines.</p>
<p><strong>Policy</strong> - Defines conditions and actions. Can be triggered by user in case of compliance policy or event in case of control policy.</p>
<p><strong>Condition</strong> - Tests for a desired or non-desired state. Can be true or false. Conditions are used to trigger actions.</p>
<p><strong>Action</strong> - Triggered based on condition matching true or false.</p>
<p><strong>Event</strong> - Only relating to control policy, this is what triggers the control policy to execute.</p>
<h4>Create Compliance Policy</h4>
<p>In this example we will create a compliance policy that checks if the firewall is disabled on hypervisor hosts. If the firewall is disabled the condition would be true and an action will set those hosts to non-compliant.</p>
<p>Under "Control-&gt;Explorer" select the policies accordion. Create a new policy called "Check Firewall".</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_add_policy.jpg"><img class="alignnone  wp-image-1042" src="/assets/2015/07/cf_add_policy.jpg?w=300" alt="CF_ADD_POLICY" width="949" height="465" /></a></code></p>
<p>Next select the policy and add a new condition. Conditions allow us to check for state, in this case the state being that the firewall is disabled. You can have multiple conditions in an expression but in this example we just need one. Select field and "Host / Node.OS:Firewall Rules Active". Select false which means if the firewall is not active, the condition is true. Click the check mark to add the condition to the expression box.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_add_condition_1.jpg"><img class="alignnone  wp-image-1043" src="/assets/2015/07/cf_add_condition_1.jpg?w=300" alt="CF_ADD_CONDITION_1" width="950" height="453" /></a></code></p>
<p>The condition should now appear in the expression box and can now be saved.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_add_condition_2.jpg"><img class="alignnone  wp-image-1044" src="/assets/2015/07/cf_add_condition_2.jpg?w=300" alt="CF_ADD_CONDITION_2" width="950" height="456" /></a></code></p>
<p>Next we need to create a policy profile. This is simply a grouping of policies that we can apply to a host or virtual machine. In "Control-&gt;Explorer" select the policy profile accordion and under configuration dropdown add a new policy profile. You can give it a name "RHEV Hypervisor" and add policies by moving them from left to right.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_policy_profile.jpg"><img class="alignnone  wp-image-1045" src="/assets/2015/07/cf_policy_profile.jpg?w=300" alt="CF_POLICY_PROFILE" width="950" height="459" /></a></code></p>
<p>Once we have a policy profile defined we can add it to the hypervisor hosts. Under "Infrastructure-&gt;Hosts" select the hosts and under policy dropdown select manage policies.</p>
<p><a href="https://keithtenzer.files.wordpress.com/2015/07/cf_policy_run.jpg"><img class="alignnone  wp-image-1047" src="/assets/2015/07/cf_policy_run.jpg?w=300" alt="CF_POLICY_RUN" width="952" height="257" /></a></p>
<p>Now we can enable policy profiles on the selected hosts.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_apply_policy.jpg"><img class="alignnone  wp-image-1046" src="/assets/2015/07/cf_apply_policy.jpg?w=300" alt="CF_APPLY_POLICY" width="953" height="308" /></a></code></p>
<p>We can test the compliance policy by selecting the "check compliance of last known configuration" option from the host policy dropdown. When clicking on the host we can see if it is compliant under the compliance section.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_compliance_status.jpg"><img class="alignnone  wp-image-1048" src="/assets/2015/07/cf_compliance_status.jpg?w=300" alt="CF_COMPLIANCE_STATUS" width="950" height="456" /></a></code></p>
<p>In this case our host is not compliant because the firewall is disabled.</p>
<pre style="padding-left:30px;"># systemctl status iptables
iptables.service - IPv4 firewall with iptables
 Loaded: loaded (/usr/lib/systemd/system/iptables.service; disabled)
 Active: inactive (dead)</pre>
<h4>Create Control Policy</h4>
<p>As mentioned control policies are not that much different than compliance policies, they are simply driven from events. In this example we will do same check to see if firewall is enabled, only this time with control policy. Everytime a host is started and connected we will check if firewall is disabled. If the firewall is disabled we will have an action write to the audit log. Again both control and compliance policies can do same actions only difference is the trigger, in this case an event.</p>
<p>Under "Control-&gt;Explore" policies accordion select control policy and create a new control policy for host.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_control_policy_1.jpg"><img class="alignnone  wp-image-1036" src="/assets/2015/07/cf_control_policy_1.jpg?w=300" alt="CF_CONTROL_POLICY_1" width="943" height="456" /></a></code></p>
<p>Since we are using the same condition to check if firewall is disabled we can simply edit condition and select the condition we already created. All policies can leverage same conditions.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_control_policy_2.jpg"><img class="alignnone  wp-image-1037" src="/assets/2015/07/cf_control_policy_2.jpg?w=300" alt="CF_CONTROL_POLICY_2" width="942" height="452" /></a></code></p>
<p>Next we need to tell CloudForms what event will drive the policy into action. Select the policy and under the configuration dropdown "edit policy event assignments". In this example our event is the starting of a host.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_control_policy_3.jpg"><img class="alignnone  wp-image-1038" src="/assets/2015/07/cf_control_policy_3.jpg?w=300" alt="CF_CONTROL_POLICY_3" width="936" height="446" /></a></code></p>
<p>Under "Host Connect" event we can add an action. In this case to generate an audit log message. Under configuration dropdown select "edit action for this policy event". Select "generate audit event" if the conditions are true, meaning the firewall is in fact disabled.</p>
<p><code> <a href="https://keithtenzer.files.wordpress.com/2015/07/cf_control_policy_4.jpg"><img class="alignnone  wp-image-1039" src="/assets/2015/07/cf_control_policy_4.jpg?w=300" alt="CF_CONTROL_POLICY_4" width="935" height="449" /></a></code></p>
<p>Finally under "Control-Explore" policy profile accordion we can add our new control policy to the existing profile policy "RHEV Hypervisor".</p>
<p><code><a href="https://keithtenzer.files.wordpress.com/2015/07/cf_control_policy_5.jpg"><img class="alignnone  wp-image-1041" src="/assets/2015/07/cf_control_policy_5.jpg?w=300" alt="CF_CONTROL_POLICY_5" width="938" height="450" /></a></code></p>
<p>In order to test the control policy I can simply restart a host. Once host is restarted the control policy will automatically run and if the firewall is disabled an event will be written in the audit log. The audit log can be viewed under "Configure-&gt;Configure" diagnostics accordion.</p>
<pre style="padding-left:30px;"><code>[2015-07-12T00:01:31.139400 #6530:af7ea4]  INFO -- Success: MIQ(PolicyProfiles.profile_edit) userid: [admin] - [11fe79f2-2815-11e5-9d99-001a4aa04b00] Record updated (policies:[{"Host / Node Compliance: Check Firewall"=&gt;1000000000003}] to [{"Host / Node Compliance: Check Firewall"=&gt;1000000000003, "Host / Node Control: Generate Audit Event for Firewall"=&gt;1000000000006}]) </code></pre>
<h3>Conclusion</h3>
<p>In this article we have seen how to use Red Hat CloudForms to create both compliance and control policies that can govern our cloud infrastructure. Regardless of if your cloud consists of VMware vCenter, RHEV, Microsoft Systems Center, Amazon EC2 or even OpenStack common policies that define cloud governance can rule them all. The true power of CloudForms is allowing cloud administrators to build an abstraction layer around virtualization platforms that enables cloud governance. Regardless of what virtualization platform one uses, the policies should remain constant across all infrastructure. This is truly the only way to govern a cloud and create a standard operating environment. Hopefully you have found the information and topic discussed in this article informative. This is only of course the tip of the iceberg, but if it has gained your interest, I certainly implore you to consider looking into cloud management with CloudForms.</p>
<p>Happy cloud governance and rest easy with CloudForms!</p>
<p>(c) 2015 Keith Tenzer</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#cloud" class="page__taxonomy-item" rel="tag">Cloud</a><span class="sep">, </span>
    
      <a href="/tags/#cloud-management" class="page__taxonomy-item" rel="tag">cloud management</a><span class="sep">, </span>
    
      <a href="/tags/#governance" class="page__taxonomy-item" rel="tag">governance</a><span class="sep">, </span>
    
      <a href="/tags/#manageiq" class="page__taxonomy-item" rel="tag">ManageIQ</a><span class="sep">, </span>
    
      <a href="/tags/#security" class="page__taxonomy-item" rel="tag">Security</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#cloudforms" class="page__taxonomy-item" rel="tag">CloudForms</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2015-07-14T00:00:00-07:00">July 14, 2015</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=keithtenzer&text=Governing+the+Cloud+with+CloudForms%20http%3A%2F%2Flocalhost%3A4000%2Fcloudforms%2Fgoverning-the-cloud-with-cloudforms%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fcloudforms%2Fgoverning-the-cloud-with-cloudforms%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fcloudforms%2Fgoverning-the-cloud-with-cloudforms%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/clustering/pacemaker-the-open-source-high-availability-cluster/" class="pagination--pager" title="Pacemaker - The Open Source, High Availability Cluster
">Previous</a>
    
    
      <a href="/openshift/openshift-enterprise-v3-lab-configuration-innovate-faster-deliver-sooner/" class="pagination--pager" title="OpenShift Enterprise v3 Lab Configuration: Innovate Faster, Deliver Sooner
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/temporal/my-first-day-at-temporal/" rel="permalink">My First Day at Temporal
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-08-15T00:00:00-07:00">August 15, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
Today is my first day at temporal and with that I wanted to share some thoughts around my decision, why Temporal and my experience thus far. As you...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/linux/blog-with-gitops-practices-and-github/" rel="permalink">Blog with Gitops Practices and GitHub
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-02-10T00:00:00-08:00">February 10, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          13 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
Want to build your brand, while living the gitops revolution and not paying anything for it? That is exactly what this article will walk you through...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/linux/The-Fedora-Workstation-Experience/" rel="permalink">The Fedora Workstation Experience
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-01-10T00:00:00-08:00">January 10, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
A lot of people always ask me what is the best way to contribute to opensource? Of course contributing code, documentation, spreading the gospel or...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/building-ansible-operators-1-2-3/" rel="permalink">Building Ansible Operators 1-2-3
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-12-03T00:00:00-08:00">December 3, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
In this article we will go step by step to build a Kubernetes Operator using Ansible and the Operator Framework. Operators provide the ability to no...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/keithtenzer"" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Keith Tenzer. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
