<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
<link rel="icon" href="/assets/main/me.png">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Deploying CloudForms in the Azure Cloud - Keith Tenzer’s Blog</title>
<meta name="description" content="Overview In this article we will deploy the CloudForms appliance in the Azure cloud. CloudForms is a cloud management platform based on the opensource project manageiq. Red Hat bought manageiq a few years back and opensourced the software. Originally it was designed to manage VMware but over the years has expanded to many additional traditional as well as cloud platforms. You can use this article as reference for both CloudForms and ManageIQ. CloudForms can connect to many cloud providers such as RHEV (Red Hat Enterprise Virtualization), VMware, Hyper-V, OpenStack, Amazon Web Services (AWS), Google Cloud Engine (GCE) and Azure. Large organizations don&#39;t have one cloud but many and in addition typically have on-premise, off-premise as well as public. All of these various platforms creates a lot of complexity if not managed right. CloudForms can create a bridge between traditional (mode 1) and cloud native (mode 2) workloads, offering applications a path to switch between these modes. In addition, CloudForms allows an IT organization to act as a cloud broker between the various public platforms. Finally CloudForms can be used to automatically deploy and manage applications across the various cloud platforms. Businesses have choice in platform, flexibility and speed while IT can manage it all centrally applying common policies or rule-sets regardless of where workloads are running.  Prepare Red Hat provides CloudForms as a appliance. The appliances each have various formats, depending on the platform. For Microsft Hyper-V and Azure, Red Hat provides a Virtual Hard Disk (VHD). The vhd is a dynamic disk. Azure unfortunately does not support dynamic disks but only fixed disks. In order to import CloudForms appliance in Azure we need to convert the appliance vhd to fixed disk. In addition the vhd will be fixed size of around 40GB. To prevent having to upload 40GB and just the actual data which is closer to 2GB we will use several tools. You can of course use Powershell, using the Azure cmdlets. If you are a Linux guy like me though, that isn&#39;t an option. Thankfully Microsoft has provided a tool written in Go that works great for uploading disks to Azure. In addition Microsoft provides a CLI similar to functionality of Powershell written in python. Convert VHD from dynamic to fixed The first question you might have is why? Well Red Hat doesn&#39;t want you to have to download a 40GB image so they provide a dynamic disk. In the next steps we will take that image, convert to fixed disk and upload to Azure, ignoring the zero&#39;ed blocks. Convert image to raw using qemu tools # qemu-img convert -f vpc -O raw cfme-azure-5.7.0.17-1.x86_64.vhd cfme-azure-5.7.0.17-1.raw Calculate fixed image size $sudo rawdisk=&quot;cfme-azure-5.7.0.17-1.raw&quot; $sudo vhddisk=&quot;cfme-azure-5.7.0.17-1.vhd&quot; $sudo MB=$((1024*1024)) $sudo rounded_size=$((($size/$MB + 1)*$MB)) $sudo size=$(qemu-img info -f raw --output json &quot;$rawdisk&quot; | gawk &#39;match($0, /&quot;virtual-size&quot;: ([0-9]+),/, val) {print val[1]}&#39;) $sudo rounded_size=$((($size/$MB + 1)*$MB)) Resize image $sudo qemu-img resize -f raw &quot;$rawdisk&quot; $rounded_size $sudo qemu-img convert -f raw -o subformat=fixed,force_size -O vpc &quot;$rawdisk&quot; &quot;$vhddisk&quot; Download Azure VHD Tools As mentioned the Azure VHD tools are written in Go so you need to first install Go. I installed version 1.7.4. $ gunzip go1.7.4.linux-amd64.tar.gz  $ tar xvf go1.7.4.linux-amd64.tar  $ cd go Export Environment Parameters  $ mkdir $HOME/work  $ export GOPATH=$HOME/work  $ export PATH=$PATH:$GOPATH/bin Install VHD Tools  $ go get github.com/Microsoft/azure-vhd-utils Upload the CloudForms Fixed Disk to Azure $ ./azure-vhd-utils upload --localvhdpath /home/ktenzer/cfme-azure-5.7.0.17-1.vhd --stgaccountname &lt;storage account&gt; --stgaccountkey &lt;storage key&gt; --containername templates --blobname cfme-azure-5.7.0.17-1.vhd --parallelism 8 Once the upload completes you can deploy the CloudForms Appliance in Azure. In order to do this we will use the Azure CLI which is python based. Install Python and dependencies $ sudo yum install python $ sudo yum install python-pip $ sudo yum install python-devel $ sudo yum install openssl-devel $ sudo yum install npm Install Azure CLI $ npm install azure-cli -g $ sudo npm install azure-cli -g $ sudo pip install --upgrade pip $ sudo pip install azure==2.0.0rc5 Deploy CloudForms Appliance Using the Azure CLI deploy CloudForms Appliance $ azure vm image create cfme-azure-5.7.0.17-1 --blob-url https://premiumsadpdhlose2disk.blob.core.windows.net/templates/cfme-azure-5.7.0.17-1.vhd --os Linux /home/ktenzer/cfme-azure-5.7.0.17-1.vhd Note: you can also use the Azure portal UI to create VM once the image is uploaded. Configure CloudForms in Azure Once the CloudForms Appliance is deployed you can access it using username/password or ssh-key depending on what you chose when creating VM in Azure. $ ssh ktenzer@&lt;CloudForms Appliance IP&gt; Run the appliance console $ sudo appliance_console">


  <meta name="author" content="Keith Tenzer">
  
  <meta property="article:author" content="Keith Tenzer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Keith Tenzer's Blog">
<meta property="og:title" content="Deploying CloudForms in the Azure Cloud">
<meta property="og:url" content="http://localhost:4000/cloudforms/deploying-cloudforms-in-the-azure-cloud/">


  <meta property="og:description" content="Overview In this article we will deploy the CloudForms appliance in the Azure cloud. CloudForms is a cloud management platform based on the opensource project manageiq. Red Hat bought manageiq a few years back and opensourced the software. Originally it was designed to manage VMware but over the years has expanded to many additional traditional as well as cloud platforms. You can use this article as reference for both CloudForms and ManageIQ. CloudForms can connect to many cloud providers such as RHEV (Red Hat Enterprise Virtualization), VMware, Hyper-V, OpenStack, Amazon Web Services (AWS), Google Cloud Engine (GCE) and Azure. Large organizations don&#39;t have one cloud but many and in addition typically have on-premise, off-premise as well as public. All of these various platforms creates a lot of complexity if not managed right. CloudForms can create a bridge between traditional (mode 1) and cloud native (mode 2) workloads, offering applications a path to switch between these modes. In addition, CloudForms allows an IT organization to act as a cloud broker between the various public platforms. Finally CloudForms can be used to automatically deploy and manage applications across the various cloud platforms. Businesses have choice in platform, flexibility and speed while IT can manage it all centrally applying common policies or rule-sets regardless of where workloads are running.  Prepare Red Hat provides CloudForms as a appliance. The appliances each have various formats, depending on the platform. For Microsft Hyper-V and Azure, Red Hat provides a Virtual Hard Disk (VHD). The vhd is a dynamic disk. Azure unfortunately does not support dynamic disks but only fixed disks. In order to import CloudForms appliance in Azure we need to convert the appliance vhd to fixed disk. In addition the vhd will be fixed size of around 40GB. To prevent having to upload 40GB and just the actual data which is closer to 2GB we will use several tools. You can of course use Powershell, using the Azure cmdlets. If you are a Linux guy like me though, that isn&#39;t an option. Thankfully Microsoft has provided a tool written in Go that works great for uploading disks to Azure. In addition Microsoft provides a CLI similar to functionality of Powershell written in python. Convert VHD from dynamic to fixed The first question you might have is why? Well Red Hat doesn&#39;t want you to have to download a 40GB image so they provide a dynamic disk. In the next steps we will take that image, convert to fixed disk and upload to Azure, ignoring the zero&#39;ed blocks. Convert image to raw using qemu tools # qemu-img convert -f vpc -O raw cfme-azure-5.7.0.17-1.x86_64.vhd cfme-azure-5.7.0.17-1.raw Calculate fixed image size $sudo rawdisk=&quot;cfme-azure-5.7.0.17-1.raw&quot; $sudo vhddisk=&quot;cfme-azure-5.7.0.17-1.vhd&quot; $sudo MB=$((1024*1024)) $sudo rounded_size=$((($size/$MB + 1)*$MB)) $sudo size=$(qemu-img info -f raw --output json &quot;$rawdisk&quot; | gawk &#39;match($0, /&quot;virtual-size&quot;: ([0-9]+),/, val) {print val[1]}&#39;) $sudo rounded_size=$((($size/$MB + 1)*$MB)) Resize image $sudo qemu-img resize -f raw &quot;$rawdisk&quot; $rounded_size $sudo qemu-img convert -f raw -o subformat=fixed,force_size -O vpc &quot;$rawdisk&quot; &quot;$vhddisk&quot; Download Azure VHD Tools As mentioned the Azure VHD tools are written in Go so you need to first install Go. I installed version 1.7.4. $ gunzip go1.7.4.linux-amd64.tar.gz  $ tar xvf go1.7.4.linux-amd64.tar  $ cd go Export Environment Parameters  $ mkdir $HOME/work  $ export GOPATH=$HOME/work  $ export PATH=$PATH:$GOPATH/bin Install VHD Tools  $ go get github.com/Microsoft/azure-vhd-utils Upload the CloudForms Fixed Disk to Azure $ ./azure-vhd-utils upload --localvhdpath /home/ktenzer/cfme-azure-5.7.0.17-1.vhd --stgaccountname &lt;storage account&gt; --stgaccountkey &lt;storage key&gt; --containername templates --blobname cfme-azure-5.7.0.17-1.vhd --parallelism 8 Once the upload completes you can deploy the CloudForms Appliance in Azure. In order to do this we will use the Azure CLI which is python based. Install Python and dependencies $ sudo yum install python $ sudo yum install python-pip $ sudo yum install python-devel $ sudo yum install openssl-devel $ sudo yum install npm Install Azure CLI $ npm install azure-cli -g $ sudo npm install azure-cli -g $ sudo pip install --upgrade pip $ sudo pip install azure==2.0.0rc5 Deploy CloudForms Appliance Using the Azure CLI deploy CloudForms Appliance $ azure vm image create cfme-azure-5.7.0.17-1 --blob-url https://premiumsadpdhlose2disk.blob.core.windows.net/templates/cfme-azure-5.7.0.17-1.vhd --os Linux /home/ktenzer/cfme-azure-5.7.0.17-1.vhd Note: you can also use the Azure portal UI to create VM once the image is uploaded. Configure CloudForms in Azure Once the CloudForms Appliance is deployed you can access it using username/password or ssh-key depending on what you chose when creating VM in Azure. $ ssh ktenzer@&lt;CloudForms Appliance IP&gt; Run the appliance console $ sudo appliance_console">





  <meta name="twitter:site" content="@keithtenzer">
  <meta name="twitter:title" content="Deploying CloudForms in the Azure Cloud">
  <meta name="twitter:description" content="Overview In this article we will deploy the CloudForms appliance in the Azure cloud. CloudForms is a cloud management platform based on the opensource project manageiq. Red Hat bought manageiq a few years back and opensourced the software. Originally it was designed to manage VMware but over the years has expanded to many additional traditional as well as cloud platforms. You can use this article as reference for both CloudForms and ManageIQ. CloudForms can connect to many cloud providers such as RHEV (Red Hat Enterprise Virtualization), VMware, Hyper-V, OpenStack, Amazon Web Services (AWS), Google Cloud Engine (GCE) and Azure. Large organizations don&#39;t have one cloud but many and in addition typically have on-premise, off-premise as well as public. All of these various platforms creates a lot of complexity if not managed right. CloudForms can create a bridge between traditional (mode 1) and cloud native (mode 2) workloads, offering applications a path to switch between these modes. In addition, CloudForms allows an IT organization to act as a cloud broker between the various public platforms. Finally CloudForms can be used to automatically deploy and manage applications across the various cloud platforms. Businesses have choice in platform, flexibility and speed while IT can manage it all centrally applying common policies or rule-sets regardless of where workloads are running.  Prepare Red Hat provides CloudForms as a appliance. The appliances each have various formats, depending on the platform. For Microsft Hyper-V and Azure, Red Hat provides a Virtual Hard Disk (VHD). The vhd is a dynamic disk. Azure unfortunately does not support dynamic disks but only fixed disks. In order to import CloudForms appliance in Azure we need to convert the appliance vhd to fixed disk. In addition the vhd will be fixed size of around 40GB. To prevent having to upload 40GB and just the actual data which is closer to 2GB we will use several tools. You can of course use Powershell, using the Azure cmdlets. If you are a Linux guy like me though, that isn&#39;t an option. Thankfully Microsoft has provided a tool written in Go that works great for uploading disks to Azure. In addition Microsoft provides a CLI similar to functionality of Powershell written in python. Convert VHD from dynamic to fixed The first question you might have is why? Well Red Hat doesn&#39;t want you to have to download a 40GB image so they provide a dynamic disk. In the next steps we will take that image, convert to fixed disk and upload to Azure, ignoring the zero&#39;ed blocks. Convert image to raw using qemu tools # qemu-img convert -f vpc -O raw cfme-azure-5.7.0.17-1.x86_64.vhd cfme-azure-5.7.0.17-1.raw Calculate fixed image size $sudo rawdisk=&quot;cfme-azure-5.7.0.17-1.raw&quot; $sudo vhddisk=&quot;cfme-azure-5.7.0.17-1.vhd&quot; $sudo MB=$((1024*1024)) $sudo rounded_size=$((($size/$MB + 1)*$MB)) $sudo size=$(qemu-img info -f raw --output json &quot;$rawdisk&quot; | gawk &#39;match($0, /&quot;virtual-size&quot;: ([0-9]+),/, val) {print val[1]}&#39;) $sudo rounded_size=$((($size/$MB + 1)*$MB)) Resize image $sudo qemu-img resize -f raw &quot;$rawdisk&quot; $rounded_size $sudo qemu-img convert -f raw -o subformat=fixed,force_size -O vpc &quot;$rawdisk&quot; &quot;$vhddisk&quot; Download Azure VHD Tools As mentioned the Azure VHD tools are written in Go so you need to first install Go. I installed version 1.7.4. $ gunzip go1.7.4.linux-amd64.tar.gz  $ tar xvf go1.7.4.linux-amd64.tar  $ cd go Export Environment Parameters  $ mkdir $HOME/work  $ export GOPATH=$HOME/work  $ export PATH=$PATH:$GOPATH/bin Install VHD Tools  $ go get github.com/Microsoft/azure-vhd-utils Upload the CloudForms Fixed Disk to Azure $ ./azure-vhd-utils upload --localvhdpath /home/ktenzer/cfme-azure-5.7.0.17-1.vhd --stgaccountname &lt;storage account&gt; --stgaccountkey &lt;storage key&gt; --containername templates --blobname cfme-azure-5.7.0.17-1.vhd --parallelism 8 Once the upload completes you can deploy the CloudForms Appliance in Azure. In order to do this we will use the Azure CLI which is python based. Install Python and dependencies $ sudo yum install python $ sudo yum install python-pip $ sudo yum install python-devel $ sudo yum install openssl-devel $ sudo yum install npm Install Azure CLI $ npm install azure-cli -g $ sudo npm install azure-cli -g $ sudo pip install --upgrade pip $ sudo pip install azure==2.0.0rc5 Deploy CloudForms Appliance Using the Azure CLI deploy CloudForms Appliance $ azure vm image create cfme-azure-5.7.0.17-1 --blob-url https://premiumsadpdhlose2disk.blob.core.windows.net/templates/cfme-azure-5.7.0.17-1.vhd --os Linux /home/ktenzer/cfme-azure-5.7.0.17-1.vhd Note: you can also use the Azure portal UI to create VM once the image is uploaded. Configure CloudForms in Azure Once the CloudForms Appliance is deployed you can access it using username/password or ssh-key depending on what you chose when creating VM in Azure. $ ssh ktenzer@&lt;CloudForms Appliance IP&gt; Run the appliance console $ sudo appliance_console">
  <meta name="twitter:url" content="http://localhost:4000/cloudforms/deploying-cloudforms-in-the-azure-cloud/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2017-03-23T00:00:00-07:00">





  

  


<link rel="canonical" href="http://localhost:4000/cloudforms/deploying-cloudforms-in-the-azure-cloud/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Keith Tenzer",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Keith Tenzer's Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Keith Tenzer's Blog
          <span class="site-subtitle">Cloud Computing and Code</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/index.html">About</a>
            </li><li class="masthead__menu-item">
              <a href="/conferences-and-events/index.html">Conferences and Events</a>
            </li><li class="masthead__menu-item">
              <a href="/videos/index.html">Videos</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#cloudforms" itemprop="item"><span itemprop="name">Cloudforms</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Deploying CloudForms in the Azure Cloud</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/main/me.png" alt="Keith Tenzer" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Keith Tenzer</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Principal Solutions Architect at Red Hat</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Los Angeles, CA</span>
        </li>
      

      
        
          
        
          
        
          
            <li><a href="https://twitter.com/keithtenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Deploying CloudForms in the Azure Cloud">
    <meta itemprop="description" content="OverviewIn this article we will deploy the CloudForms appliance in the Azure cloud. CloudForms is a cloud management platform based on the opensource project manageiq. Red Hat bought manageiq a few years back and opensourced the software. Originally it was designed to manage VMware but over the years has expanded to many additional traditional as well as cloud platforms. You can use this article as reference for both CloudForms and ManageIQ.CloudForms can connect to many cloud providers such as RHEV (Red Hat Enterprise Virtualization), VMware, Hyper-V, OpenStack, Amazon Web Services (AWS), Google Cloud Engine (GCE) and Azure. Large organizations don&#39;t have one cloud but many and in addition typically have on-premise, off-premise as well as public. All of these various platforms creates a lot of complexity if not managed right. CloudForms can create a bridge between traditional (mode 1) and cloud native (mode 2) workloads, offering applications a path to switch between these modes. In addition, CloudForms allows an IT organization to act as a cloud broker between the various public platforms. Finally CloudForms can be used to automatically deploy and manage applications across the various cloud platforms. Businesses have choice in platform, flexibility and speed while IT can manage it all centrally applying common policies or rule-sets regardless of where workloads are running.PrepareRed Hat provides CloudForms as a appliance. The appliances each have various formats, depending on the platform. For Microsft Hyper-V and Azure, Red Hat provides a Virtual Hard Disk (VHD). The vhd is a dynamic disk. Azure unfortunately does not support dynamic disks but only fixed disks. In order to import CloudForms appliance in Azure we need to convert the appliance vhd to fixed disk. In addition the vhd will be fixed size of around 40GB. To prevent having to upload 40GB and just the actual data which is closer to 2GB we will use several tools. You can of course use Powershell, using the Azure cmdlets. If you are a Linux guy like me though, that isn&#39;t an option. Thankfully Microsoft has provided a tool written in Go that works great for uploading disks to Azure. In addition Microsoft provides a CLI similar to functionality of Powershell written in python.Convert VHD from dynamic to fixedThe first question you might have is why? Well Red Hat doesn&#39;t want you to have to download a 40GB image so they provide a dynamic disk. In the next steps we will take that image, convert to fixed disk and upload to Azure, ignoring the zero&#39;ed blocks.Convert image to raw using qemu tools# qemu-img convert -f vpc -O raw cfme-azure-5.7.0.17-1.x86_64.vhd cfme-azure-5.7.0.17-1.rawCalculate fixed image size$sudo rawdisk=&quot;cfme-azure-5.7.0.17-1.raw&quot;$sudo vhddisk=&quot;cfme-azure-5.7.0.17-1.vhd&quot;$sudo MB=$((1024*1024))$sudo rounded_size=$((($size/$MB + 1)*$MB))$sudo size=$(qemu-img info -f raw --output json &quot;$rawdisk&quot; | gawk &#39;match($0, /&quot;virtual-size&quot;: ([0-9]+),/, val) {print val[1]}&#39;)$sudo rounded_size=$((($size/$MB + 1)*$MB))Resize image$sudo qemu-img resize -f raw &quot;$rawdisk&quot; $rounded_size$sudo qemu-img convert -f raw -o subformat=fixed,force_size -O vpc &quot;$rawdisk&quot; &quot;$vhddisk&quot;Download Azure VHD ToolsAs mentioned the Azure VHD tools are written in Go so you need to first install Go. I installed version 1.7.4.$ gunzip go1.7.4.linux-amd64.tar.gz $ tar xvf go1.7.4.linux-amd64.tar $ cd goExport Environment Parameters $ mkdir $HOME/work $ export GOPATH=$HOME/work $ export PATH=$PATH:$GOPATH/binInstall VHD Tools $ go get github.com/Microsoft/azure-vhd-utilsUpload the CloudForms Fixed Disk to Azure$ ./azure-vhd-utils upload --localvhdpath /home/ktenzer/cfme-azure-5.7.0.17-1.vhd --stgaccountname &lt;storage account&gt; --stgaccountkey &lt;storage key&gt; --containername templates --blobname cfme-azure-5.7.0.17-1.vhd --parallelism 8Once the upload completes you can deploy the CloudForms Appliance in Azure. In order to do this we will use the Azure CLI which is python based.Install Python and dependencies$ sudo yum install python$ sudo yum install python-pip$ sudo yum install python-devel$ sudo yum install openssl-devel$ sudo yum install npmInstall Azure CLI$ npm install azure-cli -g$ sudo npm install azure-cli -g$ sudo pip install --upgrade pip$ sudo pip install azure==2.0.0rc5Deploy CloudForms ApplianceUsing the Azure CLI deploy CloudForms Appliance$ azure vm image create cfme-azure-5.7.0.17-1 --blob-url https://premiumsadpdhlose2disk.blob.core.windows.net/templates/cfme-azure-5.7.0.17-1.vhd --os Linux /home/ktenzer/cfme-azure-5.7.0.17-1.vhdNote: you can also use the Azure portal UI to create VM once the image is uploaded.Configure CloudForms in AzureOnce the CloudForms Appliance is deployed you can access it using username/password or ssh-key depending on what you chose when creating VM in Azure.$ ssh ktenzer@&lt;CloudForms Appliance IP&gt;Run the appliance console$ sudo appliance_console">
    <meta itemprop="datePublished" content="2017-03-23T00:00:00-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Deploying CloudForms in the Azure Cloud
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2017-03-23T00:00:00-07:00">March 23, 2017</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1><img class="alignnone  wp-image-8167" src="/assets/2017/03/redhat-ms.png" alt="redhat-ms" width="300" height="231" /></h1>
<h3>Overview</h3>
<p>In this article we will deploy the CloudForms appliance in the Azure cloud. CloudForms is a cloud management platform based on the opensource project <a href="http://manageiq.org">manageiq</a>. Red Hat bought manageiq a few years back and opensourced the software. Originally it was designed to manage VMware but over the years has expanded to many additional traditional as well as cloud platforms. You can use this article as reference for both CloudForms and ManageIQ.</p>
<p>CloudForms can connect to many cloud providers such as RHEV (Red Hat Enterprise Virtualization), VMware, Hyper-V, OpenStack, Amazon Web Services (AWS), Google Cloud Engine (GCE) and Azure. Large organizations don't have one cloud but many and in addition typically have on-premise, off-premise as well as public. All of these various platforms creates a lot of complexity if not managed right. CloudForms can create a bridge between traditional (mode 1) and cloud native (mode 2) workloads, offering applications a path to switch between these modes. In addition, CloudForms allows an IT organization to act as a cloud broker between the various public platforms. Finally CloudForms can be used to automatically deploy and manage applications across the various cloud platforms. Businesses have choice in platform, flexibility and speed while IT can manage it all centrally applying common policies or rule-sets regardless of where workloads are running.</p>
<p><!--more--></p>
<h3>Prepare</h3>
<p>Red Hat provides CloudForms as a appliance. The appliances each have various formats, depending on the platform. For Microsft Hyper-V and Azure, Red Hat provides a Virtual Hard Disk (VHD). The vhd is a dynamic disk. Azure unfortunately does not support dynamic disks but only fixed disks. In order to import CloudForms appliance in Azure we need to convert the appliance vhd to fixed disk. In addition the vhd will be fixed size of around 40GB. To prevent having to upload 40GB and just the actual data which is closer to 2GB we will use several tools. You can of course use Powershell, using the Azure cmdlets. If you are a Linux guy like me though, that isn't an option. Thankfully Microsoft has provided a tool written in Go that works great for uploading disks to Azure. In addition Microsoft provides a CLI similar to functionality of Powershell written in python.</p>
<p><strong>Convert VHD from dynamic to fixed</strong></p>
<p>The first question you might have is why? Well Red Hat doesn't want you to have to download a 40GB image so they provide a dynamic disk. In the next steps we will take that image, convert to fixed disk and upload to Azure, ignoring the zero'ed blocks.</p>
<p><strong>Convert image to raw using qemu tools</strong></p>
<pre># qemu-img convert -f vpc -O raw cfme-azure-5.7.0.17-1.x86_64.vhd cfme-azure-5.7.0.17-1.raw</pre>
<p><strong>Calculate fixed image size</strong></p>
<pre>$sudo rawdisk="cfme-azure-5.7.0.17-1.raw"
$sudo vhddisk="cfme-azure-5.7.0.17-1.vhd"
$sudo MB=$((1024*1024))
$sudo rounded_size=$((($size/$MB + 1)*$MB))
$sudo size=$(qemu-img info -f raw --output json "$rawdisk" | gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
$sudo rounded_size=$((($size/$MB + 1)*$MB))</pre>
<p><strong>Resize image</strong></p>
<pre>$sudo qemu-img resize -f raw "$rawdisk" $rounded_size
$sudo qemu-img convert -f raw -o subformat=fixed,force_size -O vpc "$rawdisk" "$vhddisk"</pre>
<p><strong>Download Azure VHD Tools</strong></p>
<p>As mentioned the Azure VHD tools are written in Go so you need to first install Go. I installed version 1.7.4.</p>
<pre>$ gunzip go1.7.4.linux-amd64.tar.gz 
$ tar xvf go1.7.4.linux-amd64.tar 
$ cd go</pre>
<p><strong>Export Environment Parameters</strong></p>
<pre> $ mkdir $HOME/work
 $ export GOPATH=$HOME/work
 $ export PATH=$PATH:$GOPATH/bin</pre>
<p><strong>Install VHD Tools</strong></p>
<pre> $ go get github.com/Microsoft/azure-vhd-utils</pre>
<p><strong>Upload the CloudForms Fixed Disk to Azure</strong></p>
<pre>$ ./azure-vhd-utils upload --localvhdpath /home/ktenzer/cfme-azure-5.7.0.17-1.vhd --stgaccountname &lt;storage account&gt; --stgaccountkey &lt;storage key&gt; --containername templates --blobname cfme-azure-5.7.0.17-1.vhd --parallelism 8</pre>
<p>Once the upload completes you can deploy the CloudForms Appliance in Azure. In order to do this we will use the Azure CLI which is python based.</p>
<p><strong>Install Python and dependencies</strong></p>
<pre>$ sudo yum install python
$ sudo yum install python-pip
$ sudo yum install python-devel
$ sudo yum install openssl-devel
$ sudo yum install npm</pre>
<p><strong>Install Azure CLI</strong></p>
<pre>$ npm install azure-cli -g
$ sudo npm install azure-cli -g
$ sudo pip install --upgrade pip
$ sudo pip install azure==2.0.0rc5</pre>
<p><strong>Deploy CloudForms Appliance</strong></p>
<p>Using the Azure CLI deploy CloudForms Appliance</p>
<pre>$ azure vm image create cfme-azure-5.7.0.17-1 --blob-url https://premiumsadpdhlose2disk.blob.core.windows.net/templates/cfme-azure-5.7.0.17-1.vhd --os Linux /home/ktenzer/cfme-azure-5.7.0.17-1.vhd</pre>
<p>Note: you can also use the Azure portal UI to create VM once the image is uploaded.</p>
<h3>Configure CloudForms in Azure</h3>
<p>Once the CloudForms Appliance is deployed you can access it using username/password or ssh-key depending on what you chose when creating VM in Azure.</p>
<pre>$ ssh ktenzer@&lt;CloudForms Appliance IP&gt;</pre>
<p><strong>Run the appliance console</strong></p>
<pre>$ sudo appliance_console

Welcome to the CFME Virtual Appliance.

To modify the configuration, use a web browser to access the management page.

Hostname: CFME
IP Address: 10.0.0.9
Netmask: 255.255.255.0
Gateway: 10.0.0.1
Primary DNS: 168.63.129.16
Secondary DNS: 
Search Order: v1tt5gv0hqjudfkkftdccsm4cc.ax.internal.cloudapp.net
MAC Address: 00:0d:3a:28:0c:27
Timezone: Europe/Berlin
Local Database Server: running (primary)
CFME Server: running
CFME Database: localhost
Database/Region: vmdb_production / 1
External Auth: not configured
CFME Version: 5.7.0.17


Press any key to continue.</pre>
<pre>Advanced Setting

1) Set DHCP Network Configuration
2) Set Static Network Configuration
3) Test Network Configuration
4) Set Hostname
5) Set Timezone
6) Set Date and Time
7) Restore Database From Backup
8) Configure Database
9) Configure Database Replication
10) Configure Database Maintenance
11) Logfile Configuration
12) Configure Application Database Failover Monitor
13) Extend Temporary Storage
14) Configure External Authentication (httpd)
15) Update External Authentication Options
16) Generate Custom Encryption Key
17) Harden Appliance Using SCAP Configuration
18) Stop EVM Server Processes
19) Start EVM Server Processes
20) Restart Appliance
21) Shut Down Appliance
22) Summary Information
23) Quit

Choose the advanced setting:</pre>
<p>Verify the network configuration, hostname and timezone.</p>
<p><strong>Configure database</strong></p>
<pre>Configure Database

Database Operation

1) Create Internal Database
2) Create Region in External Database
3) Join Region in External Database
4) Reset Configured Database

Choose the database operation:</pre>
<p>Create an internal database, choosing default options</p>
<p>Once database has been created and instantiated start the EVM processes from main menu. Once that completes you can access the CloudForms Appliance UI.</p>
<pre>https://&lt;CloudForms Appliance IP&gt;
username: admin
password: smartvm</pre>
<h3>Summary</h3>
<p>In this article we explored how to deploy the CloudForms appliance in the Azure cloud. CloudForms can provide insights into many cloud providers and provide a single-pane for administrating an organizations various cloud platforms. This enables an IT organization to take the role of cloud broker, providing an organization flexibility between various platforms without giving up control and oversight. I hope you found this article of use. If you have additional feedback or comments please let me know.</p>
<p>Happy Clouding in Azure!</p>
<p>(c) 2017 Keith Tenzer</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#azure" class="page__taxonomy-item" rel="tag">Azure</a><span class="sep">, </span>
    
      <a href="/tags/#cloud" class="page__taxonomy-item" rel="tag">Cloud</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#cloudforms" class="page__taxonomy-item" rel="tag">CloudForms</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-03-23T00:00:00-07:00">March 23, 2017</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=keithtenzer&text=Deploying+CloudForms+in+the+Azure+Cloud%20http%3A%2F%2Flocalhost%3A4000%2Fcloudforms%2Fdeploying-cloudforms-in-the-azure-cloud%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fcloudforms%2Fdeploying-cloudforms-in-the-azure-cloud%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fcloudforms%2Fdeploying-cloudforms-in-the-azure-cloud%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/openshift/openshift-enterprise-3-4-all-in-one-lab-environment/" class="pagination--pager" title="OpenShift Enterprise 3.4: all-in-one Lab Environment
">Previous</a>
    
    
      <a href="/openshift/storage-for-containers-using-gluster-part-ii/" class="pagination--pager" title="Storage for Containers using Gluster – Part II
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/building-ansible-operators-1-2-3/" rel="permalink">Building Ansible Operators 1-2-3
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-12-03T00:00:00-08:00">December 3, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
In this article we will go step by step in build a Kubernetes Operator using Ansible and the Operator Framework. Operators provide ability to not on...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-service-mesh-getting-started-guide/" rel="permalink">OpenShift Service Mesh Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-04-27T00:00:00-07:00">April 27, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">






Overview
In this article we will explore the OpenShift Service Mesh and deploy a demo application to better understand the various concepts. First you...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-4-aws-ipi-installation-getting-started-guide/" rel="permalink">OpenShift 4 AWS IPI Installation Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-01-18T00:00:00-08:00">January 18, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">


Happy new year as this will be the first post of 2021! 2020 was obviously a challenging year, my hope is I will have more time to devote to blogging in 20...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ansible/windows-automation-with-ansible-getting-started-guide/" rel="permalink">Windows Automation with Ansible: Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-05-19T00:00:00-07:00">May 19, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
In this article we will focus on how to get started with automation of windows using Ansible. Specifically we will look at installing 3rd party sof...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/keithtenzer"" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Keith Tenzer. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
