<h3>Overview</h3>
<p>This post will cover installing Red Hat Enterprise Virtualization (RHEV) on an Intel NUC for the purpose of a lab environment. RHEV has two main components: RHEV-H and RHEV-M.<!--more--></p>
<h4>RHEV-H</h4>
<p>Red Hat Enterprise Virtualization Hypervisor (RHEV-H) is a compact, full-featured virtualization platform built on Red Hat Enterprise Linux (RHEL). It has a very small footprint (less than 100MB) and is built from only a subset of RHEL components plus the Kernel-Based Virtual Machine (KVM).</p>
<h4>RHEV-M</h4>
<p>Red Hat Enterprise Virtualization Management (RHEV-M) is a virtual management console built on Red Hat Enterprise Linux (RHEL). It interacts with individual RHEV-H nodes using the Virtual Desktop Server Manager (VDSM). A VDSM agent is running on each of the RHEV-H nodes. RHEV-M allows administrators to manage multiple data centers and their network, compute and storage resources. In addition RHEV-M provides a central repository for storing virtual machines, disks, images and virtual machine snapshots.</p>
<p><a href="https://keithtenzer.files.wordpress.com/2015/01/rhev_architecture2.png"><img class=" wp-image-370 aligncenter" src="/assets/2015/01/rhev_architecture2.png?w=300" alt="RHEV_Architecture" width="711" height="339" /></a></p>
<h3>Requirements</h3>
<ul>
<li><a href="http://www.amazon.com/Intel-BOXD54250WYKH1-Core-i5-4250U-Graphics/dp/B00HZDLNWO/ref=sr_1_fkmr0_1?ie=UTF8&amp;qid=1419520848&amp;sr=8-1-fkmr0&amp;keywords=Intel+NUC+34010WYKH">Intel NUC 34010WYKH</a></li>
<li><a href="http://www.amazon.com/Samsung-250GB-2-5-Inch-Internal-MZ-7TE250BW/dp/B00E3W1726/ref=sr_1_1?ie=UTF8&amp;qid=1419520871&amp;sr=8-1&amp;keywords=Samsung+SSD+840+EVO">Samsung SSD 840 EVO</a></li>
<li><a href="http://www.amazon.com/Crucial-PC3-12800-204-Pin-Notebook-CT102464BF160B/dp/B006YG8X9Y/ref=sr_1_sc_1?ie=UTF8&amp;qid=1419520904&amp;sr=8-1-spell&amp;keywords=Cruicial+8GB+DDR3+1600">Crucial 8GB DDR3 1600 RAM (1.35V)</a></li>
<li><a href="https://access.redhat.com/products/red-hat-enterprise-virtualization/get-started">RHEV Hypervisor</a></li>
<li><a href="https://access.redhat.com/products/red-hat-enterprise-linux/downloads#?&amp;portal_product=Red+Hat+Enterprise+Linux&amp;portal_product_variant=Red+Hat+Enterprise+Linux+Server&amp;portal_product_minor=6.6&amp;portal_product_architecture=x86_64">RHEL 6.6</a></li>
</ul>
<h3>Install RHEV-H on Intel NUC</h3>
<p>In order to install a RHEV-H node on our Intel NUC (bare-metal) we will need to download <a href="https://access.redhat.com/products/red-hat-enterprise-virtualization/get-started">RHEV-H</a> ISO and <a href="http://unetbootin.sourceforge.net/">UNetbootin</a>. The UNetbootin software allows us to create a bootable USB with the RHEV-H image.</p>
<p><a href="https://keithtenzer.files.wordpress.com/2014/12/unetbootin.jpg"><img class=" wp-image-287 aligncenter" src="/assets/2015/01/unetbootin.jpg?w=300" alt="unetbootin" width="661" height="456" /></a></p>
<p>Once you have bootable USB with the RHEV-H image you can simply start the NUC, insert USB and go through the RHEV-H installation.</p>
<p>Note: You may have to change the boot order in the BIOS of your Intel NUC or configure BIOS to boot from USB.</p>
<h3>Install RHEL-M</h3>
<p>In order to manage one or more RHEV-H nodes, a RHEL system running RHEV-M is required. You can use any 6.x version of RHEL for the RHEV-M system. As of the writing of this post RHEL 7 is not yet supported for RHEV-M. RHEL 7 will be supported with RHEV version 3.5. For the purpose of this lab I installed RHEL 6.6 as a Virtual Machine running under <a href="http://www.linux-kvm.org/page/Main_Page">KVM </a>on my PC.</p>
<p>Note: Make sure to allocate at least 4GB of RAM to the RHEV-M system.</p>
<p>Once RHEL 6.6 has been installed proceed with following steps:</p>
<ul>
<li>Register subscription</li>
<li>
<pre>subscription-manager register</pre>
</li>
<li>Automatically attach subscriptions</li>
<li>
<pre>subscription-manager attach --auto</pre>
</li>
</ul>
<p style="text-align:center;">OR</p>
<ul>
<li style="text-align:left;">List available subscriptions</li>
<li>
<pre>subscription-manager list --available</pre>
</li>
<li>Attach a specific subscription (the pool id is listed in above command)</li>
</ul>
<ul>
<li>
<pre>subscription-manager attach --pool=8a85f9814a7ea2ec014a813b19643ce5</pre>
</li>
</ul>
<ul>
<li>Enable required channels</li>
</ul>
<ul>
<li>
<pre>yum-config-manager --enable rhel-6-server-rpms</pre>
</li>
</ul>
<ul>
<li>
<pre>yum-config-manager --enable rhel-6-server-supplementary-rpms</pre>
</li>
</ul>
<ul>
<li>
<pre>yum-config-manager --enable rhel-6-server-rhevm-3.4-rpms</pre>
</li>
</ul>
<ul>
<li>
<pre>yum-config-manager --enable jb-eap-6-for-rhel-6-server-rpms</pre>
</li>
<li>Install RHEV-M RPMs</li>
</ul>
<ul>
<li>
<pre>yum update; yum install rhevm</pre>
</li>
<li>Configure RHEV-M</li>
<li>
<pre>engine-setup</pre>
</li>
</ul>
<p>After completing the installation you can go to following URL to connect to RHEV-M http://:80/ovirt-engine</p>
<h3>Configure RHEV-M</h3>
<p>Once the RHEV-H and RHEV-M systems are configured we can add the RHEV-H node in RHEV-M. The first step is to configure the oVirt engine from the RHEV-H node to point to the FQDN or IP of the RHEV-M host.</p>
<h4>Configure oVirt engine on RHEV-H host</h4>
<ul>
<li>
<pre>ssh -l admin &lt;RHEV-H FQDN or IP&gt;</pre>
</li>
</ul>
<h4><a href="https://keithtenzer.files.wordpress.com/2014/12/rhev_ovirt_engine.jpg"><img class=" wp-image-291 aligncenter" src="/assets/2015/01/rhev_ovirt_engine.jpg?w=300" alt="RHEV_ovirt_engine" width="718" height="230" /></a> Add RHEV-H host in RHEV-M</h4>
<p>Connect to RHEV-M host through following URL: http://:80/ovirt-engine</p>
<ul>
<li>Select the RHEV-H host and enter maintenance mode.</li>
</ul>
<p><a href="https://keithtenzer.files.wordpress.com/2014/12/rhev_maintenance.jpg"><img class=" wp-image-290 aligncenter" src="/assets/2015/01/rhev_maintenance.jpg?w=300" alt="RHEV_maintenance" width="705" height="214" /></a></p>
<p>For the purpose of the lab we will use local storage. Since local storage is not shared across RHEV-H nodes a standalone data center will be configured that uses local storage.</p>
<ul>
<li>Configure local storage domain</li>
</ul>
<p><a href="https://keithtenzer.files.wordpress.com/2014/12/rhev_local_storage.jpg"><img class=" wp-image-292 aligncenter" src="/assets/2015/01/rhev_local_storage.jpg?w=300" alt="RHEV_local_storage" width="711" height="486" /></a></p>
<ul>
<li> Attach ISO storage domain (configured when installing RHEV-M)</li>
</ul>
<p><a href="https://keithtenzer.files.wordpress.com/2014/12/rhev_attach_iso_storage.jpg"><img class=" wp-image-294 aligncenter" src="/assets/2015/01/rhev_attach_iso_storage.jpg?w=300" alt="RHEV_attach_ISO_storage" width="717" height="270" /></a></p>
<p>At this point we can start creating virtual machines, templates and various resource pools.If you have any questions regarding the Intel NUC, RHEV-H or RHEV-M setup please feel free to ask. In a future post I will cover API integration with RHEV-M (oVirt).</p>
<h4>Troubleshooting</h4>
<ul>
<li><strong>Can't add local storage domain</strong> - This problem happens when you have configured RHEV-H host more than once in RHEV-M. Remove anything under /data/images/rhev on RHEV-H host.</li>
<li><strong>Accessing root shell on RHEV-H host</strong> - you need to connect via ssh as admin user and then press "F2" in the RHEV-H menu.</li>
<li><strong>ISOs not available when creating new VMs</strong> - The ISO storage domain must be attached to the RHEV-H host. Make sure hostname of RHEV-M host resolves from RHEV-H node otherwise add entry to /etc/hosts file.</li>
</ul>
<p>(c) 2015 Keith Tenzer</p>
