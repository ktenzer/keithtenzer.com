<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
<link rel="icon" href="/assets/main/me.png">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Application Containers: Kubernetes and Docker from Scratch - Keith Tenzer’s Blog</title>
<meta name="description" content="Overview In this article we will look at how to configure a Kubernetes cluster using the Docker container format on CentOS or RHEL 7.1. For a detailed overview on Kubernetes and Docker take a look at this article. A Kubernetes cluster is comprised of a master and N nodes. The master acts as a control plane for the cluster and in this case also exposes a private Docker registry. A Kubernetes node runs Docker container images.  Requirements In this article we will setup a master and one node. At minimum two hosts will be required. Kubernetes also has the following networking requirements:  all containers can communicate with all other containers without NAT all nodes can communicate with all containers (and vice-versa) without NAT the IP that a container sees itself as is the same IP that others see it as  In order to meet these networking requirements an overlay network  must be configured. Two commonly used overlay networks for Kuberentes are Flannel and Open vSwitch. In this article we will use Flannel. Setup Kubernetes Master Creating a Kubernetes master means configuring Kubernetes, Etcd, Flannel, Docker and a private Docker registry. The private Docker registry is used by the nodes in order to pull images. Install packages and enable services #yum update -y #yum install -y docker docker-registry etcd kubernetes flannel #for SERVICES in docker.service docker-registry etcd kube-apiserver kube-controller-manager kube-scheduler flanneld     do systemctl enable $SERVICES  done  Configure Private Docker Registry #vi /etc/sysconfig/docker INSECURE_REGISTRY=&#39;--insecure-registry kube-master.lab.com:5000&#39;  Configure Kuberentes API Server #vi /etc/kubernetes/apiserver KUBE_API_ADDRESS=&quot;--address=0.0.0.0&quot; KUBE_API_PORT=&quot;--port=8080&quot; KUBE_ETCD_SERVERS=&quot;--etcd_servers=http://kube-master.lab.com:4001&quot;  Configure Kubernetes Master #vi /etc/kubernetes/config KUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot;  Configure Kubernetes Nodes (kubelets) #vi /etc/kubernetes/controller-manager KUBELET_ADDRESSES=&quot;--machines=kube-node1.lab.com&quot; Configure ETCD #vi /etc/etcd/etcd.conf ETCD_LISTEN_PEER_URLS=&quot;http://localhost:2380,http://localhost:7001&quot; ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:4001,http://0.0.0.0:2379&quot; #systemctl start etcd Configure Overlay Network using Flannel #vi /etc/sysconfig/flanneld FLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot; FLANNEL_ETCD_KEY=&quot;/flannel/network&quot; FLANNEL_OPTIONS=&quot;eth0&quot; #vi /root/flannel-config.json {    &quot;Network&quot;: &quot;10.100.0.0/16&quot;,    &quot;SubnetLen&quot;: 24,    &quot;SubnetMin&quot;: &quot;10.100.50.0&quot;,    &quot;SubnetMax&quot;: &quot;10.100.199.0&quot;,    &quot;Backend&quot;: {    &quot;Type&quot;: &quot;vxlan&quot;,    &quot;VNI&quot;: 1    }  } curl -L http://kube-master.lab.com:4001/v2/keys/flannel/network/config -XPUT --data-urlencode value@flannel-config.json Download Docker Images to private registry #systemctl start docker #systemctl start docker-registry #for IMAGE in rhel6 rhel7  kubernetes/kube2sky:1.1 kubernetes/pause:go    do docker pull $IMAGE    docker tag $IMAGE kube-master.lab.com:5000/$IMAGE    docker push kube-master.lab.com:5000/$IMAGES done systemctl reboot Setup Kubernetes Node In this example we will setup a Kubernetes node from scratch. It is also possible to use a container OS like RHEL Atomic as a Kubernetes node. RHEL Atomic is an OS optimized for running containers. Choosing whether to use RHEL Atomic or a standard RHEL depends greatly on your specific requirements. Install Packages and enable services #yum update -y #yum install -y docker docker-registry etcd kubernetes flannel #for SERVICES in docker.service kubelet kube-proxy flanneld    do  systemctl enable $SERVICES done Configure Kubernets Master #vi /etc/kubernetes/config KUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot; Configure Kubernetes Node (kubelet) #vi /etc/kubernetes/kubelet KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot; KUBELET_PORT=&quot;--port=10250&quot; KUBELET_HOSTNAME=&quot;&quot; KUBELET_API_SERVER=&quot;--api_servers=http://kube-master.lab.com:8080&quot; Configure Docker #vi /etc/sysconfig/docker ADD_REGISTRY=&#39;--add-registry registry.access.redhat.com&#39; ADD_REGISTRY=&#39;--add-registry kube-master.lab.com:5000&#39; Configure Flannel #vi /etc/sysconfig/flanneld FLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot; FLANNEL_ETCD_KEY=&quot;/flannel/network&quot; FLANNEL_OPTIONS=&quot;eth0&quot; #systemctl reboot Summary In this article we went through the steps of building a Kubernetes cluster from scratch on RHEL or CentOS 7.1. As you have seen standing up a Kubernetes cluster can be done very easily. Hopefully you have found this article helpful, feedback is always greatly appreciated. Happy Containerizing!  (c) 2015 Keith Tenzer">


  <meta name="author" content="Keith Tenzer">
  
  <meta property="article:author" content="Keith Tenzer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Keith Tenzer's Blog">
<meta property="og:title" content="Application Containers: Kubernetes and Docker from Scratch">
<meta property="og:url" content="http://localhost:4000/containers/application-containers-kubernetes-and-docker-from-scratch/">


  <meta property="og:description" content="Overview In this article we will look at how to configure a Kubernetes cluster using the Docker container format on CentOS or RHEL 7.1. For a detailed overview on Kubernetes and Docker take a look at this article. A Kubernetes cluster is comprised of a master and N nodes. The master acts as a control plane for the cluster and in this case also exposes a private Docker registry. A Kubernetes node runs Docker container images.  Requirements In this article we will setup a master and one node. At minimum two hosts will be required. Kubernetes also has the following networking requirements:  all containers can communicate with all other containers without NAT all nodes can communicate with all containers (and vice-versa) without NAT the IP that a container sees itself as is the same IP that others see it as  In order to meet these networking requirements an overlay network  must be configured. Two commonly used overlay networks for Kuberentes are Flannel and Open vSwitch. In this article we will use Flannel. Setup Kubernetes Master Creating a Kubernetes master means configuring Kubernetes, Etcd, Flannel, Docker and a private Docker registry. The private Docker registry is used by the nodes in order to pull images. Install packages and enable services #yum update -y #yum install -y docker docker-registry etcd kubernetes flannel #for SERVICES in docker.service docker-registry etcd kube-apiserver kube-controller-manager kube-scheduler flanneld     do systemctl enable $SERVICES  done  Configure Private Docker Registry #vi /etc/sysconfig/docker INSECURE_REGISTRY=&#39;--insecure-registry kube-master.lab.com:5000&#39;  Configure Kuberentes API Server #vi /etc/kubernetes/apiserver KUBE_API_ADDRESS=&quot;--address=0.0.0.0&quot; KUBE_API_PORT=&quot;--port=8080&quot; KUBE_ETCD_SERVERS=&quot;--etcd_servers=http://kube-master.lab.com:4001&quot;  Configure Kubernetes Master #vi /etc/kubernetes/config KUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot;  Configure Kubernetes Nodes (kubelets) #vi /etc/kubernetes/controller-manager KUBELET_ADDRESSES=&quot;--machines=kube-node1.lab.com&quot; Configure ETCD #vi /etc/etcd/etcd.conf ETCD_LISTEN_PEER_URLS=&quot;http://localhost:2380,http://localhost:7001&quot; ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:4001,http://0.0.0.0:2379&quot; #systemctl start etcd Configure Overlay Network using Flannel #vi /etc/sysconfig/flanneld FLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot; FLANNEL_ETCD_KEY=&quot;/flannel/network&quot; FLANNEL_OPTIONS=&quot;eth0&quot; #vi /root/flannel-config.json {    &quot;Network&quot;: &quot;10.100.0.0/16&quot;,    &quot;SubnetLen&quot;: 24,    &quot;SubnetMin&quot;: &quot;10.100.50.0&quot;,    &quot;SubnetMax&quot;: &quot;10.100.199.0&quot;,    &quot;Backend&quot;: {    &quot;Type&quot;: &quot;vxlan&quot;,    &quot;VNI&quot;: 1    }  } curl -L http://kube-master.lab.com:4001/v2/keys/flannel/network/config -XPUT --data-urlencode value@flannel-config.json Download Docker Images to private registry #systemctl start docker #systemctl start docker-registry #for IMAGE in rhel6 rhel7  kubernetes/kube2sky:1.1 kubernetes/pause:go    do docker pull $IMAGE    docker tag $IMAGE kube-master.lab.com:5000/$IMAGE    docker push kube-master.lab.com:5000/$IMAGES done systemctl reboot Setup Kubernetes Node In this example we will setup a Kubernetes node from scratch. It is also possible to use a container OS like RHEL Atomic as a Kubernetes node. RHEL Atomic is an OS optimized for running containers. Choosing whether to use RHEL Atomic or a standard RHEL depends greatly on your specific requirements. Install Packages and enable services #yum update -y #yum install -y docker docker-registry etcd kubernetes flannel #for SERVICES in docker.service kubelet kube-proxy flanneld    do  systemctl enable $SERVICES done Configure Kubernets Master #vi /etc/kubernetes/config KUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot; Configure Kubernetes Node (kubelet) #vi /etc/kubernetes/kubelet KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot; KUBELET_PORT=&quot;--port=10250&quot; KUBELET_HOSTNAME=&quot;&quot; KUBELET_API_SERVER=&quot;--api_servers=http://kube-master.lab.com:8080&quot; Configure Docker #vi /etc/sysconfig/docker ADD_REGISTRY=&#39;--add-registry registry.access.redhat.com&#39; ADD_REGISTRY=&#39;--add-registry kube-master.lab.com:5000&#39; Configure Flannel #vi /etc/sysconfig/flanneld FLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot; FLANNEL_ETCD_KEY=&quot;/flannel/network&quot; FLANNEL_OPTIONS=&quot;eth0&quot; #systemctl reboot Summary In this article we went through the steps of building a Kubernetes cluster from scratch on RHEL or CentOS 7.1. As you have seen standing up a Kubernetes cluster can be done very easily. Hopefully you have found this article helpful, feedback is always greatly appreciated. Happy Containerizing!  (c) 2015 Keith Tenzer">





  <meta name="twitter:site" content="@keithtenzer">
  <meta name="twitter:title" content="Application Containers: Kubernetes and Docker from Scratch">
  <meta name="twitter:description" content="Overview In this article we will look at how to configure a Kubernetes cluster using the Docker container format on CentOS or RHEL 7.1. For a detailed overview on Kubernetes and Docker take a look at this article. A Kubernetes cluster is comprised of a master and N nodes. The master acts as a control plane for the cluster and in this case also exposes a private Docker registry. A Kubernetes node runs Docker container images.  Requirements In this article we will setup a master and one node. At minimum two hosts will be required. Kubernetes also has the following networking requirements:  all containers can communicate with all other containers without NAT all nodes can communicate with all containers (and vice-versa) without NAT the IP that a container sees itself as is the same IP that others see it as  In order to meet these networking requirements an overlay network  must be configured. Two commonly used overlay networks for Kuberentes are Flannel and Open vSwitch. In this article we will use Flannel. Setup Kubernetes Master Creating a Kubernetes master means configuring Kubernetes, Etcd, Flannel, Docker and a private Docker registry. The private Docker registry is used by the nodes in order to pull images. Install packages and enable services #yum update -y #yum install -y docker docker-registry etcd kubernetes flannel #for SERVICES in docker.service docker-registry etcd kube-apiserver kube-controller-manager kube-scheduler flanneld     do systemctl enable $SERVICES  done  Configure Private Docker Registry #vi /etc/sysconfig/docker INSECURE_REGISTRY=&#39;--insecure-registry kube-master.lab.com:5000&#39;  Configure Kuberentes API Server #vi /etc/kubernetes/apiserver KUBE_API_ADDRESS=&quot;--address=0.0.0.0&quot; KUBE_API_PORT=&quot;--port=8080&quot; KUBE_ETCD_SERVERS=&quot;--etcd_servers=http://kube-master.lab.com:4001&quot;  Configure Kubernetes Master #vi /etc/kubernetes/config KUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot;  Configure Kubernetes Nodes (kubelets) #vi /etc/kubernetes/controller-manager KUBELET_ADDRESSES=&quot;--machines=kube-node1.lab.com&quot; Configure ETCD #vi /etc/etcd/etcd.conf ETCD_LISTEN_PEER_URLS=&quot;http://localhost:2380,http://localhost:7001&quot; ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:4001,http://0.0.0.0:2379&quot; #systemctl start etcd Configure Overlay Network using Flannel #vi /etc/sysconfig/flanneld FLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot; FLANNEL_ETCD_KEY=&quot;/flannel/network&quot; FLANNEL_OPTIONS=&quot;eth0&quot; #vi /root/flannel-config.json {    &quot;Network&quot;: &quot;10.100.0.0/16&quot;,    &quot;SubnetLen&quot;: 24,    &quot;SubnetMin&quot;: &quot;10.100.50.0&quot;,    &quot;SubnetMax&quot;: &quot;10.100.199.0&quot;,    &quot;Backend&quot;: {    &quot;Type&quot;: &quot;vxlan&quot;,    &quot;VNI&quot;: 1    }  } curl -L http://kube-master.lab.com:4001/v2/keys/flannel/network/config -XPUT --data-urlencode value@flannel-config.json Download Docker Images to private registry #systemctl start docker #systemctl start docker-registry #for IMAGE in rhel6 rhel7  kubernetes/kube2sky:1.1 kubernetes/pause:go    do docker pull $IMAGE    docker tag $IMAGE kube-master.lab.com:5000/$IMAGE    docker push kube-master.lab.com:5000/$IMAGES done systemctl reboot Setup Kubernetes Node In this example we will setup a Kubernetes node from scratch. It is also possible to use a container OS like RHEL Atomic as a Kubernetes node. RHEL Atomic is an OS optimized for running containers. Choosing whether to use RHEL Atomic or a standard RHEL depends greatly on your specific requirements. Install Packages and enable services #yum update -y #yum install -y docker docker-registry etcd kubernetes flannel #for SERVICES in docker.service kubelet kube-proxy flanneld    do  systemctl enable $SERVICES done Configure Kubernets Master #vi /etc/kubernetes/config KUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot; Configure Kubernetes Node (kubelet) #vi /etc/kubernetes/kubelet KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot; KUBELET_PORT=&quot;--port=10250&quot; KUBELET_HOSTNAME=&quot;&quot; KUBELET_API_SERVER=&quot;--api_servers=http://kube-master.lab.com:8080&quot; Configure Docker #vi /etc/sysconfig/docker ADD_REGISTRY=&#39;--add-registry registry.access.redhat.com&#39; ADD_REGISTRY=&#39;--add-registry kube-master.lab.com:5000&#39; Configure Flannel #vi /etc/sysconfig/flanneld FLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot; FLANNEL_ETCD_KEY=&quot;/flannel/network&quot; FLANNEL_OPTIONS=&quot;eth0&quot; #systemctl reboot Summary In this article we went through the steps of building a Kubernetes cluster from scratch on RHEL or CentOS 7.1. As you have seen standing up a Kubernetes cluster can be done very easily. Hopefully you have found this article helpful, feedback is always greatly appreciated. Happy Containerizing!  (c) 2015 Keith Tenzer">
  <meta name="twitter:url" content="http://localhost:4000/containers/application-containers-kubernetes-and-docker-from-scratch/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2015-06-01T00:00:00-07:00">





  

  


<link rel="canonical" href="http://localhost:4000/containers/application-containers-kubernetes-and-docker-from-scratch/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Keith Tenzer",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Keith Tenzer's Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Keith Tenzer's Blog
          <span class="site-subtitle">Cloud Computing and Code</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/index.html">About</a>
            </li><li class="masthead__menu-item">
              <a href="/conferences-and-events/index.html">Conferences and Events</a>
            </li><li class="masthead__menu-item">
              <a href="/videos/index.html">Videos</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#containers" itemprop="item"><span itemprop="name">Containers</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Application Containers: Kubernetes and Docker from Scratch</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/main/me.png" alt="Keith Tenzer" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Keith Tenzer</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Principal Solutions Architect at Red Hat</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Los Angeles, CA</span>
        </li>
      

      
        
          
        
          
        
          
            <li><a href="https://twitter.com/keithtenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Application Containers: Kubernetes and Docker from Scratch">
    <meta itemprop="description" content="OverviewIn this article we will look at how to configure a Kubernetes cluster using the Docker container format on CentOS or RHEL 7.1. For a detailed overview on Kubernetes and Docker take a look at this article. A Kubernetes cluster is comprised of a master and N nodes. The master acts as a control plane for the cluster and in this case also exposes a private Docker registry. A Kubernetes node runs Docker container images.RequirementsIn this article we will setup a master and one node. At minimum two hosts will be required. Kubernetes also has the following networking requirements:all containers can communicate with all other containers without NATall nodes can communicate with all containers (and vice-versa) without NATthe IP that a container sees itself as is the same IP that others see it asIn order to meet these networking requirements an overlay network  must be configured. Two commonly used overlay networks for Kuberentes are Flannel and Open vSwitch. In this article we will use Flannel.Setup Kubernetes MasterCreating a Kubernetes master means configuring Kubernetes, Etcd, Flannel, Docker and a private Docker registry. The private Docker registry is used by the nodes in order to pull images.Install packages and enable services#yum update -y#yum install -y docker docker-registry etcd kubernetes flannel#for SERVICES in docker.service docker-registry etcd kube-apiserver kube-controller-manager kube-scheduler flanneld    do systemctl enable $SERVICES done Configure Private Docker Registry#vi /etc/sysconfig/dockerINSECURE_REGISTRY=&#39;--insecure-registry kube-master.lab.com:5000&#39; Configure Kuberentes API Server#vi /etc/kubernetes/apiserverKUBE_API_ADDRESS=&quot;--address=0.0.0.0&quot;KUBE_API_PORT=&quot;--port=8080&quot;KUBE_ETCD_SERVERS=&quot;--etcd_servers=http://kube-master.lab.com:4001&quot; Configure Kubernetes Master#vi /etc/kubernetes/configKUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot;Configure Kubernetes Nodes (kubelets)#vi /etc/kubernetes/controller-managerKUBELET_ADDRESSES=&quot;--machines=kube-node1.lab.com&quot;Configure ETCD#vi /etc/etcd/etcd.confETCD_LISTEN_PEER_URLS=&quot;http://localhost:2380,http://localhost:7001&quot;ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:4001,http://0.0.0.0:2379&quot;#systemctl start etcdConfigure Overlay Network using Flannel#vi /etc/sysconfig/flanneldFLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot;FLANNEL_ETCD_KEY=&quot;/flannel/network&quot;FLANNEL_OPTIONS=&quot;eth0&quot;#vi /root/flannel-config.json{   &quot;Network&quot;: &quot;10.100.0.0/16&quot;,   &quot;SubnetLen&quot;: 24,   &quot;SubnetMin&quot;: &quot;10.100.50.0&quot;,   &quot;SubnetMax&quot;: &quot;10.100.199.0&quot;,   &quot;Backend&quot;: {   &quot;Type&quot;: &quot;vxlan&quot;,   &quot;VNI&quot;: 1   } }curl -L http://kube-master.lab.com:4001/v2/keys/flannel/network/config -XPUT --data-urlencode value@flannel-config.jsonDownload Docker Images to private registry#systemctl start docker#systemctl start docker-registry#for IMAGE in rhel6 rhel7  kubernetes/kube2sky:1.1 kubernetes/pause:go   do docker pull $IMAGE   docker tag $IMAGE kube-master.lab.com:5000/$IMAGE   docker push kube-master.lab.com:5000/$IMAGESdonesystemctl rebootSetup Kubernetes NodeIn this example we will setup a Kubernetes node from scratch. It is also possible to use a container OS like RHEL Atomic as a Kubernetes node. RHEL Atomic is an OS optimized for running containers. Choosing whether to use RHEL Atomic or a standard RHEL depends greatly on your specific requirements.Install Packages and enable services#yum update -y#yum install -y docker docker-registry etcd kubernetes flannel#for SERVICES in docker.service kubelet kube-proxy flanneld   do  systemctl enable $SERVICESdoneConfigure Kubernets Master#vi /etc/kubernetes/configKUBE_MASTER=&quot;--master=http://kube-master.lab.com:8080&quot;Configure Kubernetes Node (kubelet)#vi /etc/kubernetes/kubeletKUBELET_ADDRESS=&quot;--address=0.0.0.0&quot;KUBELET_PORT=&quot;--port=10250&quot;KUBELET_HOSTNAME=&quot;&quot;KUBELET_API_SERVER=&quot;--api_servers=http://kube-master.lab.com:8080&quot;Configure Docker#vi /etc/sysconfig/dockerADD_REGISTRY=&#39;--add-registry registry.access.redhat.com&#39;ADD_REGISTRY=&#39;--add-registry kube-master.lab.com:5000&#39;Configure Flannel#vi /etc/sysconfig/flanneldFLANNEL_ETCD=&quot;http://kube-master.lab.com:4001&quot;FLANNEL_ETCD_KEY=&quot;/flannel/network&quot;FLANNEL_OPTIONS=&quot;eth0&quot;#systemctl rebootSummaryIn this article we went through the steps of building a Kubernetes cluster from scratch on RHEL or CentOS 7.1. As you have seen standing up a Kubernetes cluster can be done very easily. Hopefully you have found this article helpful, feedback is always greatly appreciated.Happy Containerizing!(c) 2015 Keith Tenzer">
    <meta itemprop="datePublished" content="2015-06-01T00:00:00-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Application Containers: Kubernetes and Docker from Scratch
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2015-06-01T00:00:00-07:00">June 1, 2015</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h3>Overview</h3>
<p>In this article we will look at how to configure a Kubernetes cluster using the Docker container format on CentOS or RHEL 7.1. For a detailed overview on Kubernetes and Docker take a look at this <a href="http://keithtenzer.com/2015/04/15/containers-at-scale-with-kubernetes-on-openstack/">article</a>. A Kubernetes cluster is comprised of a master and N nodes. The master acts as a control plane for the cluster and in this case also exposes a private Docker registry. A Kubernetes node runs Docker container images.</p>
<p><img class="  wp-image-964 aligncenter" src="/assets/2015/06/kubernetes_high_level_architecture1.png?w=300" alt="Kubernetes_High_Level_Architecture" width="1373" height="856" /><!--more--></p>
<h3>Requirements</h3>
<p>In this article we will setup a master and one node. At minimum two hosts will be required. Kubernetes also has the following networking requirements:</p>
<ul>
<li>all containers can communicate with all other containers without NAT</li>
<li>all nodes can communicate with all containers (and vice-versa) without NAT</li>
<li>the IP that a container sees itself as is the same IP that others see it as</li>
</ul>
<p>In order to meet these networking requirements an overlay network  must be configured. Two commonly used overlay networks for Kuberentes are Flannel and Open vSwitch. In this article we will use Flannel.</p>
<h3>Setup Kubernetes Master</h3>
<p>Creating a Kubernetes master means configuring Kubernetes, Etcd, Flannel, Docker and a private Docker registry. The private Docker registry is used by the nodes in order to pull images.</p>
<h4>Install packages and enable services</h4>
<pre style="padding-left:30px;">#yum update -y</pre>
<pre style="padding-left:30px;">#yum install -y docker docker-registry etcd kubernetes flannel</pre>
<pre style="padding-left:30px;">#for SERVICES in docker.service docker-registry etcd kube-apiserver kube-controller-manager kube-scheduler flanneld 
   do systemctl enable $SERVICES 
done</pre>
<h4> Configure Private Docker Registry</h4>
<pre style="padding-left:30px;">#vi /etc/sysconfig/docker
INSECURE_REGISTRY='--insecure-registry kube-master.lab.com:5000'</pre>
<h4> Configure Kuberentes API Server</h4>
<pre style="padding-left:30px;">#vi /etc/kubernetes/apiserver
KUBE_API_ADDRESS="--address=0.0.0.0"
KUBE_API_PORT="--port=8080"
KUBE_ETCD_SERVERS="--etcd_servers=http://kube-master.lab.com:4001"</pre>
<h4> Configure Kubernetes Master</h4>
<pre style="padding-left:30px;">#vi /etc/kubernetes/config
KUBE_MASTER="--master=http://kube-master.lab.com:8080"
</pre>
<h4>Configure Kubernetes Nodes (kubelets)</h4>
<pre style="padding-left:30px;">#vi /etc/kubernetes/controller-manager
KUBELET_ADDRESSES="--machines=kube-node1.lab.com"</pre>
<h4>Configure ETCD</h4>
<pre style="padding-left:30px;">#vi /etc/etcd/etcd.conf
ETCD_LISTEN_PEER_URLS="http://localhost:2380,http://localhost:7001"
ETCD_LISTEN_CLIENT_URLS="http://0.0.0.0:4001,http://0.0.0.0:2379"</pre>
<pre style="padding-left:30px;">#systemctl start etcd</pre>
<h4>Configure Overlay Network using Flannel</h4>
<pre style="padding-left:30px;">#vi /etc/sysconfig/flanneld
FLANNEL_ETCD="http://kube-master.lab.com:4001"
FLANNEL_ETCD_KEY="/flannel/network"
FLANNEL_OPTIONS="eth0"</pre>
<pre style="padding-left:30px;">#vi /root/flannel-config.json
{
   "Network": "10.100.0.0/16",
   "SubnetLen": 24,
   "SubnetMin": "10.100.50.0",
   "SubnetMax": "10.100.199.0",
   "Backend": {
   "Type": "vxlan",
   "VNI": 1
   }
 }</pre>
<pre style="padding-left:30px;">curl -L http://kube-master.lab.com:4001/v2/keys/flannel/network/config -XPUT --data-urlencode value@flannel-config.json</pre>
<h4>Download Docker Images to private registry</h4>
<pre style="padding-left:30px;">#systemctl start docker</pre>
<pre style="padding-left:30px;">#systemctl start docker-registry</pre>
<pre style="padding-left:30px;">#for IMAGE in rhel6 rhel7  kubernetes/kube2sky:1.1 kubernetes/pause:go
   do docker pull $IMAGE
   docker tag $IMAGE kube-master.lab.com:5000/$IMAGE
   docker push kube-master.lab.com:5000/$IMAGES
done</pre>
<pre style="padding-left:30px;">systemctl reboot</pre>
<h3>Setup Kubernetes Node</h3>
<p>In this example we will setup a Kubernetes node from scratch. It is also possible to use a container OS like <a href="https://access.redhat.com/articles/rhel-atomic-getting-started">RHEL Atomic</a> as a Kubernetes node. RHEL Atomic is an OS optimized for running containers. Choosing whether to use RHEL Atomic or a standard RHEL depends greatly on your specific requirements.</p>
<h4>Install Packages and enable services</h4>
<pre style="padding-left:30px;">#yum update -y</pre>
<pre style="padding-left:30px;">#yum install -y docker docker-registry etcd kubernetes flannel</pre>
<pre>#for SERVICES in docker.service kubelet kube-proxy flanneld
   do  systemctl enable $SERVICES
done</pre>
<h4>Configure Kubernets Master</h4>
<pre style="padding-left:30px;">#vi /etc/kubernetes/config
KUBE_MASTER="--master=http://kube-master.lab.com:8080"</pre>
<h4>Configure Kubernetes Node (kubelet)</h4>
<pre style="padding-left:30px;">#vi /etc/kubernetes/kubelet
KUBELET_ADDRESS="--address=0.0.0.0"</pre>
<p>KUBELET_PORT="--port=10250"<br />
KUBELET_HOSTNAME=""</p>
<pre style="padding-left:30px;">KUBELET_API_SERVER="--api_servers=http://kube-master.lab.com:8080"</pre>
<h4>Configure Docker</h4>
<pre style="padding-left:30px;">#vi /etc/sysconfig/docker
ADD_REGISTRY='--add-registry registry.access.redhat.com'
ADD_REGISTRY='--add-registry kube-master.lab.com:5000'</pre>
<h4>Configure Flannel</h4>
<pre style="padding-left:30px;">#vi /etc/sysconfig/flanneld
FLANNEL_ETCD="http://kube-master.lab.com:4001"
FLANNEL_ETCD_KEY="/flannel/network"
FLANNEL_OPTIONS="eth0"</pre>
<pre style="padding-left:30px;">#systemctl reboot</pre>
<h3>Summary</h3>
<p>In this article we went through the steps of building a Kubernetes cluster from scratch on RHEL or CentOS 7.1. As you have seen standing up a Kubernetes cluster can be done very easily. Hopefully you have found this article helpful, feedback is always greatly appreciated.</p>
<div class="line">Happy Containerizing!</div>
<div class="line">
<p>(c) 2015 Keith Tenzer</p>
</div>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#docker" class="page__taxonomy-item" rel="tag">Docker</a><span class="sep">, </span>
    
      <a href="/tags/#kubernetes" class="page__taxonomy-item" rel="tag">Kubernetes</a><span class="sep">, </span>
    
      <a href="/tags/#lxc" class="page__taxonomy-item" rel="tag">LXC</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#containers" class="page__taxonomy-item" rel="tag">Containers</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2015-06-01T00:00:00-07:00">June 1, 2015</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=keithtenzer&text=Application+Containers%3A+Kubernetes+and+Docker+from+Scratch%20http%3A%2F%2Flocalhost%3A4000%2Fcontainers%2Fapplication-containers-kubernetes-and-docker-from-scratch%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fcontainers%2Fapplication-containers-kubernetes-and-docker-from-scratch%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fcontainers%2Fapplication-containers-kubernetes-and-docker-from-scratch%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/containers/application-containers-a-practical-howto-guide/" class="pagination--pager" title="Application Containers: A Practical HowTo Guide
">Previous</a>
    
    
      <a href="/rhev/red-hat-enterprise-virtualization-rhev-hypervisor-host-options/" class="pagination--pager" title="Red Hat Enterprise Virtualization (RHEV) - Hypervisor Host Options
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/building-ansible-operators-1-2-3/" rel="permalink">Building Ansible Operators 1-2-3
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-12-03T00:00:00-08:00">December 3, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
In this article we will go step by step to build a Kubernetes Operator using Ansible and the Operator Framework. Operators provide the ability to no...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-service-mesh-getting-started-guide/" rel="permalink">OpenShift Service Mesh Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-04-27T00:00:00-07:00">April 27, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">






Overview
In this article we will explore the OpenShift Service Mesh and deploy a demo application to better understand the various concepts. First you...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-4-aws-ipi-installation-getting-started-guide/" rel="permalink">OpenShift 4 AWS IPI Installation Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-01-18T00:00:00-08:00">January 18, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">


Happy new year as this will be the first post of 2021! 2020 was obviously a challenging year, my hope is I will have more time to devote to blogging in 20...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ansible/windows-automation-with-ansible-getting-started-guide/" rel="permalink">Windows Automation with Ansible: Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-05-19T00:00:00-07:00">May 19, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
In this article we will focus on how to get started with automation of windows using Ansible. Specifically we will look at installing 3rd party sof...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/keithtenzer"" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Keith Tenzer. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
