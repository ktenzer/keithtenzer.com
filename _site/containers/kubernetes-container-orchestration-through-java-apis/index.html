<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
<link rel="icon" href="/assets/main/me.png">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Kubernetes Container Orchestration through Java APIs - Keith Tenzer’s Blog</title>
<meta name="description" content="Overview In this article we will look at how to drive Kubernetes using Java APIs. More general information about Kubernetes and containers can be found here. Kubernetes itself offers a RESTful API but of course most prefer to use a client that is already handling low-level HTTP protocol operations.  It turns out Fabric8 is providing an integration and management platform above kubernetes and docker. In addition to integrating container orchestration through Kubernetes, Fabric8 also integrates with OpenShift v3 and Jube. OpenShift v3 exposes Kubernetes extensions such as app templates and builds. These Kubernetes extensions allow the container to be bundled with the application code and thus greatly increase application deployment cycles. Jube is a pure Java implementation of Kubernetes to provide containers to non-Linux world. In this article we will just focus on Kubernetes using the Fabric8 Java API. Setup The easiest way to get access to the Fabric8 Kubernetes Java API is through maven. Both Kubernetes and Fabric8 are changing fast so make sure you update and stay current with versions. The below dependency can be added to your pom.xml file. [code language=&quot;xml&quot;] &lt;dependency&gt;    &lt;groupId&gt;io.fabric8&lt;/groupId&gt;    &lt;artifactId&gt;kubernetes-api&lt;/artifactId&gt;    &lt;version&gt;2.0.37&lt;/version&gt; &lt;/dependency&gt; [/code] After updating the pom.xml you can run maven to add the new dependency to the local maven repository. mvn clean compile Connection In order to communicate with Kubernetes through the Fabric8 Java API a connection must be established. The Kubernetes API support HTTPS through TLS certificates but in this example we are just using HTTP and no authentication. The ConnectionExample class requires only IP and Port in order to return a kube connection object. By default unless specified the Kubernetes API will be read-only. In oder to get access to the read-write API the following environment parameters must be exported: export KUBERNETES_SERVICE_HOST=192.168.2.14 export KUBERNETES_SERVICE_PORT=8080 [code language=&quot;java&quot;] package examples; import io.fabric8.kubernetes.api.KubernetesClient; import io.fabric8.kubernetes.api.KubernetesFactory; public class ConnectionExample {    private String ip;    private String port;    public ConnectionExample(String ip, String port) {       this.ip= ip;       this.port = port;    }    public KubernetesClient getConnection() {       final String URI = &quot;http://&quot; + ip+ &quot;:&quot; + port;       final KubernetesClient kubernetes = new KubernetesClient(new KubernetesFactory(URI));       return kubernetes;    } } [/code] Once we have a Kubernetes connection object we can manage pods, replication controllers and services. We can perform typical RESTFul operations such as get, post, update and delete. Pods A pod is the most granular unit of management in Kubernetes and contains one or more containers that share the same resources. The main operations that can be performed are listing, creating and deleting pods. Listing Pods [code language=&quot;java&quot;]  public List&lt;KubePodModel&gt; getKubePods() {     List&lt;KubePodModel&gt; kubePodList = new ArrayList&lt;KubePodModel&gt;();     for (Pod pod : kubernetes.getPods().getItems()) {        KubePodModel model = new KubePodModel();        model.setId(pod.getId());        model.setApiVersion(pod.getApiVersion());        model.setCreationTime(pod.getCreationTimestamp());        model.setNamespace(pod.getNamespace());        model.setPodHostName(pod.getCurrentState().getHost());        model.setPodIp(pod.getCurrentState().getPodIP());        model.setStatus(pod.getCurrentState().getStatus());        kubePodList.add(podModel);     }     return kubePodModelList;  } [/code] Creating Pods [code language=&quot;java&quot;] public void createKubePod(String id, String namespace, List&lt;String&gt; containerPorts, String image, Map&lt;String, String&gt; labels) {    Pod pod = new Pod();    pod.setId(id);    pod.setLabels(labels);    PodState desiredState = new PodState();    ContainerManifest manifest = new ContainerManifest();    Container manifestContainer = new Container();    manifestContainer.setName(podId);    manifestContainer.setImage(image);    List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();    for (String containerInputPort : containerPorts) {       CharSequence inputStr = containerInputPort;       String patternStr = &quot;(\\S+):(\\S+)&quot;;       Pattern pattern = Pattern.compile(patternStr);       Matcher matcher = pattern.matcher(inputStr);       boolean matchFound = matcher.find();       if (matchFound) {          int contanierPort = Integer.valueOf(matcher.group(1));          String containerProto = matcher.group(2);          Port port = new Port();          port.setContainerPort(contanierPort);          port.setProtocol(containerProto);          ports.add(port);      }    }    manifestForContainer.setPorts(ports);    List&lt;Container&gt; containers = new ArrayList&lt;&gt;();    containers.add(manifestForContainer);    manifest.setContainers(containers);    desiredState.setManifest(manifest);    pod.setDesiredState(desiredState);    kubernetes.createPod(pod, namespace); } [/code] Deleting Pods [code language=&quot;java&quot;] public void deleteKubePod(String id, String namespace) {    kubernetes.deletePod(id, namespace); } [/code] Replication Controllers A replication controller is a pod that has N replicas. The replication controller ensures the number of pod replicas defined also exists. The replication controller will automatically manage pod deployments.The main operations that can be performed are listing, creating and deleting replication controllers. Listing Replication Controllers [code language=&quot;java&quot;] public List&lt;ControllerModel&gt; getKubeReplicationControllers() {    List&lt;ControllerModel&gt; controllerList = new ArrayList&lt;ReplicationControllerModel&gt;();    for (ReplicationController controller : kubernetes.getReplicationControllers().getItems()) {       ControllerModel model = new ControllerModel();       model.setId(controller.getId());       model.setApiVersion(controller.getApiVersion());       model.setCreationTime(controller.getCreationTimestamp());       model.setReplicas(controller.getCurrentState().getReplicas());       controllerList.add(model);    }    return controllerList; } [/code] Creating Replication Controllers [code language=&quot;java&quot;] public void createKubeReplicationController(String id, String namespace, int replicas, Map&lt;String, String&gt; controllerLabels,    Map&lt;String, String&gt; selectorLabels, String podId, String image, List&lt;String&gt; containerPorts, Map&lt;String, String&gt; podLabels, String manifestId) {    ReplicationController controller = new ReplicationController();    controller.setId(id);    controller.setNamespace(namespace);    controller.setLabels(controllerLabels);    PodState podState = new PodState();    ReplicationControllerState repState = new ReplicationControllerState();    repState.setReplicas(replicas);    repState.setReplicaSelector(selectorLabels);    PodTemplate podTmpl = new PodTemplate();    podTmpl.setLabels(podLabels);    ContainerManifest manifest = new ContainerManifest();    manifest.setId(manifestId);    Container manifestContainer = new Container();    manifestContainer.setName(podId);    manifestContainer.setImage(image);    List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();    for (String containerInputPort : containerPorts) {       CharSequence inputStr = containerInputPort;       String patternStr = &quot;(\\S+):(\\S+)&quot;;       Pattern pattern = Pattern.compile(patternStr);       Matcher matcher = pattern.matcher(inputStr);       boolean matchFound = matcher.find();       if (matchFound) {          int contanierPort = Integer.valueOf(matcher.group(1));          String containerProtocol = matcher.group(2);          Port port = new Port();          port.setContainerPort(contanierPort);          port.setProtocol(containerProtocol);          ports.add(port);       }    }    manifestContainer.setPorts(ports);    List&lt;Container&gt; containers = new ArrayList&lt;&gt;();    containers.add(manifestContainer);    manifest.setContainers(containers);    podState.setManifest(manifest);    podTmpl.setDesiredState(podState);    repState.setPodTemplate(podTmpl);    controller.setDesiredState(repState);    kubernetes.createReplicationController(controller, namespace); } [/code] Deleting Replication Controllers [code language=&quot;java&quot;] public void deleteReplicationController(String id, String namespace) {    kubernetes.deleteReplicationController(id, namespace); } [/code] Services A service exposes an application running in a pod externally using the Kubernetes proxy. It essentially maps public IPs / Ports on Kubernetes Minions (nodes) to internal container IPs / Ports. The main operations that can be performed are listing, creating and deleting services. Listing Services [code language=&quot;java&quot;] public List&lt;ServiceModel&gt; getKubeServices() {    List&lt;ServiceModel&gt; serviceList = new ArrayList&lt;ServiceModel&gt;();    for (Service service : kubernetes.getServices().getItems()) {        ServiceModel model = new ServiceModel();        model.setId(service.getId());        model.setApiVersion(service.getApiVersion());        model.setCreationTime(service.getCreationTimestamp());        model.setIp(service.getPortalIP());        model.setPort(service.getPort());        model.setProtocol(service.getProtocol());        serviceList.add(serviceModel);    }    return serviceList; } [/code] Creating Services [code language=&quot;java&quot;] public void createKubeService(String id, String namespace, int containerPort, int port, List&lt;String&gt; publicIps,    Map&lt;String, String&gt; labels, Map&lt;String, String&gt; selectors) {    Service service = new Service();    IntOrString containerPortObj = new IntOrString();    containerPortPojo.setIntVal(containerPort);    service.setId(id);    service.setContainerPort(containerPortObj);    service.setPort(port);    service.setPublicIPs(publicIps);    service.setLabels(labels);    service.setSelector(selectors);    kubernetes.createService(service, namespace); } [/code] Deleting Services [code language=&quot;java&quot;] public void deleteService(String id, String namespace) {    kubernetes.deleteService(id, namespace); } [/code] Summary Kubernetes and Linux containers are rapidly developing and emerging technologies. We have seen how to easily orchestrate containers in a Kubernetes environment using the Fabric8 Java APIs. Container orchestration is about performing operations on various Kubernetes components such as pods, replication controllers and services. Using the APIs you can easily build Kubernetes functionality into any Java applications. I hope you found this article useful. If you have examples of orchestrating Kubernetes or containers through APIs please share! Happy Containerizing! (c) 2015 Keith Tenzer">


  <meta name="author" content="Keith Tenzer">
  
  <meta property="article:author" content="Keith Tenzer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Keith Tenzer's Blog">
<meta property="og:title" content="Kubernetes Container Orchestration through Java APIs">
<meta property="og:url" content="http://localhost:4000/containers/kubernetes-container-orchestration-through-java-apis/">


  <meta property="og:description" content="Overview In this article we will look at how to drive Kubernetes using Java APIs. More general information about Kubernetes and containers can be found here. Kubernetes itself offers a RESTful API but of course most prefer to use a client that is already handling low-level HTTP protocol operations.  It turns out Fabric8 is providing an integration and management platform above kubernetes and docker. In addition to integrating container orchestration through Kubernetes, Fabric8 also integrates with OpenShift v3 and Jube. OpenShift v3 exposes Kubernetes extensions such as app templates and builds. These Kubernetes extensions allow the container to be bundled with the application code and thus greatly increase application deployment cycles. Jube is a pure Java implementation of Kubernetes to provide containers to non-Linux world. In this article we will just focus on Kubernetes using the Fabric8 Java API. Setup The easiest way to get access to the Fabric8 Kubernetes Java API is through maven. Both Kubernetes and Fabric8 are changing fast so make sure you update and stay current with versions. The below dependency can be added to your pom.xml file. [code language=&quot;xml&quot;] &lt;dependency&gt;    &lt;groupId&gt;io.fabric8&lt;/groupId&gt;    &lt;artifactId&gt;kubernetes-api&lt;/artifactId&gt;    &lt;version&gt;2.0.37&lt;/version&gt; &lt;/dependency&gt; [/code] After updating the pom.xml you can run maven to add the new dependency to the local maven repository. mvn clean compile Connection In order to communicate with Kubernetes through the Fabric8 Java API a connection must be established. The Kubernetes API support HTTPS through TLS certificates but in this example we are just using HTTP and no authentication. The ConnectionExample class requires only IP and Port in order to return a kube connection object. By default unless specified the Kubernetes API will be read-only. In oder to get access to the read-write API the following environment parameters must be exported: export KUBERNETES_SERVICE_HOST=192.168.2.14 export KUBERNETES_SERVICE_PORT=8080 [code language=&quot;java&quot;] package examples; import io.fabric8.kubernetes.api.KubernetesClient; import io.fabric8.kubernetes.api.KubernetesFactory; public class ConnectionExample {    private String ip;    private String port;    public ConnectionExample(String ip, String port) {       this.ip= ip;       this.port = port;    }    public KubernetesClient getConnection() {       final String URI = &quot;http://&quot; + ip+ &quot;:&quot; + port;       final KubernetesClient kubernetes = new KubernetesClient(new KubernetesFactory(URI));       return kubernetes;    } } [/code] Once we have a Kubernetes connection object we can manage pods, replication controllers and services. We can perform typical RESTFul operations such as get, post, update and delete. Pods A pod is the most granular unit of management in Kubernetes and contains one or more containers that share the same resources. The main operations that can be performed are listing, creating and deleting pods. Listing Pods [code language=&quot;java&quot;]  public List&lt;KubePodModel&gt; getKubePods() {     List&lt;KubePodModel&gt; kubePodList = new ArrayList&lt;KubePodModel&gt;();     for (Pod pod : kubernetes.getPods().getItems()) {        KubePodModel model = new KubePodModel();        model.setId(pod.getId());        model.setApiVersion(pod.getApiVersion());        model.setCreationTime(pod.getCreationTimestamp());        model.setNamespace(pod.getNamespace());        model.setPodHostName(pod.getCurrentState().getHost());        model.setPodIp(pod.getCurrentState().getPodIP());        model.setStatus(pod.getCurrentState().getStatus());        kubePodList.add(podModel);     }     return kubePodModelList;  } [/code] Creating Pods [code language=&quot;java&quot;] public void createKubePod(String id, String namespace, List&lt;String&gt; containerPorts, String image, Map&lt;String, String&gt; labels) {    Pod pod = new Pod();    pod.setId(id);    pod.setLabels(labels);    PodState desiredState = new PodState();    ContainerManifest manifest = new ContainerManifest();    Container manifestContainer = new Container();    manifestContainer.setName(podId);    manifestContainer.setImage(image);    List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();    for (String containerInputPort : containerPorts) {       CharSequence inputStr = containerInputPort;       String patternStr = &quot;(\\S+):(\\S+)&quot;;       Pattern pattern = Pattern.compile(patternStr);       Matcher matcher = pattern.matcher(inputStr);       boolean matchFound = matcher.find();       if (matchFound) {          int contanierPort = Integer.valueOf(matcher.group(1));          String containerProto = matcher.group(2);          Port port = new Port();          port.setContainerPort(contanierPort);          port.setProtocol(containerProto);          ports.add(port);      }    }    manifestForContainer.setPorts(ports);    List&lt;Container&gt; containers = new ArrayList&lt;&gt;();    containers.add(manifestForContainer);    manifest.setContainers(containers);    desiredState.setManifest(manifest);    pod.setDesiredState(desiredState);    kubernetes.createPod(pod, namespace); } [/code] Deleting Pods [code language=&quot;java&quot;] public void deleteKubePod(String id, String namespace) {    kubernetes.deletePod(id, namespace); } [/code] Replication Controllers A replication controller is a pod that has N replicas. The replication controller ensures the number of pod replicas defined also exists. The replication controller will automatically manage pod deployments.The main operations that can be performed are listing, creating and deleting replication controllers. Listing Replication Controllers [code language=&quot;java&quot;] public List&lt;ControllerModel&gt; getKubeReplicationControllers() {    List&lt;ControllerModel&gt; controllerList = new ArrayList&lt;ReplicationControllerModel&gt;();    for (ReplicationController controller : kubernetes.getReplicationControllers().getItems()) {       ControllerModel model = new ControllerModel();       model.setId(controller.getId());       model.setApiVersion(controller.getApiVersion());       model.setCreationTime(controller.getCreationTimestamp());       model.setReplicas(controller.getCurrentState().getReplicas());       controllerList.add(model);    }    return controllerList; } [/code] Creating Replication Controllers [code language=&quot;java&quot;] public void createKubeReplicationController(String id, String namespace, int replicas, Map&lt;String, String&gt; controllerLabels,    Map&lt;String, String&gt; selectorLabels, String podId, String image, List&lt;String&gt; containerPorts, Map&lt;String, String&gt; podLabels, String manifestId) {    ReplicationController controller = new ReplicationController();    controller.setId(id);    controller.setNamespace(namespace);    controller.setLabels(controllerLabels);    PodState podState = new PodState();    ReplicationControllerState repState = new ReplicationControllerState();    repState.setReplicas(replicas);    repState.setReplicaSelector(selectorLabels);    PodTemplate podTmpl = new PodTemplate();    podTmpl.setLabels(podLabels);    ContainerManifest manifest = new ContainerManifest();    manifest.setId(manifestId);    Container manifestContainer = new Container();    manifestContainer.setName(podId);    manifestContainer.setImage(image);    List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();    for (String containerInputPort : containerPorts) {       CharSequence inputStr = containerInputPort;       String patternStr = &quot;(\\S+):(\\S+)&quot;;       Pattern pattern = Pattern.compile(patternStr);       Matcher matcher = pattern.matcher(inputStr);       boolean matchFound = matcher.find();       if (matchFound) {          int contanierPort = Integer.valueOf(matcher.group(1));          String containerProtocol = matcher.group(2);          Port port = new Port();          port.setContainerPort(contanierPort);          port.setProtocol(containerProtocol);          ports.add(port);       }    }    manifestContainer.setPorts(ports);    List&lt;Container&gt; containers = new ArrayList&lt;&gt;();    containers.add(manifestContainer);    manifest.setContainers(containers);    podState.setManifest(manifest);    podTmpl.setDesiredState(podState);    repState.setPodTemplate(podTmpl);    controller.setDesiredState(repState);    kubernetes.createReplicationController(controller, namespace); } [/code] Deleting Replication Controllers [code language=&quot;java&quot;] public void deleteReplicationController(String id, String namespace) {    kubernetes.deleteReplicationController(id, namespace); } [/code] Services A service exposes an application running in a pod externally using the Kubernetes proxy. It essentially maps public IPs / Ports on Kubernetes Minions (nodes) to internal container IPs / Ports. The main operations that can be performed are listing, creating and deleting services. Listing Services [code language=&quot;java&quot;] public List&lt;ServiceModel&gt; getKubeServices() {    List&lt;ServiceModel&gt; serviceList = new ArrayList&lt;ServiceModel&gt;();    for (Service service : kubernetes.getServices().getItems()) {        ServiceModel model = new ServiceModel();        model.setId(service.getId());        model.setApiVersion(service.getApiVersion());        model.setCreationTime(service.getCreationTimestamp());        model.setIp(service.getPortalIP());        model.setPort(service.getPort());        model.setProtocol(service.getProtocol());        serviceList.add(serviceModel);    }    return serviceList; } [/code] Creating Services [code language=&quot;java&quot;] public void createKubeService(String id, String namespace, int containerPort, int port, List&lt;String&gt; publicIps,    Map&lt;String, String&gt; labels, Map&lt;String, String&gt; selectors) {    Service service = new Service();    IntOrString containerPortObj = new IntOrString();    containerPortPojo.setIntVal(containerPort);    service.setId(id);    service.setContainerPort(containerPortObj);    service.setPort(port);    service.setPublicIPs(publicIps);    service.setLabels(labels);    service.setSelector(selectors);    kubernetes.createService(service, namespace); } [/code] Deleting Services [code language=&quot;java&quot;] public void deleteService(String id, String namespace) {    kubernetes.deleteService(id, namespace); } [/code] Summary Kubernetes and Linux containers are rapidly developing and emerging technologies. We have seen how to easily orchestrate containers in a Kubernetes environment using the Fabric8 Java APIs. Container orchestration is about performing operations on various Kubernetes components such as pods, replication controllers and services. Using the APIs you can easily build Kubernetes functionality into any Java applications. I hope you found this article useful. If you have examples of orchestrating Kubernetes or containers through APIs please share! Happy Containerizing! (c) 2015 Keith Tenzer">





  <meta name="twitter:site" content="@keithtenzer">
  <meta name="twitter:title" content="Kubernetes Container Orchestration through Java APIs">
  <meta name="twitter:description" content="Overview In this article we will look at how to drive Kubernetes using Java APIs. More general information about Kubernetes and containers can be found here. Kubernetes itself offers a RESTful API but of course most prefer to use a client that is already handling low-level HTTP protocol operations.  It turns out Fabric8 is providing an integration and management platform above kubernetes and docker. In addition to integrating container orchestration through Kubernetes, Fabric8 also integrates with OpenShift v3 and Jube. OpenShift v3 exposes Kubernetes extensions such as app templates and builds. These Kubernetes extensions allow the container to be bundled with the application code and thus greatly increase application deployment cycles. Jube is a pure Java implementation of Kubernetes to provide containers to non-Linux world. In this article we will just focus on Kubernetes using the Fabric8 Java API. Setup The easiest way to get access to the Fabric8 Kubernetes Java API is through maven. Both Kubernetes and Fabric8 are changing fast so make sure you update and stay current with versions. The below dependency can be added to your pom.xml file. [code language=&quot;xml&quot;] &lt;dependency&gt;    &lt;groupId&gt;io.fabric8&lt;/groupId&gt;    &lt;artifactId&gt;kubernetes-api&lt;/artifactId&gt;    &lt;version&gt;2.0.37&lt;/version&gt; &lt;/dependency&gt; [/code] After updating the pom.xml you can run maven to add the new dependency to the local maven repository. mvn clean compile Connection In order to communicate with Kubernetes through the Fabric8 Java API a connection must be established. The Kubernetes API support HTTPS through TLS certificates but in this example we are just using HTTP and no authentication. The ConnectionExample class requires only IP and Port in order to return a kube connection object. By default unless specified the Kubernetes API will be read-only. In oder to get access to the read-write API the following environment parameters must be exported: export KUBERNETES_SERVICE_HOST=192.168.2.14 export KUBERNETES_SERVICE_PORT=8080 [code language=&quot;java&quot;] package examples; import io.fabric8.kubernetes.api.KubernetesClient; import io.fabric8.kubernetes.api.KubernetesFactory; public class ConnectionExample {    private String ip;    private String port;    public ConnectionExample(String ip, String port) {       this.ip= ip;       this.port = port;    }    public KubernetesClient getConnection() {       final String URI = &quot;http://&quot; + ip+ &quot;:&quot; + port;       final KubernetesClient kubernetes = new KubernetesClient(new KubernetesFactory(URI));       return kubernetes;    } } [/code] Once we have a Kubernetes connection object we can manage pods, replication controllers and services. We can perform typical RESTFul operations such as get, post, update and delete. Pods A pod is the most granular unit of management in Kubernetes and contains one or more containers that share the same resources. The main operations that can be performed are listing, creating and deleting pods. Listing Pods [code language=&quot;java&quot;]  public List&lt;KubePodModel&gt; getKubePods() {     List&lt;KubePodModel&gt; kubePodList = new ArrayList&lt;KubePodModel&gt;();     for (Pod pod : kubernetes.getPods().getItems()) {        KubePodModel model = new KubePodModel();        model.setId(pod.getId());        model.setApiVersion(pod.getApiVersion());        model.setCreationTime(pod.getCreationTimestamp());        model.setNamespace(pod.getNamespace());        model.setPodHostName(pod.getCurrentState().getHost());        model.setPodIp(pod.getCurrentState().getPodIP());        model.setStatus(pod.getCurrentState().getStatus());        kubePodList.add(podModel);     }     return kubePodModelList;  } [/code] Creating Pods [code language=&quot;java&quot;] public void createKubePod(String id, String namespace, List&lt;String&gt; containerPorts, String image, Map&lt;String, String&gt; labels) {    Pod pod = new Pod();    pod.setId(id);    pod.setLabels(labels);    PodState desiredState = new PodState();    ContainerManifest manifest = new ContainerManifest();    Container manifestContainer = new Container();    manifestContainer.setName(podId);    manifestContainer.setImage(image);    List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();    for (String containerInputPort : containerPorts) {       CharSequence inputStr = containerInputPort;       String patternStr = &quot;(\\S+):(\\S+)&quot;;       Pattern pattern = Pattern.compile(patternStr);       Matcher matcher = pattern.matcher(inputStr);       boolean matchFound = matcher.find();       if (matchFound) {          int contanierPort = Integer.valueOf(matcher.group(1));          String containerProto = matcher.group(2);          Port port = new Port();          port.setContainerPort(contanierPort);          port.setProtocol(containerProto);          ports.add(port);      }    }    manifestForContainer.setPorts(ports);    List&lt;Container&gt; containers = new ArrayList&lt;&gt;();    containers.add(manifestForContainer);    manifest.setContainers(containers);    desiredState.setManifest(manifest);    pod.setDesiredState(desiredState);    kubernetes.createPod(pod, namespace); } [/code] Deleting Pods [code language=&quot;java&quot;] public void deleteKubePod(String id, String namespace) {    kubernetes.deletePod(id, namespace); } [/code] Replication Controllers A replication controller is a pod that has N replicas. The replication controller ensures the number of pod replicas defined also exists. The replication controller will automatically manage pod deployments.The main operations that can be performed are listing, creating and deleting replication controllers. Listing Replication Controllers [code language=&quot;java&quot;] public List&lt;ControllerModel&gt; getKubeReplicationControllers() {    List&lt;ControllerModel&gt; controllerList = new ArrayList&lt;ReplicationControllerModel&gt;();    for (ReplicationController controller : kubernetes.getReplicationControllers().getItems()) {       ControllerModel model = new ControllerModel();       model.setId(controller.getId());       model.setApiVersion(controller.getApiVersion());       model.setCreationTime(controller.getCreationTimestamp());       model.setReplicas(controller.getCurrentState().getReplicas());       controllerList.add(model);    }    return controllerList; } [/code] Creating Replication Controllers [code language=&quot;java&quot;] public void createKubeReplicationController(String id, String namespace, int replicas, Map&lt;String, String&gt; controllerLabels,    Map&lt;String, String&gt; selectorLabels, String podId, String image, List&lt;String&gt; containerPorts, Map&lt;String, String&gt; podLabels, String manifestId) {    ReplicationController controller = new ReplicationController();    controller.setId(id);    controller.setNamespace(namespace);    controller.setLabels(controllerLabels);    PodState podState = new PodState();    ReplicationControllerState repState = new ReplicationControllerState();    repState.setReplicas(replicas);    repState.setReplicaSelector(selectorLabels);    PodTemplate podTmpl = new PodTemplate();    podTmpl.setLabels(podLabels);    ContainerManifest manifest = new ContainerManifest();    manifest.setId(manifestId);    Container manifestContainer = new Container();    manifestContainer.setName(podId);    manifestContainer.setImage(image);    List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();    for (String containerInputPort : containerPorts) {       CharSequence inputStr = containerInputPort;       String patternStr = &quot;(\\S+):(\\S+)&quot;;       Pattern pattern = Pattern.compile(patternStr);       Matcher matcher = pattern.matcher(inputStr);       boolean matchFound = matcher.find();       if (matchFound) {          int contanierPort = Integer.valueOf(matcher.group(1));          String containerProtocol = matcher.group(2);          Port port = new Port();          port.setContainerPort(contanierPort);          port.setProtocol(containerProtocol);          ports.add(port);       }    }    manifestContainer.setPorts(ports);    List&lt;Container&gt; containers = new ArrayList&lt;&gt;();    containers.add(manifestContainer);    manifest.setContainers(containers);    podState.setManifest(manifest);    podTmpl.setDesiredState(podState);    repState.setPodTemplate(podTmpl);    controller.setDesiredState(repState);    kubernetes.createReplicationController(controller, namespace); } [/code] Deleting Replication Controllers [code language=&quot;java&quot;] public void deleteReplicationController(String id, String namespace) {    kubernetes.deleteReplicationController(id, namespace); } [/code] Services A service exposes an application running in a pod externally using the Kubernetes proxy. It essentially maps public IPs / Ports on Kubernetes Minions (nodes) to internal container IPs / Ports. The main operations that can be performed are listing, creating and deleting services. Listing Services [code language=&quot;java&quot;] public List&lt;ServiceModel&gt; getKubeServices() {    List&lt;ServiceModel&gt; serviceList = new ArrayList&lt;ServiceModel&gt;();    for (Service service : kubernetes.getServices().getItems()) {        ServiceModel model = new ServiceModel();        model.setId(service.getId());        model.setApiVersion(service.getApiVersion());        model.setCreationTime(service.getCreationTimestamp());        model.setIp(service.getPortalIP());        model.setPort(service.getPort());        model.setProtocol(service.getProtocol());        serviceList.add(serviceModel);    }    return serviceList; } [/code] Creating Services [code language=&quot;java&quot;] public void createKubeService(String id, String namespace, int containerPort, int port, List&lt;String&gt; publicIps,    Map&lt;String, String&gt; labels, Map&lt;String, String&gt; selectors) {    Service service = new Service();    IntOrString containerPortObj = new IntOrString();    containerPortPojo.setIntVal(containerPort);    service.setId(id);    service.setContainerPort(containerPortObj);    service.setPort(port);    service.setPublicIPs(publicIps);    service.setLabels(labels);    service.setSelector(selectors);    kubernetes.createService(service, namespace); } [/code] Deleting Services [code language=&quot;java&quot;] public void deleteService(String id, String namespace) {    kubernetes.deleteService(id, namespace); } [/code] Summary Kubernetes and Linux containers are rapidly developing and emerging technologies. We have seen how to easily orchestrate containers in a Kubernetes environment using the Fabric8 Java APIs. Container orchestration is about performing operations on various Kubernetes components such as pods, replication controllers and services. Using the APIs you can easily build Kubernetes functionality into any Java applications. I hope you found this article useful. If you have examples of orchestrating Kubernetes or containers through APIs please share! Happy Containerizing! (c) 2015 Keith Tenzer">
  <meta name="twitter:url" content="http://localhost:4000/containers/kubernetes-container-orchestration-through-java-apis/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2015-05-04T00:00:00-07:00">





  

  


<link rel="canonical" href="http://localhost:4000/containers/kubernetes-container-orchestration-through-java-apis/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Keith Tenzer",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Keith Tenzer's Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Keith Tenzer's Blog
          <span class="site-subtitle">Cloud Computing and Code</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/index.html">About</a>
            </li><li class="masthead__menu-item">
              <a href="/conferences-and-events/index.html">Conferences and Events</a>
            </li><li class="masthead__menu-item">
              <a href="/videos/index.html">Videos</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#containers" itemprop="item"><span itemprop="name">Containers</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Kubernetes Container Orchestration through Java APIs</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/main/me.png" alt="Keith Tenzer" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Keith Tenzer</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Principal Solutions Architect at Red Hat</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Los Angeles, CA</span>
        </li>
      

      
        
          
        
          
        
          
            <li><a href="https://twitter.com/keithtenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Kubernetes Container Orchestration through Java APIs">
    <meta itemprop="description" content="OverviewIn this article we will look at how to drive Kubernetes using Java APIs. More general information about Kubernetes and containers can be found here. Kubernetes itself offers a RESTful API but of course most prefer to use a client that is already handling low-level HTTP protocol operations. It turns out Fabric8 is providing an integration and management platform above kubernetes and docker. In addition to integrating container orchestration through Kubernetes, Fabric8 also integrates with OpenShift v3 and Jube. OpenShift v3 exposes Kubernetes extensions such as app templates and builds. These Kubernetes extensions allow the container to be bundled with the application code and thus greatly increase application deployment cycles. Jube is a pure Java implementation of Kubernetes to provide containers to non-Linux world. In this article we will just focus on Kubernetes using the Fabric8 Java API.SetupThe easiest way to get access to the Fabric8 Kubernetes Java API is through maven. Both Kubernetes and Fabric8 are changing fast so make sure you update and stay current with versions. The below dependency can be added to your pom.xml file.[code language=&quot;xml&quot;]&lt;dependency&gt;   &lt;groupId&gt;io.fabric8&lt;/groupId&gt;   &lt;artifactId&gt;kubernetes-api&lt;/artifactId&gt;   &lt;version&gt;2.0.37&lt;/version&gt;&lt;/dependency&gt;[/code]After updating the pom.xml you can run maven to add the new dependency to the local maven repository.mvn clean compileConnectionIn order to communicate with Kubernetes through the Fabric8 Java API a connection must be established. The Kubernetes API support HTTPS through TLS certificates but in this example we are just using HTTP and no authentication. The ConnectionExample class requires only IP and Port in order to return a kube connection object. By default unless specified the Kubernetes API will be read-only. In oder to get access to the read-write API the following environment parameters must be exported:export KUBERNETES_SERVICE_HOST=192.168.2.14export KUBERNETES_SERVICE_PORT=8080[code language=&quot;java&quot;]package examples;import io.fabric8.kubernetes.api.KubernetesClient;import io.fabric8.kubernetes.api.KubernetesFactory;public class ConnectionExample {   private String ip;   private String port;   public ConnectionExample(String ip, String port) {      this.ip= ip;      this.port = port;   }   public KubernetesClient getConnection() {      final String URI = &quot;http://&quot; + ip+ &quot;:&quot; + port;      final KubernetesClient kubernetes = new KubernetesClient(new KubernetesFactory(URI));      return kubernetes;   }}[/code]Once we have a Kubernetes connection object we can manage pods, replication controllers and services. We can perform typical RESTFul operations such as get, post, update and delete.PodsA pod is the most granular unit of management in Kubernetes and contains one or more containers that share the same resources. The main operations that can be performed are listing, creating and deleting pods.Listing Pods[code language=&quot;java&quot;] public List&lt;KubePodModel&gt; getKubePods() {    List&lt;KubePodModel&gt; kubePodList = new ArrayList&lt;KubePodModel&gt;();    for (Pod pod : kubernetes.getPods().getItems()) {       KubePodModel model = new KubePodModel();       model.setId(pod.getId());       model.setApiVersion(pod.getApiVersion());       model.setCreationTime(pod.getCreationTimestamp());       model.setNamespace(pod.getNamespace());       model.setPodHostName(pod.getCurrentState().getHost());       model.setPodIp(pod.getCurrentState().getPodIP());       model.setStatus(pod.getCurrentState().getStatus());       kubePodList.add(podModel);    }    return kubePodModelList; }[/code]Creating Pods[code language=&quot;java&quot;]public void createKubePod(String id, String namespace, List&lt;String&gt; containerPorts, String image, Map&lt;String, String&gt; labels) {   Pod pod = new Pod();   pod.setId(id);   pod.setLabels(labels);   PodState desiredState = new PodState();   ContainerManifest manifest = new ContainerManifest();   Container manifestContainer = new Container();   manifestContainer.setName(podId);   manifestContainer.setImage(image);   List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();   for (String containerInputPort : containerPorts) {      CharSequence inputStr = containerInputPort;      String patternStr = &quot;(\\S+):(\\S+)&quot;;      Pattern pattern = Pattern.compile(patternStr);      Matcher matcher = pattern.matcher(inputStr);      boolean matchFound = matcher.find();      if (matchFound) {         int contanierPort = Integer.valueOf(matcher.group(1));         String containerProto = matcher.group(2);         Port port = new Port();         port.setContainerPort(contanierPort);         port.setProtocol(containerProto);         ports.add(port);     }   }   manifestForContainer.setPorts(ports);   List&lt;Container&gt; containers = new ArrayList&lt;&gt;();   containers.add(manifestForContainer);   manifest.setContainers(containers);   desiredState.setManifest(manifest);   pod.setDesiredState(desiredState);   kubernetes.createPod(pod, namespace);}[/code]Deleting Pods[code language=&quot;java&quot;]public void deleteKubePod(String id, String namespace) {   kubernetes.deletePod(id, namespace);}[/code]Replication ControllersA replication controller is a pod that has N replicas. The replication controller ensures the number of pod replicas defined also exists. The replication controller will automatically manage pod deployments.The main operations that can be performed are listing, creating and deleting replication controllers.Listing Replication Controllers[code language=&quot;java&quot;]public List&lt;ControllerModel&gt; getKubeReplicationControllers() {   List&lt;ControllerModel&gt; controllerList = new ArrayList&lt;ReplicationControllerModel&gt;();   for (ReplicationController controller : kubernetes.getReplicationControllers().getItems()) {      ControllerModel model = new ControllerModel();      model.setId(controller.getId());      model.setApiVersion(controller.getApiVersion());      model.setCreationTime(controller.getCreationTimestamp());      model.setReplicas(controller.getCurrentState().getReplicas());      controllerList.add(model);   }   return controllerList;}[/code]Creating Replication Controllers[code language=&quot;java&quot;]public void createKubeReplicationController(String id, String namespace, int replicas, Map&lt;String, String&gt; controllerLabels,   Map&lt;String, String&gt; selectorLabels, String podId, String image, List&lt;String&gt; containerPorts, Map&lt;String, String&gt; podLabels, String manifestId) {   ReplicationController controller = new ReplicationController();   controller.setId(id);   controller.setNamespace(namespace);   controller.setLabels(controllerLabels);   PodState podState = new PodState();   ReplicationControllerState repState = new ReplicationControllerState();   repState.setReplicas(replicas);   repState.setReplicaSelector(selectorLabels);   PodTemplate podTmpl = new PodTemplate();   podTmpl.setLabels(podLabels);   ContainerManifest manifest = new ContainerManifest();   manifest.setId(manifestId);   Container manifestContainer = new Container();   manifestContainer.setName(podId);   manifestContainer.setImage(image);   List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();   for (String containerInputPort : containerPorts) {      CharSequence inputStr = containerInputPort;      String patternStr = &quot;(\\S+):(\\S+)&quot;;      Pattern pattern = Pattern.compile(patternStr);      Matcher matcher = pattern.matcher(inputStr);      boolean matchFound = matcher.find();      if (matchFound) {         int contanierPort = Integer.valueOf(matcher.group(1));         String containerProtocol = matcher.group(2);         Port port = new Port();         port.setContainerPort(contanierPort);         port.setProtocol(containerProtocol);         ports.add(port);      }   }   manifestContainer.setPorts(ports);   List&lt;Container&gt; containers = new ArrayList&lt;&gt;();   containers.add(manifestContainer);   manifest.setContainers(containers);   podState.setManifest(manifest);   podTmpl.setDesiredState(podState);   repState.setPodTemplate(podTmpl);   controller.setDesiredState(repState);   kubernetes.createReplicationController(controller, namespace);}[/code]Deleting Replication Controllers[code language=&quot;java&quot;]public void deleteReplicationController(String id, String namespace) {   kubernetes.deleteReplicationController(id, namespace);}[/code]ServicesA service exposes an application running in a pod externally using the Kubernetes proxy. It essentially maps public IPs / Ports on Kubernetes Minions (nodes) to internal container IPs / Ports. The main operations that can be performed are listing, creating and deleting services.Listing Services[code language=&quot;java&quot;]public List&lt;ServiceModel&gt; getKubeServices() {   List&lt;ServiceModel&gt; serviceList = new ArrayList&lt;ServiceModel&gt;();   for (Service service : kubernetes.getServices().getItems()) {       ServiceModel model = new ServiceModel();       model.setId(service.getId());       model.setApiVersion(service.getApiVersion());       model.setCreationTime(service.getCreationTimestamp());       model.setIp(service.getPortalIP());       model.setPort(service.getPort());       model.setProtocol(service.getProtocol());       serviceList.add(serviceModel);   }   return serviceList;}[/code]Creating Services[code language=&quot;java&quot;]public void createKubeService(String id, String namespace, int containerPort, int port, List&lt;String&gt; publicIps,   Map&lt;String, String&gt; labels, Map&lt;String, String&gt; selectors) {   Service service = new Service();   IntOrString containerPortObj = new IntOrString();   containerPortPojo.setIntVal(containerPort);   service.setId(id);   service.setContainerPort(containerPortObj);   service.setPort(port);   service.setPublicIPs(publicIps);   service.setLabels(labels);   service.setSelector(selectors);   kubernetes.createService(service, namespace);}[/code]Deleting Services[code language=&quot;java&quot;]public void deleteService(String id, String namespace) {   kubernetes.deleteService(id, namespace);}[/code]SummaryKubernetes and Linux containers are rapidly developing and emerging technologies. We have seen how to easily orchestrate containers in a Kubernetes environment using the Fabric8 Java APIs. Container orchestration is about performing operations on various Kubernetes components such as pods, replication controllers and services. Using the APIs you can easily build Kubernetes functionality into any Java applications. I hope you found this article useful. If you have examples of orchestrating Kubernetes or containers through APIs please share!Happy Containerizing!(c) 2015 Keith Tenzer">
    <meta itemprop="datePublished" content="2015-05-04T00:00:00-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Kubernetes Container Orchestration through Java APIs
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2015-05-04T00:00:00-07:00">May 4, 2015</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h3>Overview</h3>
<p>In this article we will look at how to drive Kubernetes using Java APIs. More general information about Kubernetes and containers can be found <a href="http://keithtenzer.com/2015/04/15/containers-at-scale-with-kubernetes-on-openstack/">here</a>. Kubernetes itself offers a RESTful API but of course most prefer to use a client that is already handling low-level HTTP protocol operations.</p>
<p><a href="https://keithtenzer.files.wordpress.com/2015/05/kubernetes_api_architecture2.png"><img class="  wp-image-877 aligncenter" src="/assets/2015/05/kubernetes_api_architecture2.png?w=300" alt="Kubernetes_API_Architecture" width="1388" height="782" /></a> <!--more-->It turns out <a href="http://fabric8.io/">Fabric8 </a>is providing an integration and management platform above kubernetes and docker. In addition to integrating container orchestration through Kubernetes, Fabric8 also integrates with OpenShift v3 and Jube. OpenShift v3 exposes Kubernetes extensions such as app templates and builds. These Kubernetes extensions allow the container to be bundled with the application code and thus greatly increase application deployment cycles. Jube is a pure Java implementation of Kubernetes to provide containers to non-Linux world. In this article we will just focus on Kubernetes using the Fabric8 Java API.</p>
<h3>Setup</h3>
<p>The easiest way to get access to the Fabric8 Kubernetes Java API is through maven. Both Kubernetes and Fabric8 are changing fast so make sure you update and stay current with versions. The below dependency can be added to your pom.xml file.</p>
<p>[code language="xml"]</p>
<p>&lt;dependency&gt;<br />
   &lt;groupId&gt;io.fabric8&lt;/groupId&gt;<br />
   &lt;artifactId&gt;kubernetes-api&lt;/artifactId&gt;<br />
   &lt;version&gt;2.0.37&lt;/version&gt;<br />
&lt;/dependency&gt;</p>
<p>[/code]</p>
<p>After updating the pom.xml you can run maven to add the new dependency to the local maven repository.</p>
<pre>mvn clean compile</pre>
<h3>Connection</h3>
<p>In order to communicate with Kubernetes through the Fabric8 Java API a connection must be established. The Kubernetes API support HTTPS through TLS certificates but in this example we are just using HTTP and no authentication. The ConnectionExample class requires only IP and Port in order to return a kube connection object. By default unless specified the Kubernetes API will be read-only. In oder to get access to the read-write API the following environment parameters must be exported:</p>
<pre>export KUBERNETES_SERVICE_HOST=192.168.2.14
export KUBERNETES_SERVICE_PORT=8080</pre>
<p>[code language="java"]<br />
package examples;</p>
<p>import io.fabric8.kubernetes.api.KubernetesClient;<br />
import io.fabric8.kubernetes.api.KubernetesFactory;</p>
<p>public class ConnectionExample {<br />
   private String ip;<br />
   private String port;</p>
<p>   public ConnectionExample(String ip, String port) {<br />
      this.ip= ip;<br />
      this.port = port;<br />
   }</p>
<p>   public KubernetesClient getConnection() {<br />
      final String URI = &quot;http://&quot; + ip+ &quot;:&quot; + port;<br />
      final KubernetesClient kubernetes = new KubernetesClient(new KubernetesFactory(URI));</p>
<p>      return kubernetes;<br />
   }<br />
}</p>
<p>[/code]</p>
<p>Once we have a Kubernetes connection object we can manage pods, replication controllers and services. We can perform typical RESTFul operations such as get, post, update and delete.</p>
<h3>Pods</h3>
<p>A pod is the most granular unit of management in Kubernetes and contains one or more containers that share the same resources. The main operations that can be performed are listing, creating and deleting pods.</p>
<h4>Listing Pods</h4>
<p>[code language="java"]<br />
 public List&lt;KubePodModel&gt; getKubePods() {<br />
    List&lt;KubePodModel&gt; kubePodList = new ArrayList&lt;KubePodModel&gt;();</p>
<p>    for (Pod pod : kubernetes.getPods().getItems()) {<br />
       KubePodModel model = new KubePodModel();</p>
<p>       model.setId(pod.getId());<br />
       model.setApiVersion(pod.getApiVersion());<br />
       model.setCreationTime(pod.getCreationTimestamp());<br />
       model.setNamespace(pod.getNamespace());<br />
       model.setPodHostName(pod.getCurrentState().getHost());<br />
       model.setPodIp(pod.getCurrentState().getPodIP());<br />
       model.setStatus(pod.getCurrentState().getStatus());</p>
<p>       kubePodList.add(podModel);</p>
<p>    }</p>
<p>    return kubePodModelList;<br />
 }<br />
[/code]</p>
<h4>Creating Pods</h4>
<p>[code language="java"]</p>
<p>public void createKubePod(String id, String namespace, List&lt;String&gt; containerPorts, String image, Map&lt;String, String&gt; labels) {</p>
<p>   Pod pod = new Pod();<br />
   pod.setId(id);</p>
<p>   pod.setLabels(labels);<br />
   PodState desiredState = new PodState();<br />
   ContainerManifest manifest = new ContainerManifest();</p>
<p>   Container manifestContainer = new Container();<br />
   manifestContainer.setName(podId);<br />
   manifestContainer.setImage(image);</p>
<p>   List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();<br />
   for (String containerInputPort : containerPorts) {<br />
      CharSequence inputStr = containerInputPort;<br />
      String patternStr = &quot;(\\S+):(\\S+)&quot;;<br />
      Pattern pattern = Pattern.compile(patternStr);<br />
      Matcher matcher = pattern.matcher(inputStr);<br />
      boolean matchFound = matcher.find();</p>
<p>      if (matchFound) {<br />
         int contanierPort = Integer.valueOf(matcher.group(1));<br />
         String containerProto = matcher.group(2);</p>
<p>         Port port = new Port();<br />
         port.setContainerPort(contanierPort);<br />
         port.setProtocol(containerProto);<br />
         ports.add(port);<br />
     }<br />
   }</p>
<p>   manifestForContainer.setPorts(ports);</p>
<p>   List&lt;Container&gt; containers = new ArrayList&lt;&gt;();<br />
   containers.add(manifestForContainer);<br />
   manifest.setContainers(containers);</p>
<p>   desiredState.setManifest(manifest);<br />
   pod.setDesiredState(desiredState);</p>
<p>   kubernetes.createPod(pod, namespace);<br />
}</p>
<p>[/code]</p>
<h4>Deleting Pods</h4>
<p>[code language="java"]</p>
<p>public void deleteKubePod(String id, String namespace) {<br />
   kubernetes.deletePod(id, namespace);<br />
}</p>
<p>[/code]</p>
<h3>Replication Controllers</h3>
<p>A replication controller is a pod that has N replicas. The replication controller ensures the number of pod replicas defined also exists. The replication controller will automatically manage pod deployments.The main operations that can be performed are listing, creating and deleting replication controllers.</p>
<h4>Listing Replication Controllers</h4>
<p>[code language="java"]</p>
<p>public List&lt;ControllerModel&gt; getKubeReplicationControllers() {<br />
   List&lt;ControllerModel&gt; controllerList = new ArrayList&lt;ReplicationControllerModel&gt;();<br />
   for (ReplicationController controller : kubernetes.getReplicationControllers().getItems()) {<br />
      ControllerModel model = new ControllerModel();</p>
<p>      model.setId(controller.getId());<br />
      model.setApiVersion(controller.getApiVersion());<br />
      model.setCreationTime(controller.getCreationTimestamp());<br />
      model.setReplicas(controller.getCurrentState().getReplicas());</p>
<p>      controllerList.add(model);<br />
   }</p>
<p>   return controllerList;<br />
}</p>
<p>[/code]</p>
<h4>Creating Replication Controllers</h4>
<p>[code language="java"]</p>
<p>public void createKubeReplicationController(String id, String namespace, int replicas, Map&lt;String, String&gt; controllerLabels,<br />
   Map&lt;String, String&gt; selectorLabels, String podId, String image, List&lt;String&gt; containerPorts, Map&lt;String, String&gt; podLabels, String manifestId) {<br />
   ReplicationController controller = new ReplicationController();<br />
   controller.setId(id);<br />
   controller.setNamespace(namespace);<br />
   controller.setLabels(controllerLabels);</p>
<p>   PodState podState = new PodState();<br />
   ReplicationControllerState repState = new ReplicationControllerState();<br />
   repState.setReplicas(replicas);<br />
   repState.setReplicaSelector(selectorLabels);</p>
<p>   PodTemplate podTmpl = new PodTemplate();<br />
   podTmpl.setLabels(podLabels);</p>
<p>   ContainerManifest manifest = new ContainerManifest();<br />
   manifest.setId(manifestId);<br />
   Container manifestContainer = new Container();<br />
   manifestContainer.setName(podId);<br />
   manifestContainer.setImage(image);</p>
<p>   List&lt;Port&gt; ports = new ArrayList&lt;Port&gt;();<br />
   for (String containerInputPort : containerPorts) {<br />
      CharSequence inputStr = containerInputPort;<br />
      String patternStr = &quot;(\\S+):(\\S+)&quot;;<br />
      Pattern pattern = Pattern.compile(patternStr);<br />
      Matcher matcher = pattern.matcher(inputStr);<br />
      boolean matchFound = matcher.find();</p>
<p>      if (matchFound) {<br />
         int contanierPort = Integer.valueOf(matcher.group(1));<br />
         String containerProtocol = matcher.group(2);</p>
<p>         Port port = new Port();<br />
         port.setContainerPort(contanierPort);<br />
         port.setProtocol(containerProtocol);<br />
         ports.add(port);<br />
      }<br />
   }</p>
<p>   manifestContainer.setPorts(ports);</p>
<p>   List&lt;Container&gt; containers = new ArrayList&lt;&gt;();<br />
   containers.add(manifestContainer);<br />
   manifest.setContainers(containers);</p>
<p>   podState.setManifest(manifest);<br />
   podTmpl.setDesiredState(podState);<br />
   repState.setPodTemplate(podTmpl);</p>
<p>   controller.setDesiredState(repState);</p>
<p>   kubernetes.createReplicationController(controller, namespace);</p>
<p>}</p>
<p>[/code]</p>
<h4>Deleting Replication Controllers</h4>
<p>[code language="java"]</p>
<p>public void deleteReplicationController(String id, String namespace) {<br />
   kubernetes.deleteReplicationController(id, namespace);<br />
}</p>
<p>[/code]</p>
<h3>Services</h3>
<p>A service exposes an application running in a pod externally using the Kubernetes proxy. It essentially maps public IPs / Ports on Kubernetes Minions (nodes) to internal container IPs / Ports. The main operations that can be performed are listing, creating and deleting services.</p>
<h4>Listing Services</h4>
<p>[code language="java"]</p>
<p>public List&lt;ServiceModel&gt; getKubeServices() {<br />
   List&lt;ServiceModel&gt; serviceList = new ArrayList&lt;ServiceModel&gt;();<br />
   for (Service service : kubernetes.getServices().getItems()) {<br />
       ServiceModel model = new ServiceModel();</p>
<p>       model.setId(service.getId());<br />
       model.setApiVersion(service.getApiVersion());<br />
       model.setCreationTime(service.getCreationTimestamp());<br />
       model.setIp(service.getPortalIP());<br />
       model.setPort(service.getPort());<br />
       model.setProtocol(service.getProtocol());</p>
<p>       serviceList.add(serviceModel);<br />
   }</p>
<p>   return serviceList;<br />
}</p>
<p>[/code]</p>
<h4>Creating Services</h4>
<p>[code language="java"]</p>
<p>public void createKubeService(String id, String namespace, int containerPort, int port, List&lt;String&gt; publicIps,<br />
   Map&lt;String, String&gt; labels, Map&lt;String, String&gt; selectors) {<br />
   Service service = new Service();</p>
<p>   IntOrString containerPortObj = new IntOrString();<br />
   containerPortPojo.setIntVal(containerPort);</p>
<p>   service.setId(id);<br />
   service.setContainerPort(containerPortObj);<br />
   service.setPort(port);<br />
   service.setPublicIPs(publicIps);<br />
   service.setLabels(labels);<br />
   service.setSelector(selectors);</p>
<p>   kubernetes.createService(service, namespace);<br />
}</p>
<p>[/code]</p>
<h4>Deleting Services</h4>
<p>[code language="java"]</p>
<p>public void deleteService(String id, String namespace) {<br />
   kubernetes.deleteService(id, namespace);<br />
}</p>
<p>[/code]</p>
<h3>Summary</h3>
<p>Kubernetes and Linux containers are rapidly developing and emerging technologies. We have seen how to easily orchestrate containers in a Kubernetes environment using the Fabric8 Java APIs. Container orchestration is about performing operations on various Kubernetes components such as pods, replication controllers and services. Using the APIs you can easily build Kubernetes functionality into any Java applications. I hope you found this article useful. If you have examples of orchestrating Kubernetes or containers through APIs please share!</p>
<p>Happy Containerizing!</p>
<p>(c) 2015 Keith Tenzer</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#api" class="page__taxonomy-item" rel="tag">API</a><span class="sep">, </span>
    
      <a href="/tags/#fabric8" class="page__taxonomy-item" rel="tag">Fabric8</a><span class="sep">, </span>
    
      <a href="/tags/#java" class="page__taxonomy-item" rel="tag">Java</a><span class="sep">, </span>
    
      <a href="/tags/#kubernetes" class="page__taxonomy-item" rel="tag">Kubernetes</a><span class="sep">, </span>
    
      <a href="/tags/#linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      <a href="/tags/#lxc" class="page__taxonomy-item" rel="tag">LXC</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#containers" class="page__taxonomy-item" rel="tag">Containers</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2015-05-04T00:00:00-07:00">May 4, 2015</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=keithtenzer&text=Kubernetes+Container+Orchestration+through+Java+APIs%20http%3A%2F%2Flocalhost%3A4000%2Fcontainers%2Fkubernetes-container-orchestration-through-java-apis%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fcontainers%2Fkubernetes-container-orchestration-through-java-apis%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fcontainers%2Fkubernetes-container-orchestration-through-java-apis%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/containers/containers-at-scale-with-kubernetes-on-openstack/" class="pagination--pager" title="Containers at Scale with Kubernetes on OpenStack
">Previous</a>
    
    
      <a href="/containers/application-containers-a-practical-howto-guide/" class="pagination--pager" title="Application Containers: A Practical HowTo Guide
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/building-ansible-operators-1-2-3/" rel="permalink">Building Ansible Operators 1-2-3
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-12-03T00:00:00-08:00">December 3, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
In this article we will go step by step in build a Kubernetes Operator using Ansible and the Operator Framework. Operators provide ability to not on...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-service-mesh-getting-started-guide/" rel="permalink">OpenShift Service Mesh Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-04-27T00:00:00-07:00">April 27, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">






Overview
In this article we will explore the OpenShift Service Mesh and deploy a demo application to better understand the various concepts. First you...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openshift/openshift-4-aws-ipi-installation-getting-started-guide/" rel="permalink">OpenShift 4 AWS IPI Installation Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-01-18T00:00:00-08:00">January 18, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">


Happy new year as this will be the first post of 2021! 2020 was obviously a challenging year, my hope is I will have more time to devote to blogging in 20...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ansible/windows-automation-with-ansible-getting-started-guide/" rel="permalink">Windows Automation with Ansible: Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-05-19T00:00:00-07:00">May 19, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
In this article we will focus on how to get started with automation of windows using Ansible. Specifically we will look at installing 3rd party sof...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/keithtenzer"" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Keith Tenzer. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
