<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
<link rel="icon" href="/assets/main/me.png">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>OpenStack Manila Integration with Ceph - Keith Tenzer’s Blog</title>
<meta name="description" content="Overview In this article we will configure OpenStack Manila using CephFS as a storage backend. OpenStack Manila is an OpenStack project providing file services. Manila is storage backend agnostic and you can have many different kinds of storage backends, similar to Cinder. CephFS is a POSIX-Compliant file system that uses the Ceph storage cluster to store data. CephFS works by providing a Metadata Server (MDS) that collectively manages filesystem namespaces. It also coordinates access to Ceph Object Storage Damones (OSDs). Ceph MDS has two modes: active or passive. There are several documented active/passive MDS configurations and multi-mds or active/active MDS that can be configured when a single MDS becomes a bottleneck. Clients can mount CephFS filesystems using the ceph-fuse client or kernel kernel driver. Integrating Ceph with OpenStack Series:  Integrating Ceph with OpenStack Cinder, Glance and Nova Integrating Ceph with Swift Integrating Ceph with Manila  Prerequisites The following are required to configure OpenStack Manila with CephFS:  Already configured Ceph cluster (Jewel or higher). See here to setup Ceph cluster. Already configured OpenStack (Mitaka or higher). See here to setup OpenStack.   Configure CephFS [All Ceph Nodes] Add repository for ceph tools. # subscription-manager repos --enable=rhel-7-server-rhceph-2-tools-rpms [Ceph Ansible Node] Update Ansible inventory file and add metadata server. #vi /etc/host/ansible ... [mdss] ceph2 ... Note: For non-lab environment you definitely wan&#39;t to configure multiple MDS servers. One is active and additional servers are passive. Run Ansible. # su - ansible $ cd /usr/share/ceph-ansible $ ansible-playbook site.yml -vvvv PLAY RECAP ********************************************************************  ceph1 : ok=369 changed=1 unreachable=0 failed=0  ceph2 : ok=364 changed=11 unreachable=0 failed=0  ceph3 : ok=369 changed=1 unreachable=0 failed=0 [Ceph Monitor Node] Check CephFS metadata server. # ceph mds stat e24: 1/1/1 up {0=ceph2=up:active} Create keyring and cephx authentication key for Manila service. # read -d &#39;&#39; MON_CAPS &lt;&lt; EOF allow r, allow command &quot;auth del&quot;, allow command &quot;auth caps&quot;, allow command &quot;auth get&quot;, allow command &quot;auth get-or-create&quot; EOF">


  <meta name="author" content="Keith Tenzer">
  
  <meta property="article:author" content="Keith Tenzer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Keith Tenzer's Blog">
<meta property="og:title" content="OpenStack Manila Integration with Ceph">
<meta property="og:url" content="http://localhost:4000/openstack/openstack-manila-integration-with-ceph/">


  <meta property="og:description" content="Overview In this article we will configure OpenStack Manila using CephFS as a storage backend. OpenStack Manila is an OpenStack project providing file services. Manila is storage backend agnostic and you can have many different kinds of storage backends, similar to Cinder. CephFS is a POSIX-Compliant file system that uses the Ceph storage cluster to store data. CephFS works by providing a Metadata Server (MDS) that collectively manages filesystem namespaces. It also coordinates access to Ceph Object Storage Damones (OSDs). Ceph MDS has two modes: active or passive. There are several documented active/passive MDS configurations and multi-mds or active/active MDS that can be configured when a single MDS becomes a bottleneck. Clients can mount CephFS filesystems using the ceph-fuse client or kernel kernel driver. Integrating Ceph with OpenStack Series:  Integrating Ceph with OpenStack Cinder, Glance and Nova Integrating Ceph with Swift Integrating Ceph with Manila  Prerequisites The following are required to configure OpenStack Manila with CephFS:  Already configured Ceph cluster (Jewel or higher). See here to setup Ceph cluster. Already configured OpenStack (Mitaka or higher). See here to setup OpenStack.   Configure CephFS [All Ceph Nodes] Add repository for ceph tools. # subscription-manager repos --enable=rhel-7-server-rhceph-2-tools-rpms [Ceph Ansible Node] Update Ansible inventory file and add metadata server. #vi /etc/host/ansible ... [mdss] ceph2 ... Note: For non-lab environment you definitely wan&#39;t to configure multiple MDS servers. One is active and additional servers are passive. Run Ansible. # su - ansible $ cd /usr/share/ceph-ansible $ ansible-playbook site.yml -vvvv PLAY RECAP ********************************************************************  ceph1 : ok=369 changed=1 unreachable=0 failed=0  ceph2 : ok=364 changed=11 unreachable=0 failed=0  ceph3 : ok=369 changed=1 unreachable=0 failed=0 [Ceph Monitor Node] Check CephFS metadata server. # ceph mds stat e24: 1/1/1 up {0=ceph2=up:active} Create keyring and cephx authentication key for Manila service. # read -d &#39;&#39; MON_CAPS &lt;&lt; EOF allow r, allow command &quot;auth del&quot;, allow command &quot;auth caps&quot;, allow command &quot;auth get&quot;, allow command &quot;auth get-or-create&quot; EOF">





  <meta name="twitter:site" content="@keithtenzer">
  <meta name="twitter:title" content="OpenStack Manila Integration with Ceph">
  <meta name="twitter:description" content="Overview In this article we will configure OpenStack Manila using CephFS as a storage backend. OpenStack Manila is an OpenStack project providing file services. Manila is storage backend agnostic and you can have many different kinds of storage backends, similar to Cinder. CephFS is a POSIX-Compliant file system that uses the Ceph storage cluster to store data. CephFS works by providing a Metadata Server (MDS) that collectively manages filesystem namespaces. It also coordinates access to Ceph Object Storage Damones (OSDs). Ceph MDS has two modes: active or passive. There are several documented active/passive MDS configurations and multi-mds or active/active MDS that can be configured when a single MDS becomes a bottleneck. Clients can mount CephFS filesystems using the ceph-fuse client or kernel kernel driver. Integrating Ceph with OpenStack Series:  Integrating Ceph with OpenStack Cinder, Glance and Nova Integrating Ceph with Swift Integrating Ceph with Manila  Prerequisites The following are required to configure OpenStack Manila with CephFS:  Already configured Ceph cluster (Jewel or higher). See here to setup Ceph cluster. Already configured OpenStack (Mitaka or higher). See here to setup OpenStack.   Configure CephFS [All Ceph Nodes] Add repository for ceph tools. # subscription-manager repos --enable=rhel-7-server-rhceph-2-tools-rpms [Ceph Ansible Node] Update Ansible inventory file and add metadata server. #vi /etc/host/ansible ... [mdss] ceph2 ... Note: For non-lab environment you definitely wan&#39;t to configure multiple MDS servers. One is active and additional servers are passive. Run Ansible. # su - ansible $ cd /usr/share/ceph-ansible $ ansible-playbook site.yml -vvvv PLAY RECAP ********************************************************************  ceph1 : ok=369 changed=1 unreachable=0 failed=0  ceph2 : ok=364 changed=11 unreachable=0 failed=0  ceph3 : ok=369 changed=1 unreachable=0 failed=0 [Ceph Monitor Node] Check CephFS metadata server. # ceph mds stat e24: 1/1/1 up {0=ceph2=up:active} Create keyring and cephx authentication key for Manila service. # read -d &#39;&#39; MON_CAPS &lt;&lt; EOF allow r, allow command &quot;auth del&quot;, allow command &quot;auth caps&quot;, allow command &quot;auth get&quot;, allow command &quot;auth get-or-create&quot; EOF">
  <meta name="twitter:url" content="http://localhost:4000/openstack/openstack-manila-integration-with-ceph/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2017-03-28T00:00:00-07:00">





  

  


<link rel="canonical" href="http://localhost:4000/openstack/openstack-manila-integration-with-ceph/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Keith Tenzer",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Keith Tenzer's Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Keith Tenzer's Blog
          <span class="site-subtitle">Cloud Computing and Code</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/index.html">About</a>
            </li><li class="masthead__menu-item">
              <a href="/conferences-and-events/index.html">Conferences and Events</a>
            </li><li class="masthead__menu-item">
              <a href="/videos/index.html">Videos</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#openstack" itemprop="item"><span itemprop="name">Openstack</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">OpenStack Manila Integration with Ceph</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/main/me.png" alt="Keith Tenzer" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Keith Tenzer</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Solutions Architect at Temporal</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Los Angeles, CA</span>
        </li>
      

      
        
          
        
          
        
          
            <li><a href="https://twitter.com/keithtenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="OpenStack Manila Integration with Ceph">
    <meta itemprop="description" content="OverviewIn this article we will configure OpenStack Manila using CephFS as a storage backend. OpenStack Manila is an OpenStack project providing file services. Manila is storage backend agnostic and you can have many different kinds of storage backends, similar to Cinder. CephFS is a POSIX-Compliant file system that uses the Ceph storage cluster to store data. CephFS works by providing a Metadata Server (MDS) that collectively manages filesystem namespaces. It also coordinates access to Ceph Object Storage Damones (OSDs). Ceph MDS has two modes: active or passive. There are several documented active/passive MDS configurations and multi-mds or active/active MDS that can be configured when a single MDS becomes a bottleneck. Clients can mount CephFS filesystems using the ceph-fuse client or kernel kernel driver.Integrating Ceph with OpenStack Series:Integrating Ceph with OpenStack Cinder, Glance and NovaIntegrating Ceph with SwiftIntegrating Ceph with ManilaPrerequisitesThe following are required to configure OpenStack Manila with CephFS:Already configured Ceph cluster (Jewel or higher). See here to setup Ceph cluster.Already configured OpenStack (Mitaka or higher). See here to setup OpenStack.Configure CephFS[All Ceph Nodes]Add repository for ceph tools.# subscription-manager repos --enable=rhel-7-server-rhceph-2-tools-rpms[Ceph Ansible Node]Update Ansible inventory file and add metadata server.#vi /etc/host/ansible...[mdss]ceph2...Note: For non-lab environment you definitely wan&#39;t to configure multiple MDS servers. One is active and additional servers are passive.Run Ansible.# su - ansible$ cd /usr/share/ceph-ansible$ ansible-playbook site.yml -vvvvPLAY RECAP ******************************************************************** ceph1 : ok=369 changed=1 unreachable=0 failed=0 ceph2 : ok=364 changed=11 unreachable=0 failed=0 ceph3 : ok=369 changed=1 unreachable=0 failed=0[Ceph Monitor Node]Check CephFS metadata server.# ceph mds state24: 1/1/1 up {0=ceph2=up:active}Create keyring and cephx authentication key for Manila service.# read -d &#39;&#39; MON_CAPS &lt;&lt; EOFallow r,allow command &quot;auth del&quot;,allow command &quot;auth caps&quot;,allow command &quot;auth get&quot;,allow command &quot;auth get-or-create&quot;EOF">
    <meta itemprop="datePublished" content="2017-03-28T00:00:00-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">OpenStack Manila Integration with Ceph
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2017-03-28T00:00:00-07:00">March 28, 2017</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          12 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1><img class="alignnone size-full wp-image-8960" src="/assets/2017/03/images.jpg" alt="images" width="225" height="225" /><img class="alignnone  wp-image-5506" src="/assets/2017/03/plus_sign.gif" alt="plus_sign" width="102" height="102" /><img class="alignnone  wp-image-8798" src="/assets/2017/03/1015767.png" alt="1015767" width="223" height="223" /></h1>
<h3>Overview</h3>
<p>In this article we will configure OpenStack Manila using CephFS as a storage backend. OpenStack Manila is an OpenStack project providing file services. Manila is storage backend agnostic and you can have many different kinds of storage backends, similar to Cinder. CephFS is a POSIX-Compliant file system that uses the Ceph storage cluster to store data. CephFS works by providing a Metadata Server (MDS) that collectively manages filesystem namespaces. It also coordinates access to Ceph Object Storage Damones (OSDs). Ceph MDS has two modes: active or passive. There are several documented <a href="http://docs.ceph.com/docs/master/cephfs/standby/#referring-to-mds-daemons">active/passive MDS</a> configurations and <a href="http://docs.ceph.com/docs/master/cephfs/multimds/">multi-mds or active/active MDS</a> that can be configured when a single MDS becomes a bottleneck. Clients can mount CephFS filesystems using the ceph-fuse client or kernel kernel driver.</p>
<p>Integrating Ceph with OpenStack Series:</p>
<ul>
<li><a href="https://keithtenzer.com/2016/09/12/openstack-integrating-ceph-as-storage-backend/">Integrating Ceph with OpenStack Cinder, Glance and Nova</a></li>
<li><a href="https://keithtenzer.com/2017/03/30/openstack-swift-integration-with-ceph/">Integrating Ceph with Swift</a></li>
<li><a href="https://keithtenzer.com/2017/03/28/openstack-manila-integration-with-ceph/">Integrating Ceph with Manila</a></li>
</ul>
<h3>Prerequisites</h3>
<p>The following are required to configure OpenStack Manila with CephFS:</p>
<ul>
<li>Already configured Ceph cluster (Jewel or higher). See <a href="https://keithtenzer.com/2017/02/03/red-hat-ceph-storage-2-0-lab-object-storage-configuration-guide/">here</a> to setup Ceph cluster.</li>
<li>Already configured OpenStack (Mitaka or higher). See <a href="https://keithtenzer.com/2017/03/27/openstack-10-newton-lab-installation-and-configuration-guide/">here</a> to setup OpenStack.</li>
</ul>
<p><!--more--></p>
<h3>Configure CephFS</h3>
<p><strong>[All Ceph Nodes]</strong></p>
<p>Add repository for ceph tools.</p>
<pre class="screen"># subscription-manager repos --enable=rhel-7-server-rhceph-2-tools-rpms</pre>
<p><strong>[Ceph Ansible Node]</strong></p>
<p>Update Ansible inventory file and add metadata server.</p>
<pre class="screen">#vi /etc/host/ansible
...
[mdss]
ceph2
...</pre>
<p>Note: For non-lab environment you definitely wan't to configure multiple MDS servers. One is active and additional servers are passive.</p>
<p>Run Ansible.</p>
<pre># su - ansible
$ cd /usr/share/ceph-ansible
$ ansible-playbook site.yml -vvvv
PLAY RECAP ******************************************************************** 
ceph1 : ok=369 changed=1 unreachable=0 failed=0 
ceph2 : ok=364 changed=11 unreachable=0 failed=0 
ceph3 : ok=369 changed=1 unreachable=0 failed=0</pre>
<p><strong>[Ceph Monitor Node]</strong></p>
<p>Check CephFS metadata server.</p>
<pre># ceph mds stat
e24: 1/1/1 up {0=ceph2=up:active}</pre>
<p>Create keyring and cephx authentication key for Manila service.</p>
<pre><span class="go"># read -d '' MON_CAPS &lt;&lt; EOF</span>
<span class="go">allow r,</span>
<span class="go">allow command "auth del",</span>
<span class="go">allow command "auth caps",</span>
<span class="go">allow command "auth get",</span>
<span class="go">allow command "auth get-or-create"</span>
<span class="go">EOF</span>

<span class="go"># ceph auth get-or-create client.manila -o manila.keyring \</span>
<span class="go">mds 'allow *' \</span>
<span class="go">osd 'allow rw' \</span>
<span class="go">mon "$MON_CAPS"</span></pre>
<p>Enable CephFS snapshots.</p>
<pre><span class="go"># ceph mds set allow_new_snaps true --yes-i-really-mean-it</span></pre>
<p>Copy Ceph configuration and manila keyring to OpenStack controller running Manila share service.</p>
<pre># scp /etc/ceph/ceph.conf root@192.168.122.80:/etc/ceph
# scp manila.keyring root@192.168.122.80:/etc/ceph</pre>
<h3>Configure Manila</h3>
<p><strong>[OpenStack Controller]</strong></p>
<p>Install Ceph tools and python-cephs</p>
<pre># subscription-manager repos --enable=rhel-7-server-rhceph-2-tools-rpms
# yum install -y ceph-common
# yum install python-cephfs</pre>
<p>Change permissions on Ceph configuration and keyring for manila.</p>
<pre># chown manila /etc/ceph/manila.keyring
# chown manila /etc/ceph/ceph.conf</pre>
<p>Update Ceph configuration.</p>
<pre><span class="k"># vi /etc/ceph/ceph.conf
...
</span><span class="s">[client.manila]
client mount uid = 0
client mount gid = 0
log file = /var/log/manila/ceph-client.manila.log
admin socket = /var/run/ceph/ceph-$name.$pid.asok
keyring = /etc/ceph/manila.keyring

...</span></pre>
<p>Update Manila configuration.</p>
<p>&nbsp;</p>
<pre><span class="k"># vi /etc/manila/manila.conf
...
enabled_share_protocols = NFS,CIFS,CEPHFS
enabled_share_backends = generic,cephfs

</span><span class="s">[cephfs]
driver_handles_share_servers = False
share_backend_name = cephfs
share_driver = manila.share.drivers.cephfs.cephfs_native.CephFSNativeDriver
cephfs_conf_path = /etc/ceph/ceph.conf
cephfs_auth_id = manila
cephfs_cluster_name = ceph
cephfs_enable_snapshots = True
...</span></pre>
<p>Restart Manila services.</p>
<pre># systemctl restart openstack-manila-scheduler
# systemctl restart openstack-manila-api
# systemctl restart openstack-manila-share</pre>
<p>Authenticate to Keystong.</p>
<pre># source /root/keystonerc_admin</pre>
<p>Set share type for CephFS.</p>
<pre># manila type-create cephfstype false
+----------------------+--------------------------------------+
| Property | Value |
+----------------------+--------------------------------------+
| required_extra_specs | driver_handles_share_servers : False |
| Name | cephfstype |
| Visibility | public |
| is_default | - |
| ID | ae7cc121-d8b6-47e5-86ba-36d607df19b0 |
| optional_extra_specs | snapshot_support : True |
+----------------------+--------------------------------------+</pre>
<p>Create Manila share.</p>
<pre># manila create --share-type cephfstype --name cephshare1 cephfs 1
+-----------------------------+--------------------------------------+
| Property | Value |
+-----------------------------+--------------------------------------+
| status | creating |
| share_type_name | cephfstype |
| description | None |
| availability_zone | None |
| share_network_id | None |
| share_server_id | None |
| host | |
| access_rules_status | active |
| snapshot_id | None |
| is_public | False |
| task_state | None |
| snapshot_support | True |
| id | c72318fd-3cb2-4c0a-855e-b75c5bd43c6d |
| size | 1 |
| user_id | 9d592f8a49654e8592de4e69fd15e603 |
| name | cephshare1 |
| share_type | ae7cc121-d8b6-47e5-86ba-36d607df19b0 |
| has_replicas | False |
| replication_type | None |
| created_at | 2017-03-28T12:33:30.000000 |
| share_proto | CEPHFS |
| consistency_group_id | None |
| source_cgsnapshot_member_id | None |
| project_id | 29f6ba825bf5418395919c85874db4a5 |
| metadata | {} |
+-----------------------------+--------------------------------------+</pre>
<p>View the Manila share.</p>
<pre># manila list
+--------------------------------------+------------+------+-------------+-----------+-----------+-----------------+-----------------------------+-------------------+
| ID | Name | Size | Share Proto | Status | Is Public | Share Type Name | Host | Availability Zone |
+--------------------------------------+------------+------+-------------+-----------+-----------+-----------------+-----------------------------+-------------------+
| 687d642b-3982-4f79-9b32-21ffb0bb54f9 | cephshare1 | 1 | CEPHFS | available | False | cephfstype | osp10.lab.com@cephfs#cephfs | nova |
+--------------------------------------+------------+------+-------------+-----------+-----------+-----------------+-----------------------------+-------------------+</pre>
<p>Show Manila export location.</p>
<pre># manila share-export-location-list cephshare1
+--------------------------------------+--------------------------------------------------------------------------------------------------------------------+-----------+
| ID | Path | Preferred |
+--------------------------------------+--------------------------------------------------------------------------------------------------------------------+-----------+
| a85a1653-ce6e-4c01-ad05-17b9c41ad241 | 192.168.122.81:6789,192.168.122.82:6789,192.168.122.83:6789:<strong>/volumes/_nogroup/b1464433-f10e-458f-b120-b9b41d3f0083</strong> | False |
+--------------------------------------+--------------------------------------------------------------------------------------------------------------------+-----------+</pre>
<h3>Accessing Shares</h3>
<p><strong>[OpenStack Controller]</strong></p>
<p>In order to provide access to Manila shares create user.</p>
<pre># manila access-allow cephshare1 cephx keith</pre>
<p>Create a new keyring for user keith to authenticate via cephx from OpenStack controller running Manila share service.</p>
<pre># ceph --name=client.manila --keyring=/etc/ceph/manila.keyring \
auth get-or-create client.keith -o keith.keyring</pre>
<p>Next we will start an RHEL 7.3 instance and access the Manila share. The instance needs to have both the ceph-fuse client, the ceph configuration and user keyring file (for keith) to mount the share.</p>
<p>Start a RHEL instance on OpenStack.</p>
<p>Note: depending on how you setup OpenStack and if you followed guide above you will need to change things in below. Regardless of setup make sure you change net-id to that of your private network.</p>
<pre># nova boot --flavor m1.small --image "RHEL 7.3" --nic net-id=332c2dca-a005-42ca-abf2-54637c56bacf --key-name admin --security-groups all myrhel</pre>
<p>Add floating ip.</p>
<p>Note: floating ip is required and instance needs access to Ceph management network. This can be achieved by adding Ceph management network to OpenStack as public network and assigning floating ip on that network to instance.</p>
<pre># nova floating-ip-create
# nova floating-ip-associate myrhel 192.168.122.109</pre>
<p>Copy Ceph configuration and keyring for user keith from OpenStack controller to instance.</p>
<pre># scp -i admin.pem /etc/ceph/ceph.conf cloud-user@192.168.122.109:
# scp -i admin.pem keith.keyring cloud-user@192.168.122.109:</pre>
<p>SSH to instance.</p>
<pre># ssh -i admin.pem cloud-user@192.168.122.109</pre>
<p>Install Fuse Client.</p>
<pre>$ sudo subscription-manager repos --enable=rhel-7-server-rpms
$ sudo subscription-manager repos --enable=rhel-7-server-rhceph-2-tools-rpms
$ sudo yum install -y ceph-fuse</pre>
<p>Using ceph-fuse client mount the volume.</p>
<pre>$ sudo ceph-fuse /mnt/cephfs --id=keith \
--conf=/home/cloud-user/ceph.conf --keyring=/home/cloud-user/keith.keyring \
--client-mountpoint=<strong>/volumes/_nogroup/b1464433-f10e-458f-b120-b9b41d3f0083</strong>

</pre>
<pre>List mounted file systems and we should see /mnt/ceph.
$ df -k
Filesystem 1K-blocks Used Available Use% Mounted on
/dev/vda1 20956772 1209676 19747096 6% /
devtmpfs 922260 0 922260 0% /dev
tmpfs 941864 0 941864 0% /dev/shm
tmpfs 941864 16680 925184 2% /run
tmpfs 941864 0 941864 0% /sys/fs/cgroup
tmpfs 188376 0 188376 0% /run/user/1000
<strong>ceph-fuse 1048576 0 1048576 0% /mnt/cephfs</strong></pre>
<h3>Resetting MDS Server</h3>
<p><strong>[Ceph Monitor]</strong></p>
<p>If your MDS server becomes degraded and you don't have a standby or backup you may need to either reset the journal or repair.  In this case we will show how to reset the MDS journal. Note: resetting the journal gets rid of all MDS metadata so be careful.</p>
<pre># ceph -s
 cluster 1e0c9c34-901d-4b46-8001-0d1f93ca5f4d
 health HEALTH_ERR
 mds rank 0 is damaged
 mds cluster is degraded
...</pre>
<p>Reset Journal.</p>
<pre># cephfs-journal-tool journal reset</pre>
<p>Set MDS to repaired.</p>
<pre># ceph mds repaired 0</pre>
<p>Check MDS status.</p>
<pre># ceph mds stat
e46: 1/1/1 up {0=ceph2=up:active}</pre>
<h3>Summary</h3>
<p>In this article we configured OpenStack Manila to use the CephFS storage backend. Ceph is the perfect fit for OpenStack storage as it is a unified distributed software-defined storage system that scales with OpenStack. Ceph provides all storage access methods such as block (Cinder, Nova, Glance), file (Manila) and object (S3/Swift/Glance). As such Ceph can satisfy all OpenStack storage needs in a single unified, easy to manage system. Hopefully you found this article of use. Please let me know any and all feedback.</p>
<p>Happy Manilaing!</p>
<p>(c) 2017 Keith Tenzer</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#ceph" class="page__taxonomy-item" rel="tag">Ceph</a><span class="sep">, </span>
    
      <a href="/tags/#cephfs" class="page__taxonomy-item" rel="tag">CephFS</a><span class="sep">, </span>
    
      <a href="/tags/#manila" class="page__taxonomy-item" rel="tag">Manila</a><span class="sep">, </span>
    
      <a href="/tags/#openstack" class="page__taxonomy-item" rel="tag">OpenStack</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#openstack" class="page__taxonomy-item" rel="tag">OpenStack</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-03-28T00:00:00-07:00">March 28, 2017</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=keithtenzer&text=OpenStack+Manila+Integration+with+Ceph%20http%3A%2F%2Flocalhost%3A4000%2Fopenstack%2Fopenstack-manila-integration-with-ceph%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fopenstack%2Fopenstack-manila-integration-with-ceph%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fopenstack%2Fopenstack-manila-integration-with-ceph%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/openstack/openstack-10-newton-lab-installation-and-configuration-guide/" class="pagination--pager" title="OpenStack 10 (Newton) Lab Installation and Configuration Guide
">Previous</a>
    
    
      <a href="/openshift/storage-for-containers-using-container-native-storage-part-iii/" class="pagination--pager" title="Storage for Containers using Container Native Storage – Part III
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/temporal/temporal_getting_started_guide/" rel="permalink">Temporal Getting Started Guide
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-08-24T00:00:00-07:00">August 24, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
In this article we will walk through setup of a development environment for Temporal. There are of course, several ways you can run the Temporal se...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/temporal/my-first-day-at-temporal/" rel="permalink">My First Day at Temporal
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-08-15T00:00:00-07:00">August 15, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
Today is my first day at temporal and with that I wanted to share some thoughts around my decision, why Temporal and my experience thus far. As you...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/linux/blog-with-gitops-practices-and-github/" rel="permalink">Blog with Gitops Practices and GitHub
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-02-10T00:00:00-08:00">February 10, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          13 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
Want to build your brand, while living the gitops revolution and not paying anything for it? That is exactly what this article will walk you through...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/linux/The-Fedora-Workstation-Experience/" rel="permalink">The Fedora Workstation Experience
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-01-10T00:00:00-08:00">January 10, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
Overview
A lot of people always ask me what is the best way to contribute to opensource? Of course contributing code, documentation, spreading the gospel or...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/keithtenzer"" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/ktenzer" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Keith Tenzer. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
