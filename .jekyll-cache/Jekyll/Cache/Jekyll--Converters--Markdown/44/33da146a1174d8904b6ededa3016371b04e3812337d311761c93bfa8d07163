I"Ë<h3>Overview</h3>
<p>As of today there are over eleven OpenStack services and more are coming. Each service has complete isolation from other services and thatÂ allows OpenStack to scale far beyond the reach ofÂ current computing platforms. However dueÂ to all these independent services, OpenStack can be very complicated to operationalize in enterprise environments.<br />
<!--more--><br />
Each service has a database or means for storing statefulÂ data, requires load balancing and can scale at a different pace from that of other services. In addition OpenStack has over 1000 different configuration parameters, making it impossible to deploy and manage without complete automation through configuration management.</p>
<p>Enterprise OpenStack isÂ about high availability, scalability, automation, configuration management, life-cycles and of course support. Choosing the right distribution is the most important decision you will ever make in regards to OpenStack. Below are some points to consider:</p>
<ul>
<li>Support - How much experience does company have with Open Source, Linux, Ceph and KVM?</li>
<li>Vision - How complete is the OpenStack story? Â Does it extend to applications?</li>
<li>Enterprise Features - High availability, scalability and support for diversified hardware?</li>
<li>Configuration Management - Can OpenStack be managed centrally and deployment be 100% automated?</li>
<li>Enterprise Management - Charge-back, governance policies, single-pane-of-glass, hybrid cloud and support for traditional platforms (VMware, Microsoft Hyper-V, RHEV)?</li>
<li>Linux Containers - How will OpenStack provide infrastructure for DevOps and containerized next-gen applications?</li>
<li>Lock-in - Are you free to choose your underlying hardware vendor for compute, network and storage?</li>
</ul>
<p>I know at least one company that can talk about all of these points and that is Red Hat. In this post we will focus on the Red Hat OpenStack Platform (RHEL OSP).</p>
<p><a href="https://keithtenzer.files.wordpress.com/2015/03/foreman-e.png"><img class="alignnone  wp-image-777" src="/assets/2015/03/foreman-e.png?w=300" alt="foreman-e" width="1383" height="742" /></a></p>
<h3>Node Types</h3>
<p>RHEL OSP defines fourÂ types of nodes: admin, controller, compute and Ceph storage node.</p>
<h4>Admin Node</h4>
<p>The admin node is responsible for management of an OpenStack environment. It provides configuration management through <a href="https://puppetlabs.com/">puppet</a> and automated installation through <a href="http://theforeman.org/">foreman</a>. The admin node is constantly evolving and mixes best of breed open source technologies together. The admin node will allow an OpenStack administrator to deploy OpenStack with 100% automation on bare-metal or virtual infrastructure. The admin node maintains configuration for a deployment centrally therefore you can not only deploy initial environment but you can grow and scale-out the environment in an automated manner. The admin node provides the following additional services for an OpenStack deployment:</p>
<ul>
<li>DHCP</li>
<li>DNS</li>
<li>PXE</li>
<li>TFTP</li>
</ul>
<p>These services enableÂ automated provisioning and configuration management.Â The admin node can provision two types of OpenStack nodes today: controller and compute.</p>
<h4>Controller Node</h4>
<p>The controller node runs all OpenStack services except for Nova (compute). The Red Hat best practice is to run three controller nodes. The admin node and the RHEL OSP installer will configure a <a href="http://clusterlabs.org/">pacemaker</a> cluster that uses corosync for the cluster network as well as fencing nodes. All OpenStack services will be individually clustered with an HA proxy for load balancing. The main reason for running three controller nodes aside from scalability and availability is fencing. Having three nodes provides clear ownership in a pacemaker cluster and as such two nodes is not a valid configuration.</p>
<p>The controller node runs the following OpenStack services:</p>
<ul>
<li>Horizon (dashboard)</li>
<li>Keystone (identity)</li>
<li>Nova scheduler (compute)</li>
<li>Neutron (network)</li>
<li>Neutron metadata (metadata - cloud-init)</li>
<li>Neutron L3 Agent (L3 networking)</li>
<li>Cinder (block storage)</li>
<li>Swift (object storage)</li>
<li>Heat (orchestration)</li>
<li>Ceilometer (telemetry)</li>
</ul>
<h4>Compute Node</h4>
<p>The compute node runs Nova (compute) and the Neutron openvswitch agent. Compute nodes do not provide any high availability, if a compute node goes down then all instances hosted on that node are down. The point of OpenStack though is to provide horizontal scaling. If you need more compute resources you simply add more compute nodes. Applications must be resilient and able to handle instances going down, this is a requirement that is often misunderstood when discussing cloud computing.</p>
<h4>Ceph Storage Node</h4>
<p>The Ceph storage node runs Ceph services such as the Object Storage Daemon (OSD) that provides storage to a Ceph cluster. These nodes are not at this time provisioned by the admin node and must be configured separately. The admin node will let the administrator configure Ceph as a storage back-end for Glance or Cinder but the Ceph cluster must be available. Ceph requires metadata services however and it is ideal to run these on the controller nodes but other than the Ceph metadata services nothing else Ceph related should be running on OpenStack controller nodes.</p>
<p>Ceph is the defactoÂ storage for OpenStack because it meets the requirements for OpenStack storage very well. Ceph can scale far beyond other storage systems and like OpenStack it abstracts hardware allowing you to be free in choice of your hardware vendors.</p>
<h3>Installing Admin Node</h3>
<p>The first step to deploying enterprise OpenStack is to install and configure the admin node. The admin node must at a minimum be connected to the provisioning network. If the admin node goes down you will be unable to provision. In addition if the admin node is providing DNS or DHCP to OpenStack environment those services will be offline. Infrastructure decisionsÂ regarding the admin node require thoughtful planning.</p>
<h4>Prepare</h4>
<pre style="padding-left:30px;">Install RHEL 7.1</pre>
<pre style="padding-left:30px;">#subscription-manager register</pre>
<pre style="padding-left:30px;">#subscription-manager list --available</pre>
<pre style="padding-left:30px;">#subscription-manager attach --pool=&lt;pool id&gt;</pre>
<pre style="padding-left:30px;">#systemctl disable NetworkManager.service</pre>
<pre style="padding-left:30px;">#systemctl stop NetworkManager.service</pre>
<pre style="padding-left:30px;">#yum remove dnsmasq</pre>
<pre style="padding-left:30px;">#subscription-manager repos --disable=*</pre>
<pre style="padding-left:30px;">#subscription-manager repos --enable=rhel-7-server-rpms</pre>
<pre style="padding-left:30px;">#subscription-manager repos --enable=rhel-7-server-openstack-6.0-installer-rpms</pre>
<pre style="padding-left:30px;">#subscription-manager repos --enable=rhel-server-rhscl-7-rpms</pre>
<pre style="padding-left:30px;">#yum update -y</pre>
<pre style="padding-left:30px;">#yum install -y rhel-osp-installer</pre>
<h4>Setup Provisioning Network</h4>
<p>Before starting the installer ensure your network interface is setup correctly. Below is an example.</p>
<pre style="padding-left:30px;">DEVICE=eth0
BOOTPROTO=none
HWADDR=52:54:00:a5:fe:26
ONBOOT=yes
HOTPLUG=yes
TYPE=Ethernet
IPADDR=192.168.122.99
NETMASK=255.255.255.0
PEERDNS=yes
DNS1=192.168.122.99
DNS2=192.168.122.1
NM_CONTROLLED=no</pre>
<h4>Install and Configure</h4>
<pre style="padding-left:30px;">#rhel-osp-installer</pre>
<pre style="padding-left:30px;">Please select NIC on which you want provisioning enabled: 
1. eth0
2. eth1
? 1
</pre>
:ET